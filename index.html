<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Captioner - Free AI-Powered Live Captioning</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            /* Sage green & warm background palette */
            --bg-warm: #F5F3EE;
            --bg-sage-light: #E8EDE7;
            --bg-white: #F5F3EE;
            --sage-primary: #7D9B76;
            --sage-dark: #5A7C55;
            --sage-darker: #3D5A47;
            --sage-muted: #A8BAA3;
            --text-dark: #2D3A2E;
            --text-medium: #5A6B5E;
            --text-light: #8A9A8E;
            --border-light: #D4D2CD;
            --border-sage: #C4D3BE;

            /* Accent colors - purple used sparingly */
            --purple-accent: #8B7FC7;
            --purple-light: #A69DD6;

            /* Functional colors */
            --red-primary: #DC2626;
            --orange-primary: #EA580C;
            --green-bright: #00A676;

            /* Spacing */
            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 18px;
            --radius-xl: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', 'Inter', -apple-system, sans-serif;
            background: var(--bg-warm);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            padding: 0;
            background: #F5F3EE;
            position: relative;
            overflow-x: hidden;
        }

        .blob-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.15;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        .blob-1 {
            width: 400px;
            height: 400px;
            background: #81C784;
            top: 10%;
            left: 10%;
            animation: float-1 20s infinite;
        }

        .blob-2 {
            width: 350px;
            height: 350px;
            background: #9575CD;
            top: 60%;
            left: 70%;
            animation: float-2 25s infinite;
        }

        .blob-3 {
            width: 450px;
            height: 450px;
            background: #66BB6A;
            top: 30%;
            left: 60%;
            animation: float-3 30s infinite;
        }

        .blob-4 {
            width: 300px;
            height: 300px;
            background: #AB47BC;
            top: 70%;
            left: 20%;
            animation: float-4 22s infinite;
        }

        .blob-5 {
            width: 380px;
            height: 380px;
            background: #7E57C2;
            top: 15%;
            left: 80%;
            animation: float-5 28s infinite;
        }

        @keyframes float-1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -50px) scale(1.1); }
            50% { transform: translate(-20px, 30px) scale(0.9); }
            75% { transform: translate(40px, 20px) scale(1.05); }
        }

        @keyframes float-2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(-40px, 30px) scale(0.95); }
            50% { transform: translate(20px, -40px) scale(1.1); }
            75% { transform: translate(-30px, -20px) scale(1); }
        }

        @keyframes float-3 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-50px, 40px) scale(1.05); }
            66% { transform: translate(30px, -30px) scale(0.95); }
        }

        @keyframes float-4 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(25px, 35px) scale(1.08); }
            50% { transform: translate(-35px, -25px) scale(0.92); }
            75% { transform: translate(15px, -40px) scale(1.03); }
        }

        @keyframes float-5 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(40px, -35px) scale(0.97); }
            66% { transform: translate(-25px, 45px) scale(1.08); }
        }

        .landing-header {
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-light);
            background: #F5F3EE;
            position: relative;
            z-index: 10;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            justify-content: center;
        }

        .logo-bar {
            height: 9px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .logo-bar-1 { background: var(--sage-darker); width: 100%; }
        .logo-bar-2 { background: var(--sage-primary); width: 75%; }
        .logo-bar-3 { background: var(--sage-muted); width: 50%; }

        .logo-text {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-dark);
            letter-spacing: -0.5px;
        }

        .badge-tag {
            display: inline-block;
            background: var(--bg-sage-light);
            color: var(--sage-darker);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Demo Section */
        .demo-section {
            max-width: 700px;
            margin: 40px auto 40px;
            padding: 0 32px;
            position: relative;
            z-index: 5;
        }

        .demo-card {
            background: rgba(245, 243, 238, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid var(--sage-primary);
            border-radius: 20px;
            padding: 28px;
            box-shadow: 0 15px 40px rgba(61, 90, 71, 0.12);
        }

        .demo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
        }

        .demo-title {
            font-size: 22px;
            font-weight: 800;
            color: var(--sage-darker);
            margin: 0;
        }

        .demo-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px;
            background: #f5f5f5;
            border-radius: 20px;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #9E9E9E;
            transition: all 0.3s;
        }

        .indicator-dot.active {
            background: #00A676;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .indicator-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
            min-width: 100px;
        }

        .demo-box {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 14px;
            padding: 32px 28px;
            margin-bottom: 16px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .demo-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.03) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .demo-text {
            font-size: 24px;
            font-weight: 600;
            color: white;
            text-align: center;
            line-height: 1.5;
            transition: all 0.5s ease;
            position: relative;
            z-index: 1;
        }

        .demo-text.phase-correcting {
            color: #FF6B6B;
            transform: scale(1.02);
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
        }

        .demo-text.phase-corrected,
        .demo-text.phase-waiting {
            color: #51CF66;
            text-shadow: 0 0 20px rgba(81, 207, 102, 0.4);
        }

        .demo-progress {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #D1D5DB;
            transition: all 0.3s;
        }

        .progress-dot.active {
            width: 32px;
            border-radius: 5px;
            background: var(--sage-primary);
            border: 2px solid var(--border-light);
            color: var(--text-medium);
        }

        .demo-btn.secondary:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
            transform: translateY(-2px);
        }

        .hero-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 32px 80px;
            text-align: center;
            position: relative;
            z-index: 5;
        }

        .hero-title {
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(135deg, #2E7D32 0%, #388E3C 50%, #43A047 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
            margin-bottom: 28px;
            letter-spacing: -2px;
            animation: titleFloat 3s ease-in-out infinite;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .hero-subtitle {
            font-size: 26px;
            color: var(--text-dark);
            margin-bottom: 20px;
            font-weight: 600;
            line-height: 1.4;
        }

        .hero-subtitle strong {
            color: var(--sage-darker);
            font-weight: 700;
        }

        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .hero-description {
            font-size: 19px;
            color: var(--text-medium);
            max-width: 750px;
            margin: 0 auto 48px;
            line-height: 1.8;
            font-weight: 400;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 80px;
        }

        .cta-btn {
            padding: 20px 42px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .cta-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .cta-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .cta-btn-primary {
            background: linear-gradient(135deg, #2E7D32 0%, #43A047 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }

        .cta-btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(46, 125, 50, 0.4);
        }

        .cta-btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: var(--sage-darker);
            border: 3px solid var(--sage-primary);
            box-shadow: 0 4px 15px rgba(61, 90, 71, 0.1);
        }

        .cta-btn-secondary:hover {
            background: white;
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(61, 90, 71, 0.2);
        }

        .feature-cards {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 32px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            position: relative;
            z-index: 5;
        }

        .feature-card {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 40px 32px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .feature-card:hover {
            border-color: var(--sage-primary);
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(125, 155, 118, 0.15);
        }

        .feature-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .feature-desc {
            font-size: 15px;
            color: var(--text-medium);
            line-height: 1.6;
        }

        .feature-link {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
            font-size: 14px;
            font-weight: 600;
            color: var(--sage-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .feature-link .arrow {
            transition: transform 0.2s;
        }

        .feature-card:hover .feature-link .arrow {
            transform: translateX(4px);
        }

        .feature-link.special-link {
            color: var(--purple-accent);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: var(--bg-sage-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--sage-darker);
            transition: all 0.3s;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.05);
            background: var(--sage-light);
        }

        .feature-card.special .feature-icon {
            background: linear-gradient(135deg, var(--purple-accent), var(--purple-light));
            color: white;
        }

        .feature-card.special:hover .feature-icon {
            background: linear-gradient(135deg, var(--purple-accent), var(--purple-light));
        }

        .special-badge {
            display: inline-block;
            background: var(--purple-accent);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        /* About/FAQ Sections */
        .info-section {
            max-width: 1200px;
            margin: 80px auto;
            padding: 0 32px;
            position: relative;
            z-index: 5;
        }

        .section-title {
            font-size: 42px;
            font-weight: 900;
            color: var(--sage-darker);
            margin-bottom: 16px;
            text-align: center;
        }

        .section-subtitle {
            font-size: 18px;
            color: var(--text-medium);
            text-align: center;
            margin-bottom: 48px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 28px;
            margin-bottom: 40px;
        }

        .info-card {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 32px;
            transition: all 0.3s;
        }

        .info-card:hover {
            border-color: var(--sage-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(61, 90, 71, 0.1);
        }

        .info-card h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--sage-darker);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .info-card p, .info-card li {
            font-size: 16px;
            color: var(--text-medium);
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .info-card ul {
            list-style: none;
            padding-left: 0;
        }

        .info-card li::before {
            content: "→";
            color: var(--sage-primary);
            font-weight: bold;
            margin-right: 10px;
        }

        .faq-item {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .faq-question {
            font-size: 18px;
            font-weight: 700;
            color: var(--sage-darker);
            margin-bottom: 12px;
        }

        .faq-answer {
            font-size: 16px;
            color: var(--text-medium);
            line-height: 1.7;
        }

        .highlight-box {
            background: var(--bg-sage-light);
            border-left: 4px solid var(--sage-primary);
            padding: 20px 24px;
            border-radius: 8px;
            margin: 24px 0;
        }

        .highlight-box strong {
            color: var(--sage-darker);
            font-size: 17px;
        }

        /* About Section - Modern Card Grid */
        .about-section .info-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(245,243,238,0.95) 100%);
            border-left: 4px solid var(--sage-primary);
            position: relative;
            overflow: hidden;
        }

        .about-section .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(125,155,118,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .about-section h3 {
            font-size: 20px !important;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 800;
            border-bottom: 2px solid var(--sage-primary);
            padding-bottom: 12px;
            margin-bottom: 20px !important;
        }

        /* Architecture Diagram Section */
        .architecture-section {
            background: var(--bg-white);
            padding: 60px 32px;
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-light);
        }

        .architecture-diagram {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .arch-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .arch-box {
            background: var(--bg-sage-light);
            border: 2px solid var(--border-sage);
            border-radius: var(--radius-md);
            padding: 20px 24px;
            text-align: center;
            min-width: 140px;
            transition: all 0.3s;
        }

        .arch-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(125, 155, 118, 0.15);
        }

        .arch-box.special {
            background: linear-gradient(135deg, var(--purple-accent), var(--purple-light));
            border-color: var(--purple-accent);
            color: white;
        }

        .arch-box.special .arch-detail {
            color: rgba(255, 255, 255, 0.8);
        }

        .arch-icon {
            margin-bottom: 8px;
            color: var(--sage-darker);
        }

        .arch-box.special .arch-icon {
            color: white;
        }

        .arch-icon.small {
            margin-bottom: 6px;
        }

        .arch-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .arch-box.special .arch-label {
            color: white;
        }

        .arch-detail {
            font-size: 12px;
            color: var(--text-medium);
        }

        .arch-arrow {
            font-size: 24px;
            color: var(--sage-primary);
            font-weight: bold;
        }

        .arch-secondary {
            margin-top: 24px;
            position: relative;
        }

        .arch-connector {
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--border-sage);
        }

        .arch-row-secondary {
            padding-top: 20px;
            justify-content: center;
        }

        .arch-row-secondary .arch-box {
            padding: 16px 20px;
            min-width: 120px;
            background: white;
            border-color: var(--border-light);
        }

        .arch-row-secondary .arch-label {
            font-size: 13px;
        }

        .arch-row-secondary .arch-detail {
            font-size: 11px;
        }

        .arch-caption {
            text-align: center;
            color: var(--text-medium);
            font-size: 14px;
            max-width: 600px;
            margin: 24px auto 0;
            line-height: 1.6;
        }

        /* How-To Section - Numbered Steps */
        .howto-section {
            background: linear-gradient(to bottom, transparent 0%, rgba(125,155,118,0.03) 100%);
            padding: 60px 32px;
            max-width: 100%;
        }

        .howto-section .info-card {
            background: white;
            border: none;
            box-shadow: 0 4px 20px rgba(61, 90, 71, 0.08);
            position: relative;
            padding-left: 80px;
        }

        .howto-section .info-card::before {
            content: attr(data-step);
            position: absolute;
            left: 24px;
            top: 28px;
            width: 44px;
            height: 44px;
            background: var(--sage-darker);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 800;
        }

        .howto-section h3 {
            font-size: 22px !important;
            font-weight: 700;
            margin-bottom: 16px !important;
        }

        /* FAQ Section - Accordion Style */
        .faq-section .faq-item {
            background: white;
            border: none;
            border-left: 3px solid transparent;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            transition: all 0.3s;
            cursor: pointer;
        }

        .faq-section .faq-item:hover {
            border-left-color: var(--sage-primary);
            box-shadow: 0 4px 20px rgba(61, 90, 71, 0.12);
            transform: translateX(4px);
        }

        .faq-question {
            position: relative;
            padding-left: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-toggle {
            font-size: 24px;
            font-weight: 700;
            color: var(--sage-primary);
            margin-left: 12px;
            flex-shrink: 0;
        }

        .faq-question::before {
            content: 'Q';
            position: absolute;
            left: 0;
            top: 0;
            width: 18px;
            height: 18px;
            background: var(--sage-primary);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .faq-answer {
            padding-left: 24px;
            border-left: 2px solid var(--bg-sage-light);
            margin-left: 9px;
        }

        /* Footer Styles */
        .site-footer {
            background: var(--sage-darker);
            color: white;
            padding: 48px 32px 32px;
            margin-top: 100px;
            position: relative;
            z-index: 5;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 28px;
        }

        .footer-text {
            font-size: 16px;
            line-height: 1.8;
            text-align: center;
            max-width: 800px;
        }

        .footer-text a {
            color: #A5D6A7;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s;
        }

        .footer-text a:hover {
            color: #C8E6C9;
            text-decoration: underline;
        }

        .footer-logos {
            display: flex;
            align-items: center;
            gap: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-logo {
            height: 60px;
            object-fit: contain;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .footer-logo:hover {
            opacity: 1;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .footer-icon-link {
            color: white;
            font-size: 28px;
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-icon-link:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        .footer-license {
            font-size: 13px;
            color: #C8E6C9;
            text-align: center;
            margin-top: 16px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Dashboard Styles */
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px;
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid var(--border-light);
        }

        .dashboard-title {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-dark);
        }

        .back-btn {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-medium);
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 28px;
        }

        .preview-section {
            background: #1a1a1a;
            border-radius: var(--radius-xl);
            padding: 48px 32px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 28px;
        }

        .preview-label {
            position: absolute;
            top: 16px;
            left: 20px;
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .preview-badges {
            position: absolute;
            top: 16px;
            right: 20px;
            display: flex;
            gap: 8px;
        }

        .preview-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }

        .preview-badge.mode { background: var(--sage-primary); }
        .preview-badge.whisper { background: var(--orange-primary); }
        .preview-badge.engine { background: var(--purple-accent); }
        .preview-badge.corrections { background: var(--green-bright); }
        .preview-badge.listening {
            background: var(--red-primary);
            animation: pulse 1.5s infinite;
        }

        .preview-text {
            font-size: 32px;
            font-weight: 600;
            color: white;
            text-align: center;
            max-width: 90%;
            line-height: 1.4;
        }

        .preview-text.empty {
            color: #555;
            font-size: 18px;
        }

        .card {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-badge {
            padding: 4px 10px;
            background: var(--purple-accent);
            color: white;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .mode-btn {
            padding: 18px 24px;
            background: var(--bg-sage-light);
            border: 2px solid var(--border-sage);
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-medium);
        }

        .mode-btn:hover {
            border-color: var(--sage-primary);
        }

        .mode-btn.active {
            background: var(--sage-darker);
            border-color: var(--sage-darker);
            color: white;
        }

        .mode-btn.active.whisper {
            background: var(--orange-primary);
            border-color: var(--orange-primary);
        }

        .btn-large {
            width: 100%;
            padding: 18px 24px;
            font-size: 17px;
            font-weight: 700;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .btn-primary {
            background: var(--sage-darker);
            color: white;
        }

        .btn-primary:hover {
            background: var(--sage-primary);
        }

        .btn-danger {
            background: var(--red-primary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-light);
            color: var(--text-medium);
        }

        .btn-outline:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .setting-group {
            margin-bottom: 24px;
        }

        .setting-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-value {
            font-weight: 600;
            color: var(--sage-darker);
        }

        .setting-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--sage-primary);
        }

        .setting-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-light);
            outline: none;
            -webkit-appearance: none;
        }

        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--sage-darker);
            cursor: pointer;
        }

        .setting-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--sage-darker);
            cursor: pointer;
            border: none;
        }

        .color-input-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .toggle-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-sage-light);
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
        }

        .toggle-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .toggle-switch {
            width: 50px;
            height: 28px;
            background: var(--border-light);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.on {
            background: var(--sage-primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.on::after {
            transform: translateX(22px);
        }

        .rec-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
        }

        .rec-indicator.recording {
            background: #FEE2E2;
            border-color: var(--red-primary);
            color: var(--red-primary);
        }

        .rec-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-light);
        }

        .rec-indicator.recording .rec-dot {
            background: var(--red-primary);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .url-display {
            background: var(--bg-sage-light);
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
        }

        .url-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-medium);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .url-text {
            font-family: 'Monaco', monospace;
            font-size: 14px;
            color: var(--sage-darker);
            word-break: break-all;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid var(--border-sage);
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 16px;
        }

        .export-btn {
            padding: 12px 16px;
            background: var(--bg-sage-light);
            border: 2px solid var(--border-sage);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-dark);
            transition: all 0.2s;
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .export-btn:hover {
            background: var(--sage-darker);
            color: white;
            border-color: var(--sage-darker);
        }

        /* Wizard Styles */
        .wizard-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-light);
            z-index: 0;
        }

        .wizard-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .wizard-step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-white);
            border: 3px solid var(--border-light);
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--text-light);
            transition: all 0.3s;
        }

        .wizard-step.active .wizard-step-circle {
            background: var(--sage-darker);
            border-color: var(--sage-darker);
            color: white;
        }

        .wizard-step.completed .wizard-step-circle {
            background: var(--sage-primary);
            border-color: var(--sage-primary);
            color: white;
        }

        .wizard-step-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
        }

        .wizard-step.active .wizard-step-label {
            color: var(--sage-darker);
        }

        .wizard-content {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 40px;
            margin-bottom: 24px;
        }

        .wizard-nav {
            display: flex;
            justify-content: space-between;
            gap: 16px;
        }

        .wizard-btn {
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 700;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wizard-btn-primary {
            background: var(--sage-darker);
            color: white;
            flex: 1;
        }

        .wizard-btn-primary:hover {
            background: var(--sage-primary);
        }

        .wizard-btn-secondary {
            background: transparent;
            border: 2px solid var(--border-light);
            color: var(--text-medium);
        }

        .wizard-btn-secondary:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
        }

        .template-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .template-card {
            padding: 24px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .template-card:hover {
            border-color: var(--sage-primary);
            transform: translateY(-2px);
        }

        .template-card.selected {
            border-color: var(--sage-darker);
            background: var(--bg-sage-light);
        }

        .template-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .template-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .template-desc {
            font-size: 13px;
            color: var(--text-medium);
        }

        .term-form {
            background: var(--bg-sage-light);
            padding: 24px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }

        .term-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .term-item {
            padding: 12px 16px;
            background: white;
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .term-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .term-category {
            font-size: 12px;
            padding: 4px 8px;
            background: var(--sage-primary);
            color: white;
            border-radius: 6px;
            margin-left: 8px;
        }

        .term-remove {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: var(--red-primary);
            cursor: pointer;
            font-weight: 600;
        }

        .info-box {
            background: var(--bg-sage-light);
            padding: 20px;
            border-radius: var(--radius-md);
            margin: 20px 0;
            border-left: 4px solid var(--sage-primary);
        }

        .info-box-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--sage-darker);
        }

        .example-correction {
            padding: 12px;
            background: white;
            border-radius: var(--radius-sm);
            margin-top: 12px;
            font-family: monospace;
        }

        .correction-before {
            color: var(--red-primary);
            text-decoration: line-through;
        }

        .correction-after {
            color: var(--green-bright);
            font-weight: 600;
        }

        .about-content h2 {
            font-size: 28px;
            margin-top: 32px;
            margin-bottom: 16px;
            color: var(--text-dark);
        }

        .about-content h3 {
            font-size: 20px;
            margin-top: 24px;
            margin-bottom: 12px;
            color: var(--sage-darker);
        }

        .about-content p {
            font-size: 16px;
            line-height: 1.7;
            color: var(--text-medium);
            margin-bottom: 16px;
        }

        .about-content ul {
            margin: 16px 0;
            padding-left: 24px;
        }

        .about-content li {
            margin-bottom: 8px;
            color: var(--text-medium);
        }

        .comparison-table {
            width: 100%;
            margin: 24px 0;
            border-collapse: collapse;
        }

        .comparison-table th {
            background: var(--sage-darker);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 700;
        }

        .comparison-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-light);
        }

        .comparison-table tr:nth-child(even) {
            background: var(--bg-sage-light);
        }

        .architecture-diagram {
            background: var(--bg-white);
            padding: 24px;
            border-radius: var(--radius-md);
            border: 2px solid var(--border-light);
            margin: 24px 0;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.8;
            overflow-x: auto;
        }

        @media (max-width: 1024px) {
            .feature-cards {
                grid-template-columns: 1fr;
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .template-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Translation dictionary
        const translations = {
            en: {
                // Header
                'AI for Accessibility': 'AI for Accessibility',
                'Professional live captioning for community media. Zero cost. Powered by AI + Human intelligence.': 'Professional live captioning for community media. Zero cost. Powered by AI + Human intelligence.',
                'Open Control Dashboard': 'Open Control Dashboard',
                'Learn More': 'Learn More',
                'AI Settings': 'AI Settings',
                // Dashboard
                'Control Dashboard': 'Control Dashboard',
                'Back to Home': 'Back to Home',
                'Configure Engine': 'Configure Engine',
                'Upload Engine': 'Upload Engine',
                'Live Preview': 'Live Preview',
                'Captioning Mode': 'Captioning Mode',
                'Browser Speech': 'Browser Speech',
                'Whisper AI': 'Whisper AI',
                'Start Browser Captions': 'Start Browser Captions',
                'Stop Browser Captions': 'Stop Browser Captions',
                'AI Caption Engine': 'AI Caption Engine',
                'Engine Active': 'Engine Active',
                'Engine Disabled': 'Engine Disabled',
                'Total Terms': 'Total Terms',
                'Corrections Made': 'Corrections Made',
                'Engine Status': 'Engine Status',
            },
            es: {
                // Header
                'AI for Accessibility': 'IA para Accesibilidad',
                'Professional live captioning for community media. Zero cost. Powered by AI + Human intelligence.': 'Subtitulado en vivo profesional para medios comunitarios. Costo cero. Impulsado por IA + inteligencia humana.',
                'Open Control Dashboard': 'Abrir Panel de Control',
                'Learn More': 'Más Información',
                'AI Settings': 'Configuración de IA',
                // Dashboard
                'Control Dashboard': 'Panel de Control',
                'Back to Home': 'Volver al Inicio',
                'Configure Engine': 'Configurar Motor',
                'Upload Engine': 'Cargar Motor',
                'Live Preview': 'Vista Previa en Vivo',
                'Captioning Mode': 'Modo de Subtitulado',
                'Browser Speech': 'Voz del Navegador',
                'Whisper AI': 'Whisper IA',
                'Start Browser Captions': 'Iniciar Subtítulos del Navegador',
                'Stop Browser Captions': 'Detener Subtítulos del Navegador',
                'AI Caption Engine': 'Motor de Subtítulos IA',
                'Engine Active': 'Motor Activo',
                'Engine Disabled': 'Motor Deshabilitado',
                'Total Terms': 'Términos Totales',
                'Corrections Made': 'Correcciones Realizadas',
                'Engine Status': 'Estado del Motor',
            },
            pt: {
                // Header
                'AI for Accessibility': 'IA para Acessibilidade',
                'Professional live captioning for community media. Zero cost. Powered by AI + Human intelligence.': 'Legendagem ao vivo profissional para mídia comunitária. Custo zero. Alimentado por IA + inteligência humana.',
                'Open Control Dashboard': 'Abrir Painel de Controle',
                'Learn More': 'Saiba Mais',
                'AI Settings': 'Configurações de IA',
                // Dashboard
                'Control Dashboard': 'Painel de Controle',
                'Back to Home': 'Voltar ao Início',
                'Configure Engine': 'Configurar Motor',
                'Upload Engine': 'Carregar Motor',
                'Live Preview': 'Visualização ao Vivo',
                'Captioning Mode': 'Modo de Legendagem',
                'Browser Speech': 'Fala do Navegador',
                'Whisper AI': 'Whisper IA',
                'Start Browser Captions': 'Iniciar Legendas do Navegador',
                'Stop Browser Captions': 'Parar Legendas do Navegador',
                'AI Caption Engine': 'Motor de Legendas IA',
                'Engine Active': 'Motor Ativo',
                'Engine Disabled': 'Motor Desativado',
                'Total Terms': 'Termos Totais',
                'Corrections Made': 'Correções Feitas',
                'Engine Status': 'Status do Motor',
            },
            fr: {
                // Header
                'AI for Accessibility': 'IA pour l\'Accessibilité',
                'Professional live captioning for community media. Zero cost. Powered by AI + Human intelligence.': 'Sous-titrage en direct professionnel pour les médias communautaires. Coût zéro. Alimenté par l\'IA + intelligence humaine.',
                'Open Control Dashboard': 'Ouvrir le Tableau de Bord',
                'Learn More': 'En Savoir Plus',
                'AI Settings': 'Paramètres IA',
                // Dashboard
                'Control Dashboard': 'Tableau de Bord',
                'Back to Home': 'Retour à l\'Accueil',
                'Configure Engine': 'Configurer le Moteur',
                'Upload Engine': 'Télécharger le Moteur',
                'Live Preview': 'Aperçu en Direct',
                'Captioning Mode': 'Mode de Sous-titrage',
                'Browser Speech': 'Voix du Navigateur',
                'Whisper AI': 'Whisper IA',
                'Start Browser Captions': 'Démarrer les Sous-titres du Navigateur',
                'Stop Browser Captions': 'Arrêter les Sous-titres du Navigateur',
                'AI Caption Engine': 'Moteur de Sous-titres IA',
                'Engine Active': 'Moteur Actif',
                'Engine Disabled': 'Moteur Désactivé',
                'Total Terms': 'Termes Totaux',
                'Corrections Made': 'Corrections Effectuées',
                'Engine Status': 'État du Moteur',
            }
        };

        function App() {
            const [view, setView] = useState('landing');
            const [language, setLanguage] = useState('en');

            const t = (key) => translations[language][key] || key;

            const startDashboard = () => setView('dashboard');
            const startEngineWizard = () => setView('engine-wizard');
            const showAbout = () => setView('about');
            const showAISettings = () => setView('ai-settings');

            if (view === 'landing') {
                return <LandingPage
                    onStartDashboard={startDashboard}
                    onStartEngine={startEngineWizard}
                    onShowAbout={showAbout}
                    onShowAISettings={showAISettings}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'dashboard') {
                return <Dashboard
                    onBack={() => setView('landing')}
                    onConfigureEngine={startEngineWizard}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'engine-wizard') {
                return <EngineWizard
                    onBack={() => setView('landing')}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'about') {
                return <AboutPage
                    onBack={() => setView('landing')}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'ai-settings') {
                return <AISettings
                    onBack={() => setView('landing')}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }
        }

        function CaptionDemo() {
            const [demoIndex, setDemoIndex] = useState(0);
            const [phase, setPhase] = useState('showing'); // showing, correcting, corrected, waiting

            const demos = [
                {
                    original: "Welcome to the Brooklyn Select Board meeting",
                    corrected: "Welcome to the Brookline Select Board meeting",
                    highlight: "Brookline"
                },
                {
                    original: "Chair bernard green will lead the discussion",
                    corrected: "Chair Bernard Greene will lead the discussion",
                    highlight: "Bernard Greene"
                },
                {
                    original: "Meeting at coolidge corner town hall",
                    corrected: "Meeting at Coolidge Corner Town Hall",
                    highlight: "Coolidge Corner Town Hall"
                }
            ];

            const currentDemo = demos[demoIndex];

            // Auto-loop animation
            useEffect(() => {
                const timers = [];

                // Phase 1: Show original (2s)
                timers.push(setTimeout(() => setPhase('correcting'), 2000));

                // Phase 2: Correcting animation (800ms)
                timers.push(setTimeout(() => setPhase('corrected'), 2800));

                // Phase 3: Show corrected (2s)
                timers.push(setTimeout(() => setPhase('waiting'), 4800));

                // Phase 4: Next demo (500ms fade)
                timers.push(setTimeout(() => {
                    setDemoIndex((prev) => (prev + 1) % demos.length);
                    setPhase('showing');
                }, 5300));

                return () => timers.forEach(t => clearTimeout(t));
            }, [demoIndex]);

            const displayText = phase === 'showing' || phase === 'correcting' ? currentDemo.original : currentDemo.corrected;

            return (
                <div className="demo-section">
                    <div className="demo-card">
                        <div className="demo-header">
                            <h2 className="demo-title">AI Correction Engine</h2>
                            <div className="demo-indicator">
                                <div className={`indicator-dot ${phase === 'correcting' ? 'active' : ''}`}></div>
                                <span className="indicator-text">
                                    {phase === 'showing' && 'Listening...'}
                                    {phase === 'correcting' && 'Correcting...'}
                                    {(phase === 'corrected' || phase === 'waiting') && 'Corrected ✓'}
                                </span>
                            </div>
                        </div>
                        <div className="demo-box">
                            <div className={`demo-text phase-${phase}`}>
                                {displayText}
                            </div>
                        </div>
                        <div className="demo-progress">
                            {demos.map((_, idx) => (
                                <div
                                    key={idx}
                                    className={`progress-dot ${idx === demoIndex ? 'active' : ''}`}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        function TypeWriter({ text, delay = 50, startDelay = 0, className = '', showCursor = true }) {
            const [displayText, setDisplayText] = useState('');
            const [currentIndex, setCurrentIndex] = useState(0);
            const [started, setStarted] = useState(startDelay === 0);
            const isComplete = currentIndex >= text.length;

            useEffect(() => {
                if (startDelay > 0 && !started) {
                    const startTimer = setTimeout(() => setStarted(true), startDelay);
                    return () => clearTimeout(startTimer);
                }
            }, [startDelay, started]);

            useEffect(() => {
                if (started && currentIndex < text.length) {
                    const timer = setTimeout(() => {
                        setDisplayText(prev => prev + text[currentIndex]);
                        setCurrentIndex(prev => prev + 1);
                    }, delay);

                    return () => clearTimeout(timer);
                }
            }, [started, currentIndex, text, delay]);

            return (
                <span className={`${className} ${showCursor && !isComplete ? 'typing-cursor' : ''}`}>
                    {displayText}
                </span>
            );
        }

        function LandingPage({ onStartDashboard, onStartEngine, onShowAbout, onShowAISettings, language, setLanguage, t }) {
            const [expandedFAQ, setExpandedFAQ] = useState(null);

            const toggleFAQ = (index) => {
                setExpandedFAQ(expandedFAQ === index ? null : index);
            };

            return (
                <div className="landing-page">
                    <div className="blob-container">
                        <div className="blob blob-1"></div>
                        <div className="blob blob-2"></div>
                        <div className="blob blob-3"></div>
                        <div className="blob blob-4"></div>
                        <div className="blob blob-5"></div>
                    </div>
                    <header className="landing-header">
                        <div className="logo-section">
                            <div className="logo-icon">
                                <div className="logo-bar logo-bar-1"></div>
                                <div className="logo-bar logo-bar-2"></div>
                                <div className="logo-bar logo-bar-3"></div>
                            </div>
                            <div>
                                <div className="logo-text">Community Captioner</div>
                                <span className="badge-tag">Open Source Captioning for Community Media</span>
                            </div>
                        </div>
                        <div style={{display: 'flex', gap: '12px', alignItems: 'center'}}>
                            <select
                                value={language}
                                onChange={(e) => setLanguage(e.target.value)}
                                style={{
                                    padding: '8px 12px',
                                    background: 'var(--bg-white)',
                                    color: 'var(--text-dark)',
                                    border: '2px solid var(--border-sage)',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                    fontFamily: 'DM Sans, sans-serif'
                                }}
                            >
                                <option value="en">English</option>
                                <option value="es">Español</option>
                                <option value="pt">Português</option>
                                <option value="fr">Français</option>
                            </select>
                            <button
                                onClick={onShowAISettings}
                                style={{
                                    padding: '8px 16px',
                                    background: 'var(--sage-primary)',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '500'
                                }}
                            >
                                {t('AI Settings')}
                            </button>
                        </div>
                    </header>

                    <section className="hero-section">
                        <h1 className="hero-title">
                            <TypeWriter text={t('AI for Accessibility')} delay={80} key={language + '-title'} />
                        </h1>

                        <p className="hero-subtitle">
                            <TypeWriter
                                text={t('Professional live captioning for community media. Zero cost. Powered by AI + Human intelligence.')}
                                delay={30}
                                startDelay={1600}
                                key={language + '-subtitle'}
                            />
                        </p>

                        <div className="cta-buttons">
                            <button className="cta-btn cta-btn-primary" onClick={onStartDashboard}>
                                {t('Open Control Dashboard')}
                            </button>
                            <button className="cta-btn cta-btn-secondary" onClick={() => {
                                document.getElementById('about-section')?.scrollIntoView({ behavior: 'smooth' });
                            }}>
                                {t('Learn More')}
                            </button>
                        </div>

                        <CaptionDemo />
                    </section>

                    <div className="feature-cards">
                        <div className="feature-card" onClick={onStartDashboard}>
                            <div className="feature-icon">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="4" y="6" width="32" height="22" rx="3" stroke="currentColor" strokeWidth="2.5" fill="none"/>
                                    <path d="M4 24h32" stroke="currentColor" strokeWidth="2"/>
                                    <rect x="8" y="30" width="24" height="4" rx="1" fill="currentColor" opacity="0.3"/>
                                    <path d="M10 14h20M10 18h14" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                                </svg>
                            </div>
                            <h3 className="feature-title">Live Overlay</h3>
                            <p className="feature-desc">
                                Real-time captions for OBS, vMix, and streaming platforms.
                                Fully customizable appearance and positioning.
                            </p>
                            <div className="feature-link">
                                Open Dashboard <span className="arrow">→</span>
                            </div>
                        </div>

                        <div className="feature-card special" onClick={onStartEngine}>
                            <div className="feature-icon">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="20" cy="16" r="10" stroke="currentColor" strokeWidth="2.5" fill="none"/>
                                    <path d="M16 16l3 3 5-6" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
                                    <path d="M12 28c0-4.4 3.6-8 8-8s8 3.6 8 8" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" fill="none"/>
                                    <circle cx="32" cy="28" r="6" fill="currentColor" opacity="0.2"/>
                                    <path d="M29 28h6M32 25v6" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                                </svg>
                            </div>
                            <h3 className="feature-title">AI Caption Engine</h3>
                            <p className="feature-desc">
                                RAG-powered correction with semantic matching and fuzzy detection.
                                Learns from documents, web sources, and your corrections.
                            </p>
                            <div className="feature-link special-link">
                                Configure Engine <span className="arrow">→</span>
                            </div>
                        </div>

                        <div className="feature-card" onClick={onStartDashboard}>
                            <div className="feature-icon">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="6" y="8" width="18" height="24" rx="2" stroke="currentColor" strokeWidth="2.5" fill="none"/>
                                    <path d="M10 14h10M10 18h7M10 22h10M10 26h5" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                                    <path d="M28 18l4 4-4 4" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
                                    <circle cx="32" cy="30" r="6" stroke="currentColor" strokeWidth="2" fill="none"/>
                                    <path d="M30 30h4M32 28v4" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                                    <rect x="28" y="8" width="8" height="6" rx="1" fill="currentColor" opacity="0.3"/>
                                </svg>
                            </div>
                            <h3 className="feature-title">Session Refinement + Analysis</h3>
                            <p className="feature-desc">
                                AI-powered post-session refinement, analytics dashboards, and
                                automatic video highlight reel generation.
                            </p>
                            <div className="feature-link">
                                View Analytics <span className="arrow">→</span>
                            </div>
                        </div>
                    </div>

                    {/* About Section */}
                    <section id="about-section" className="info-section about-section">
                        <h2 className="section-title">About Community Captioner</h2>
                        <p className="section-subtitle">
                            Free, open-source live captioning built for community media organizations
                        </p>

                        <div className="highlight-box">
                            <strong>The Problem:</strong> Commercial live captioning encoders cost $30,000+, putting accessibility features out of reach for community media stations, local governments, and small organizations.
                        </div>

                        <div className="highlight-box" style={{borderLeftColor: 'var(--sage-darker)', background: 'rgba(125, 155, 118, 0.08)'}}>
                            <strong>New Legal Requirements:</strong> The FCC's 21st Century Communications and Video Accessibility Act (CVAA) and upcoming state-level legislation increasingly require live captioning for government meetings and public broadcasts. Massachusetts LD 1937 and similar bills nationwide mandate that all public meetings provide real-time captioning by 2027. Community Captioner offers a compliant, zero-cost solution for municipalities facing these requirements.
                        </div>

                        <div className="info-grid">
                            <div className="info-card">
                                <h3>Why It Exists</h3>
                                <p>
                                    Community Captioner was created for Brookline Interactive Group (BIG), a community media organization in Brookline, MA. They needed live captions for town meetings and local programming but couldn't afford commercial solutions.
                                </p>
                                <p>
                                    This tool provides professional-grade captioning at zero cost, using browser APIs and optional local AI.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>What Makes It Unique</h3>
                                <p>
                                    Generic speech recognition systems fail on local proper nouns. They transcribe "Bernard Greene" as "bernard green" and "Brookline" as "Brooklyn."
                                </p>
                                <p>
                                    The <strong>AI Caption Engine</strong> uses RAG (Retrieval Augmented Generation) to automatically correct these errors based on your community's specific vocabulary.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>How RAG Works</h3>
                                <p>
                                    RAG stands for Retrieval Augmented Generation. Here's how it corrects captions:
                                </p>
                                <ul>
                                    <li>You upload documents (meeting agendas, staff directories, etc.)</li>
                                    <li>AI extracts proper nouns (people, places, organizations)</li>
                                    <li>System builds a local correction dictionary</li>
                                    <li>Incoming captions are matched and corrected in real-time</li>
                                </ul>
                            </div>

                            <div className="info-card">
                                <h3>Design Values</h3>
                                <ul>
                                    <li><strong>Zero Dependencies:</strong> Works in any browser, no installation required</li>
                                    <li><strong>Privacy First:</strong> Can run 100% locally with Whisper AI</li>
                                    <li><strong>Community Focused:</strong> Built for local governments and community media</li>
                                    <li><strong>Free Forever:</strong> Open source under CC BY-SA 4.0 license</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    {/* Architecture Section */}
                    <section className="info-section architecture-section">
                        <h2 className="section-title">System Architecture</h2>
                        <p className="section-subtitle">
                            How the v4.0 AI-powered captioning pipeline works
                        </p>

                        <div className="architecture-diagram">
                            <div className="arch-row">
                                <div className="arch-box arch-input">
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <circle cx="16" cy="10" r="6" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M8 28c0-4.4 3.6-8 8-8s8 3.6 8 8" stroke="currentColor" strokeWidth="2"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">Speech Input</div>
                                    <div className="arch-detail">Microphone</div>
                                </div>
                                <div className="arch-arrow">→</div>
                                <div className="arch-box arch-asr">
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <rect x="6" y="4" width="20" height="24" rx="2" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M10 10h12M10 14h8M10 18h10M10 22h6" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">ASR Engine</div>
                                    <div className="arch-detail">Browser / Whisper</div>
                                </div>
                                <div className="arch-arrow">→</div>
                                <div className="arch-box arch-rag special">
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <circle cx="16" cy="16" r="10" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M12 16l3 3 5-6" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">RAG Engine v4.0</div>
                                    <div className="arch-detail">Semantic Matching</div>
                                </div>
                                <div className="arch-arrow">→</div>
                                <div className="arch-box arch-output">
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <rect x="4" y="6" width="24" height="16" rx="2" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M8 14h16M8 18h10" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                                            <rect x="10" y="24" width="12" height="3" rx="1" fill="currentColor" opacity="0.3"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">Live Overlay</div>
                                    <div className="arch-detail">OBS / Stream</div>
                                </div>
                            </div>

                            <div className="arch-secondary">
                                <div className="arch-connector"></div>
                                <div className="arch-row arch-row-secondary">
                                    <div className="arch-box arch-kb">
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M4 6h16M4 10h16M4 14h12M4 18h8" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">Knowledge Base</div>
                                        <div className="arch-detail">Documents, URLs</div>
                                    </div>
                                    <div className="arch-box arch-embed">
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <circle cx="12" cy="12" r="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                                <circle cx="12" cy="12" r="3" fill="currentColor" opacity="0.3"/>
                                                <path d="M12 4v3M12 17v3M4 12h3M17 12h3" stroke="currentColor" strokeWidth="1.5"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">Embeddings</div>
                                        <div className="arch-detail">Vector Search</div>
                                    </div>
                                    <div className="arch-box arch-learn">
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M4 18l4-4 4 4 8-10" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">ASR Learner</div>
                                        <div className="arch-detail">Auto-Improve</div>
                                    </div>
                                    <div className="arch-box arch-analytics">
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <rect x="4" y="14" width="4" height="6" fill="currentColor" opacity="0.3"/>
                                                <rect x="10" y="10" width="4" height="10" fill="currentColor" opacity="0.5"/>
                                                <rect x="16" y="6" width="4" height="14" fill="currentColor" opacity="0.7"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">Analytics</div>
                                        <div className="arch-detail">Insights</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="arch-caption">
                            The v4.0 RAG engine uses vector embeddings for semantic similarity matching,
                            fuzzy detection for typos, and learns from ASR mistakes to improve over time.
                        </div>
                    </section>

                    {/* How To Section */}
                    <section className="info-section howto-section">
                        <h2 className="section-title">How To Use</h2>
                        <p className="section-subtitle">
                            Get started with live captioning in four simple steps
                        </p>

                        <div className="info-grid">
                            <div className="info-card" data-step="1">
                                <h3>Start Captioning</h3>
                                <ul>
                                    <li>Click "Open Control Dashboard"</li>
                                    <li>Choose Browser Mode (fast, needs internet) or Whisper Mode (local, more accurate)</li>
                                    <li>Click "Start Listening" and speak - captions appear instantly</li>
                                    <li>Copy the overlay URL and add to OBS/vMix as a browser source</li>
                                </ul>
                            </div>

                            <div className="info-card" data-step="2">
                                <h3>Configure The Engine</h3>
                                <ul>
                                    <li>Upload meeting agendas or staff directories</li>
                                    <li>AI automatically extracts names, places, and organizations</li>
                                    <li>Review and edit extracted terms</li>
                                    <li>Toggle the engine on to start correcting captions</li>
                                </ul>
                            </div>

                            <div className="info-card" data-step="3">
                                <h3>Record Sessions</h3>
                                <ul>
                                    <li>Click "Start Recording" before your event</li>
                                    <li>All captions are timestamped automatically</li>
                                    <li>After the event, click "Stop Recording"</li>
                                    <li>Export captions as SRT, VTT, TXT, or JSON for archival</li>
                                </ul>
                            </div>

                            <div className="info-card" data-step="4">
                                <h3>Customize Appearance</h3>
                                <ul>
                                    <li>Adjust font size, family, and colors</li>
                                    <li>Position captions (top, middle, bottom)</li>
                                    <li>Control background opacity and text shadows</li>
                                    <li>Add your organization's logo to the overlay</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    {/* FAQ Section */}
                    <section className="info-section faq-section">
                        <h2 className="section-title">Frequently Asked Questions</h2>

                        <div className={`faq-item ${expandedFAQ === 0 ? 'expanded' : ''}`} onClick={() => toggleFAQ(0)}>
                            <div className="faq-question">
                                Do I need an OpenAI API key?
                                <span className="faq-toggle">{expandedFAQ === 0 ? '−' : '+'}</span>
                            </div>
                            {expandedFAQ === 0 && (
                                <div className="faq-answer">
                                    No! The basic captioning features work without any AI. You only need an API key if you want AI-powered features like automatic term extraction from documents or session summaries. You can also use local AI providers like Ollama or LM Studio for free.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 1 ? 'expanded' : ''}`} onClick={() => toggleFAQ(1)}>
                            <div className="faq-question">
                                What's the difference between Browser Mode and Whisper Mode?
                                <span className="faq-toggle">{expandedFAQ === 1 ? '−' : '+'}</span>
                            </div>
                            {expandedFAQ === 1 && (
                                <div className="faq-answer">
                                    <strong>Browser Mode:</strong> Uses your browser's built-in speech recognition (Web Speech API). Fast (~200ms latency) but requires Chrome/Edge and internet connection. Less accurate with proper nouns.<br/><br/>
                                    <strong>Whisper Mode:</strong> Uses OpenAI's Whisper AI model running locally on your computer. More accurate, works offline, but has 2-4 second latency. Requires Python and faster-whisper installation.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 2 ? 'expanded' : ''}`} onClick={() => toggleFAQ(2)}>
                            <div className="faq-question">
                                Can I use this for live streaming?
                                <span className="faq-toggle">{expandedFAQ === 2 ? '−' : '+'}</span>
                            </div>
                            {expandedFAQ === 2 && (
                                <div className="faq-answer">
                                    Yes! The overlay URL can be added to OBS, vMix, or any streaming software that supports browser sources. Captions will appear live on your stream.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 3 ? 'expanded' : ''}`} onClick={() => toggleFAQ(3)}>
                            <div className="faq-question">
                                How do I share my correction engine with other organizations?
                                <span className="faq-toggle">{expandedFAQ === 3 ? '−' : '+'}</span>
                            </div>
                            {expandedFAQ === 3 && (
                                <div className="faq-answer">
                                    Click "Configure Engine" → "Download Engine" to export your correction rules as a JSON file. Other organizations can import this file to instantly get your community's vocabulary. Perfect for sharing between towns or sister organizations.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 4 ? 'expanded' : ''}`} onClick={() => toggleFAQ(4)}>
                            <div className="faq-question">
                                Is my data private?
                                <span className="faq-toggle">{expandedFAQ === 4 ? '−' : '+'}</span>
                            </div>
                            {expandedFAQ === 4 && (
                                <div className="faq-answer">
                                    <strong>Browser Mode:</strong> Audio is sent to Google/Microsoft's servers for transcription.<br/>
                                    <strong>Whisper Mode:</strong> Everything stays on your computer. No data leaves your machine.<br/>
                                    <strong>AI Features:</strong> If using OpenAI, document text is sent for processing. If using Ollama/LM Studio, everything stays local.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 5 ? 'expanded' : ''}`} onClick={() => toggleFAQ(5)}>
                            <div className="faq-question">
                                What file formats can I export?
                                <span className="faq-toggle">{expandedFAQ === 5 ? '−' : '+'}</span>
                            </div>
                            {expandedFAQ === 5 && (
                                <div className="faq-answer">
                                    Sessions can be exported as SRT (subtitles), VTT (web video), TXT (plain transcript), or JSON (full data including corrections and timestamps). Perfect for archival or post-production editing.
                                </div>
                            )}
                        </div>
                    </section>

                    {/* Values Section */}
                    <section className="info-section values-section">
                        <h2 className="section-title">Our Values</h2>
                        <p className="section-subtitle">
                            Community Captioner is built on principles of accessibility, openness, and empowerment
                        </p>

                        <div className="info-grid">
                            <div className="info-card">
                                <h3>Accessibility First</h3>
                                <p>
                                    Everyone deserves access to information. Captioning shouldn't be a luxury for those who can afford expensive equipment. We're democratizing accessibility technology for community organizations worldwide.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Truly Open Source</h3>
                                <p>
                                    No vendor lock-in, no hidden costs, no paywalls. Our code is open (CC BY-SA 4.0), our data stays with you, and you can modify everything to fit your needs. This is your tool, not ours.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Community-Powered</h3>
                                <p>
                                    Built by community media for community media. We understand your workflows, budgets, and challenges because we live them. Share your correction engines, help each other, lift all boats together.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Privacy by Design</h3>
                                <p>
                                    Your content, your control. Run everything locally with Whisper mode. Use local AI providers. No telemetry, no tracking, no data mining. Government meetings and sensitive content stay private.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Human + AI Collaboration</h3>
                                <p>
                                    AI isn't magic and it's not perfect. We combine the speed of AI with human knowledge of local communities. You teach the engine your vocabulary - it handles the repetitive corrections.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Legal Compliance Made Simple</h3>
                                <p>
                                    FCC CVAA requirements and state captioning laws apply to you. Commercial solutions cost tens of thousands. We provide the same compliance for free, because accessibility is a right, not a privilege.
                                </p>
                            </div>
                        </div>

                        <div style={{textAlign: 'center', marginTop: '48px'}}>
                            <button className="cta-btn cta-btn-secondary" onClick={onShowAbout}>
                                Learn More About the Technology + Design Philosophy
                            </button>
                        </div>
                    </section>

                    {/* Footer */}
                    <footer className="site-footer">
                        <div className="footer-content">
                            <div className="footer-text">
                                A <a href="https://community.weirdmachine.org" target="_blank" rel="noopener noreferrer">Community AI Project</a> from <a href="https://brooklineinteractive.org" target="_blank" rel="noopener noreferrer">Brookline Interactive Group</a> in partnership with <a href="https://neighborhoodai.org" target="_blank" rel="noopener noreferrer">Neighborhood AI</a>
                                <br/>
                                Designed and developed by <a href="https://weirdmachine.org" target="_blank" rel="noopener noreferrer">Stephen Walter</a> + AI
                            </div>

                            <div className="footer-logos">
                                <img src="/big-logo.png" alt="Brookline Interactive Group" className="footer-logo" />
                                <a href="https://weirdmachine.org" target="_blank" rel="noopener noreferrer">
                                    <img src="/weird-machine-logo.png" alt="Weird Machine" className="footer-logo" style={{height: '50px'}} />
                                </a>
                            </div>

                            <div className="footer-links">
                                <a href="https://github.com/weirdmachine-org/community-captioner-v2" target="_blank" rel="noopener noreferrer" className="footer-icon-link" title="View on GitHub">
                                    <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                </a>
                            </div>

                            <div className="footer-license">
                                Licensed under CC BY-SA 4.0 — Free to use, modify, and share with attribution
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        function Dashboard({ onBack, onConfigureEngine, language, setLanguage, t }) {
            const [mode, setMode] = useState('browser');
            const [caption, setCaption] = useState('');
            const [rawCaption, setRawCaption] = useState('');
            const [corrections, setCorrections] = useState([]);
            const [recording, setRecording] = useState(false);
            const [sessionName, setSessionName] = useState('');
            const [showEnginePanel, setShowEnginePanel] = useState(false);
            const [engineEnabled, setEngineEnabled] = useState(false);
            const [whisperRunning, setWhisperRunning] = useState(false);
            const [browserListening, setBrowserListening] = useState(false);
            const [localIP, setLocalIP] = useState(window.location.hostname);
            const port = window.location.port || '8080';

            // Caption styling state
            const [fontSize, setFontSize] = useState(32);
            const [lineHeight, setLineHeight] = useState(1.4);
            const [maxWidth, setMaxWidth] = useState(90);
            const [fontFamily, setFontFamily] = useState('sans-serif');
            const [textColor, setTextColor] = useState('#FFFFFF');
            const [bgColor, setBgColor] = useState('#000000');
            const [bgOpacity, setBgOpacity] = useState(0.8);

            // Whisper state
            const [whisperDevices, setWhisperDevices] = useState([]);
            const [selectedDevice, setSelectedDevice] = useState('');
            const [selectedModel, setSelectedModel] = useState('base');
            const [modelLoading, setModelLoading] = useState(false);
            const [modelLoaded, setModelLoaded] = useState(false);

            // Session export state
            const [showExports, setShowExports] = useState(false);
            const [sessionStats, setSessionStats] = useState(null);

            // Speech recognition ref
            const recognitionRef = useRef(null);

            useEffect(() => {
                // Poll for caption and status updates
                const interval = setInterval(() => {
                    fetch('/api/caption')
                        .then(r => r.json())
                        .then(data => {
                            setCaption(data.caption || '');
                            setRawCaption(data.raw_caption || '');
                            setCorrections(data.corrections || []);
                            setRecording(data.session?.recording || false);
                            setWhisperRunning(data.whisper_running || false);
                        })
                        .catch(err => console.error('Error fetching caption:', err));

                    fetch('/api/engine/status')
                        .then(r => r.json())
                        .then(data => setEngineEnabled(data.enabled))
                        .catch(err => console.error('Error fetching engine status:', err));
                }, 500);

                // Fetch Whisper devices on mount
                fetch('/api/whisper/devices')
                    .then(r => r.json())
                    .then(data => {
                        if (data.devices) {
                            setWhisperDevices(data.devices);
                            if (data.devices.length > 0) {
                                setSelectedDevice(data.devices[0].id);
                            }
                        }
                    })
                    .catch(err => console.error('Error fetching devices:', err));

                return () => clearInterval(interval);
            }, []);

            const updateCaptionSettings = () => {
                const settings = {
                    fontSize,
                    lineHeight,
                    maxWidth,
                    fontFamily,
                    textColor,
                    backgroundColor: bgColor,
                    backgroundOpacity: bgOpacity
                };

                fetch('/api/caption', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ settings })
                })
                .catch(err => console.error('Error updating settings:', err));
            };

            useEffect(() => {
                updateCaptionSettings();
            }, [fontSize, lineHeight, maxWidth, fontFamily, textColor, bgColor, bgOpacity]);

            const startBrowserCaptions = () => {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    alert('Speech recognition not supported in this browser. Please use Chrome or Edge.');
                    return;
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    const textToSend = finalTranscript || interimTranscript;
                    if (textToSend) {
                        fetch('/api/caption', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                caption: textToSend,
                                settings: {
                                    fontSize,
                                    lineHeight,
                                    maxWidth,
                                    fontFamily,
                                    textColor,
                                    backgroundColor: bgColor,
                                    backgroundOpacity: bgOpacity
                                }
                            })
                        });
                    }
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    setBrowserListening(false);
                };

                recognition.onend = () => {
                    if (browserListening) {
                        recognition.start(); // Auto-restart
                    }
                };

                recognition.start();
                recognitionRef.current = recognition;
                setBrowserListening(true);
            };

            const stopBrowserCaptions = () => {
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                    recognitionRef.current = null;
                }
                setBrowserListening(false);
            };

            const loadWhisperModel = () => {
                setModelLoading(true);
                fetch('/api/whisper/load', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model: selectedModel })
                })
                .then(r => r.json())
                .then(data => {
                    setModelLoading(false);
                    if (data.status === 'ok') {
                        setModelLoaded(true);
                    }
                })
                .catch(err => {
                    console.error('Error loading model:', err);
                    setModelLoading(false);
                });
            };

            const startWhisper = () => {
                fetch('/api/whisper/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ device_id: selectedDevice })
                })
                .catch(err => console.error('Error starting Whisper:', err));
            };

            const stopWhisper = () => {
                fetch('/api/whisper/stop', { method: 'POST' })
                .catch(err => console.error('Error stopping Whisper:', err));
            };

            const toggleRecording = () => {
                if (recording) {
                    fetch('/api/session/stop', { method: 'POST' })
                        .then(() => {
                            // Fetch session stats for export
                            fetch('/api/session/status')
                                .then(r => r.json())
                                .then(data => {
                                    setSessionStats(data);
                                    setShowExports(true);
                                });
                        });
                } else {
                    const name = sessionName || `Session ${new Date().toLocaleString()}`;
                    fetch('/api/session/start', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name })
                    });
                    setShowExports(false);
                }
            };

            const openOverlay = () => {
                window.open('/overlay.html', '_blank', 'width=1200,height=200');
            };

            const toggleEngine = () => {
                fetch('/api/engine/enable', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: !engineEnabled })
                })
                .then(r => r.json())
                .then(data => setEngineEnabled(data.enabled));
            };

            const uploadEngine = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const engineData = JSON.parse(e.target.result);

                        fetch('/api/engine/import', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(engineData)
                        })
                        .then(r => r.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert(`Engine uploaded successfully! Loaded ${data.terms_count || 0} terms.`);
                                setEngineEnabled(true);
                            } else {
                                alert('Error uploading engine: ' + (data.error || 'Unknown error'));
                            }
                        })
                        .catch(err => {
                            alert('Failed to upload engine: ' + err.message);
                        });
                    } catch (err) {
                        alert('Invalid engine file: ' + err.message);
                    }
                };
                reader.readAsText(file);

                // Reset input so same file can be uploaded again
                event.target.value = '';
            };

            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                            <h1 className="dashboard-title">{t('Control Dashboard')}</h1>
                            <img src="/big-logo.png" alt="BIG" style={{height: '50px', marginTop: '4px'}} />
                        </div>
                        <button className="back-btn" onClick={onBack}>← {t('Back to Home')}</button>
                    </div>

                    <div className="dashboard-grid">
                        <div className="main-column">
                            <div className="preview-section" style={{
                                fontSize: `${fontSize}px`,
                                lineHeight: lineHeight
                            }}>
                                <div className="preview-label">{t('Live Preview')}</div>
                                <div className="preview-badges">
                                    <div className="preview-badge mode">{mode.toUpperCase()}</div>
                                    {browserListening && <div className="preview-badge listening">LISTENING</div>}
                                    {whisperRunning && <div className="preview-badge whisper">WHISPER</div>}
                                    {engineEnabled && <div className="preview-badge engine">ENGINE ON</div>}
                                    {corrections.length > 0 && (
                                        <div className="preview-badge corrections">{corrections.length} FIXES</div>
                                    )}
                                </div>
                                <div
                                    className={`preview-text ${!caption ? 'empty' : ''}`}
                                    style={{
                                        fontSize: `${fontSize}px`,
                                        lineHeight: lineHeight,
                                        maxWidth: `${maxWidth}%`,
                                        fontFamily: fontFamily,
                                        color: textColor
                                    }}
                                >
                                    {caption || 'Captions will appear here...'}
                                </div>
                            </div>

                            <div className="card">
                                <h2 className="card-title">{t('Captioning Mode')}</h2>
                                <div className="mode-selector">
                                    <button
                                        className={`mode-btn ${mode === 'browser' ? 'active' : ''}`}
                                        onClick={() => setMode('browser')}
                                    >
                                        {t('Browser Speech')}
                                    </button>
                                    <button
                                        className={`mode-btn whisper ${mode === 'whisper' ? 'active whisper' : ''}`}
                                        onClick={() => setMode('whisper')}
                                    >
                                        {t('Whisper AI')}
                                    </button>
                                </div>

                                {mode === 'browser' && (
                                    <div>
                                        <button
                                            className="btn-large btn-primary"
                                            onClick={browserListening ? stopBrowserCaptions : startBrowserCaptions}
                                        >
                                            {browserListening ? t('Stop Browser Captions') : t('Start Browser Captions')}
                                        </button>
                                        <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '12px'}}>
                                            Uses Chrome/Edge speech recognition. Requires internet connection.
                                        </p>
                                    </div>
                                )}

                                {mode === 'whisper' && (
                                    <div>
                                        <div className="setting-group">
                                            <label className="setting-label">Audio Device</label>
                                            <select
                                                className="setting-input"
                                                value={selectedDevice}
                                                onChange={(e) => setSelectedDevice(e.target.value)}
                                            >
                                                {whisperDevices.map(device => (
                                                    <option key={device.id} value={device.id}>
                                                        {device.name}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>

                                        <div className="setting-group">
                                            <label className="setting-label">Model Size</label>
                                            <select
                                                className="setting-input"
                                                value={selectedModel}
                                                onChange={(e) => setSelectedModel(e.target.value)}
                                            >
                                                <option value="tiny">Tiny (fastest, least accurate)</option>
                                                <option value="base">Base (recommended)</option>
                                                <option value="small">Small (slower, more accurate)</option>
                                                <option value="medium">Medium (slowest, most accurate)</option>
                                            </select>
                                        </div>

                                        {!modelLoaded && (
                                            <button
                                                className="btn-large btn-primary"
                                                onClick={loadWhisperModel}
                                                disabled={modelLoading}
                                            >
                                                {modelLoading ? 'Loading Model...' : 'Load Whisper Model'}
                                            </button>
                                        )}

                                        {modelLoaded && (
                                            <button
                                                className="btn-large btn-primary"
                                                onClick={whisperRunning ? stopWhisper : startWhisper}
                                            >
                                                {whisperRunning ? 'Stop Whisper' : 'Start Whisper'}
                                            </button>
                                        )}

                                        <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '12px'}}>
                                            Local AI transcription. Requires faster-whisper package.
                                        </p>
                                    </div>
                                )}
                            </div>

                            <div className="card">
                                <h2 className="card-title">
                                    AI Caption Engine
                                </h2>
                                <div className="toggle-setting">
                                    <span className="toggle-label">
                                        {engineEnabled ? 'Engine Active' : 'Engine Disabled'}
                                    </span>
                                    <div
                                        className={`toggle-switch ${engineEnabled ? 'on' : ''}`}
                                        onClick={toggleEngine}
                                    ></div>
                                </div>

                                {corrections.length > 0 && (
                                    <div style={{marginTop: '16px', padding: '14px', background: 'var(--bg-sage-light)', borderRadius: 'var(--radius-sm)'}}>
                                        <div style={{fontSize: '12px', fontWeight: '700', marginBottom: '8px', color: 'var(--text-medium)'}}>
                                            RECENT CORRECTIONS
                                        </div>
                                        {corrections.map((c, i) => (
                                            <div key={i} style={{fontSize: '14px', marginBottom: '4px'}}>
                                                <span style={{color: '#DC2626', textDecoration: 'line-through'}}>{c.from}</span>
                                                {' → '}
                                                <span style={{color: '#00A676', fontWeight: '600'}}>{c.to}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                <div style={{display: 'flex', gap: '12px', marginTop: '16px', flexWrap: 'wrap'}}>
                                    <button
                                        className="btn-large btn-outline"
                                        style={{flex: '1', minWidth: '140px'}}
                                        onClick={() => setShowEnginePanel(!showEnginePanel)}
                                    >
                                        {showEnginePanel ? '▼ Hide Engine Panel' : '▶ Show Engine Panel'}
                                    </button>
                                    <label className="btn-large btn-outline" style={{flex: '1', minWidth: '140px', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'}}>
                                        {t('Upload Engine')}
                                        <input
                                            type="file"
                                            accept=".json"
                                            onChange={uploadEngine}
                                            style={{display: 'none'}}
                                        />
                                    </label>
                                </div>
                            </div>
                        </div>

                        {/* Collapsible Engine Panel */}
                        {showEnginePanel && (
                            <div className="card" style={{gridColumn: '1 / -1', marginTop: '20px', border: '2px solid var(--purple-accent)'}}>
                                <EngineWizardInline onClose={() => setShowEnginePanel(false)} />
                            </div>
                        )}

                        <div className="sidebar-column">
                            <div className="card">
                                <h2 className="card-title">Live Overlay</h2>
                                <button className="btn-large btn-primary" onClick={openOverlay}>
                                    Open Overlay Window
                                </button>

                                <div style={{marginTop: '16px'}}>
                                    <div className="url-display">
                                        <div className="url-label">This Computer</div>
                                        <div className="url-text" style={{fontSize: '12px'}}>
                                            http://localhost:{port}/overlay.html
                                        </div>
                                    </div>

                                    <div className="url-display" style={{marginTop: '12px'}}>
                                        <div className="url-label">Same Network (LAN)</div>
                                        <div className="url-text" style={{fontSize: '12px'}}>
                                            http://{localIP}:{port}/overlay.html
                                        </div>
                                    </div>

                                    <div className="url-display" style={{marginTop: '12px', background: 'rgba(138, 99, 163, 0.08)', borderColor: 'var(--purple-accent)'}}>
                                        <div className="url-label" style={{color: 'var(--purple-accent)'}}>Internet (Cloud Mode)</div>
                                        <div className="url-text" style={{fontSize: '11px', color: 'var(--text-medium)'}}>
                                            Requires cloud-server.py with public IP or tunnel
                                        </div>
                                    </div>
                                </div>

                                <p style={{fontSize: '12px', color: 'var(--text-medium)', marginTop: '12px', lineHeight: '1.5'}}>
                                    Use these URLs in OBS Browser Source, vMix, or streaming software.
                                </p>
                            </div>

                            <div className="card">
                                <h2 className="card-title">Session Recording</h2>
                                <div className="rec-indicator" style={{marginBottom: '16px'}}>
                                    <div className={`rec-indicator ${recording ? 'recording' : ''}`}>
                                        <div className="rec-dot"></div>
                                        {recording ? 'Recording' : 'Not Recording'}
                                    </div>
                                </div>

                                {!recording && !showExports && (
                                    <div className="setting-group">
                                        <label className="setting-label">Session Name</label>
                                        <input
                                            type="text"
                                            className="setting-input"
                                            placeholder="e.g., Select Board Meeting"
                                            value={sessionName}
                                            onChange={(e) => setSessionName(e.target.value)}
                                        />
                                    </div>
                                )}

                                <button
                                    className={`btn-large ${recording ? 'btn-danger' : 'btn-primary'}`}
                                    onClick={toggleRecording}
                                >
                                    {recording ? 'Stop Recording' : 'Start Recording'}
                                </button>

                                {recording && (
                                    <div style={{marginTop: '16px', padding: '14px', background: '#FEE2E2', borderRadius: 'var(--radius-sm)', fontSize: '13px', color: '#991B1B'}}>
                                        All captions and corrections are being saved.
                                        Export available after stopping.
                                    </div>
                                )}

                                {showExports && sessionStats && (
                                    <div style={{marginTop: '16px'}}>
                                        <div style={{padding: '14px', background: 'var(--bg-sage-light)', borderRadius: 'var(--radius-sm)', marginBottom: '12px'}}>
                                            <div style={{fontSize: '12px', fontWeight: '700', color: 'var(--text-medium)', marginBottom: '8px'}}>
                                                SESSION STATS
                                            </div>
                                            <div style={{fontSize: '14px', marginBottom: '4px'}}>
                                                Captions: {sessionStats.caption_count || 0}
                                            </div>
                                            <div style={{fontSize: '14px', marginBottom: '4px'}}>
                                                Corrections: {sessionStats.correction_count || 0}
                                            </div>
                                        </div>

                                        <div className="export-buttons">
                                            <a href="/api/session/export/srt" className="export-btn" download>
                                                Export SRT
                                            </a>
                                            <a href="/api/session/export/vtt" className="export-btn" download>
                                                Export VTT
                                            </a>
                                            <a href="/api/session/export/txt" className="export-btn" download>
                                                Export TXT
                                            </a>
                                            <a href="/api/session/export/json" className="export-btn" download>
                                                Export JSON
                                            </a>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="card">
                                <h2 className="card-title">Caption Styling</h2>

                                <div className="setting-group">
                                    <label className="setting-label">
                                        Font Size
                                        <span className="setting-value">{fontSize}px</span>
                                    </label>
                                    <input
                                        type="range"
                                        className="setting-slider"
                                        min="24"
                                        max="72"
                                        value={fontSize}
                                        onChange={(e) => setFontSize(parseInt(e.target.value))}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">
                                        Line Height
                                        <span className="setting-value">{lineHeight}</span>
                                    </label>
                                    <input
                                        type="range"
                                        className="setting-slider"
                                        min="1.0"
                                        max="2.0"
                                        step="0.1"
                                        value={lineHeight}
                                        onChange={(e) => setLineHeight(parseFloat(e.target.value))}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">
                                        Max Width
                                        <span className="setting-value">{maxWidth}%</span>
                                    </label>
                                    <input
                                        type="range"
                                        className="setting-slider"
                                        min="50"
                                        max="100"
                                        value={maxWidth}
                                        onChange={(e) => setMaxWidth(parseInt(e.target.value))}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Font Family</label>
                                    <select
                                        className="setting-input"
                                        value={fontFamily}
                                        onChange={(e) => setFontFamily(e.target.value)}
                                    >
                                        <option value="sans-serif">Sans Serif</option>
                                        <option value="serif">Serif</option>
                                        <option value="monospace">Monospace</option>
                                        <option value="'Arial', sans-serif">Arial</option>
                                        <option value="'Helvetica', sans-serif">Helvetica</option>
                                        <option value="'Verdana', sans-serif">Verdana</option>
                                    </select>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Text Color</label>
                                    <div className="color-input-group">
                                        <input
                                            type="text"
                                            className="setting-input"
                                            value={textColor}
                                            onChange={(e) => setTextColor(e.target.value)}
                                        />
                                        <input
                                            type="color"
                                            className="color-input"
                                            value={textColor}
                                            onChange={(e) => setTextColor(e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Background Color</label>
                                    <div className="color-input-group">
                                        <input
                                            type="text"
                                            className="setting-input"
                                            value={bgColor}
                                            onChange={(e) => setBgColor(e.target.value)}
                                        />
                                        <input
                                            type="color"
                                            className="color-input"
                                            value={bgColor}
                                            onChange={(e) => setBgColor(e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">
                                        Background Opacity
                                        <span className="setting-value">{Math.round(bgOpacity * 100)}%</span>
                                    </label>
                                    <input
                                        type="range"
                                        className="setting-slider"
                                        min="0"
                                        max="1"
                                        step="0.1"
                                        value={bgOpacity}
                                        onChange={(e) => setBgOpacity(parseFloat(e.target.value))}
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function EngineWizardInline({ onClose }) {
            const [engineStats, setEngineStats] = useState(null);
            const [newTerm, setNewTerm] = useState({ term: '', category: 'person', aliases: '' });
            const [testText, setTestText] = useState('');
            const [testResult, setTestResult] = useState('');
            const [aiConfig, setAiConfig] = useState(null);
            const [recentTerms, setRecentTerms] = useState([]);

            // Load AI config and engine stats
            useEffect(() => {
                fetch('/api/ai/config')
                    .then(r => r.json())
                    .then(data => setAiConfig(data));

                loadEngineStats();
                const interval = setInterval(loadEngineStats, 2000);
                return () => clearInterval(interval);
            }, []);

            const loadEngineStats = () => {
                fetch('/api/engine/status')
                    .then(r => r.json())
                    .then(data => {
                        setEngineStats(data);
                    });

                fetch('/api/engine/terms')
                    .then(r => r.json())
                    .then(data => {
                        if (data.terms) {
                            const termsList = Object.entries(data.terms)
                                .map(([key, val]) => ({ key, ...val }))
                                .slice(0, 10);
                            setRecentTerms(termsList);
                        }
                    });
            };

            const isAILocal = aiConfig && (
                aiConfig.provider === 'ollama' ||
                aiConfig.provider === 'lmstudio' ||
                (aiConfig.provider === 'custom' && (aiConfig.custom_base_url.includes('localhost') || aiConfig.custom_base_url.includes('127.0.0.1')))
            );

            const addTerm = () => {
                if (!newTerm.term) return;

                const aliasArray = newTerm.aliases.split(',').map(a => a.trim()).filter(a => a);

                fetch('/api/engine/term', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        term: newTerm.term,
                        category: newTerm.category,
                        aliases: aliasArray
                    })
                })
                .then(r => r.json())
                .then(data => {
                    setNewTerm({ term: '', category: 'person', aliases: '' });
                    loadEngineStats();
                    alert('Term added successfully!');
                });
            };

            const loadBrooklineDefaults = () => {
                if (confirm('Load Brookline, MA template? This will add default terms for Brookline government.')) {
                    fetch('/api/engine/defaults', { method: 'POST' })
                        .then(r => r.json())
                        .then(data => {
                            alert('Brookline defaults loaded!');
                            loadEngineStats();
                        });
                }
            };

            const testCorrection = () => {
                fetch(`/api/engine/test?text=${encodeURIComponent(testText)}`)
                    .then(r => r.json())
                    .then(data => {
                        setTestResult(data.corrected || testText);
                    });
            };

            const exportEngine = () => {
                window.open('/api/engine/export', '_blank');
            };

            const uploadEngine = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const engineData = JSON.parse(e.target.result);
                        fetch('/api/engine/import', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(engineData)
                        })
                        .then(r => r.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert(`Engine uploaded! Loaded ${data.terms_count || 0} terms.`);
                                loadEngineStats();
                            } else {
                                alert('Error: ' + (data.error || 'Unknown error'));
                            }
                        });
                    } catch (err) {
                        alert('Invalid engine file: ' + err.message);
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            return (
                <div>
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px'}}>
                        <h2 style={{fontSize: '24px', fontWeight: '700', color: 'var(--text-dark)', margin: 0}}>
                            AI Caption Engine Dashboard
                        </h2>
                        <button onClick={onClose} className="btn-large btn-outline">
                            Close ✕
                        </button>
                    </div>

                    <div style={{padding: '0'}}>
                        {/* Stats Overview */}
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginBottom: '24px'}}>
                            <div className="card" style={{textAlign: 'center', padding: '20px', background: 'var(--bg-sage-light)', border: 'none'}}>
                                <div style={{fontSize: '36px', fontWeight: '700', color: 'var(--sage-primary)'}}>
                                    {engineStats ? engineStats.term_count : '...'}
                                </div>
                                <div style={{fontSize: '14px', color: 'var(--text-medium)', fontWeight: '600'}}>Total Terms</div>
                            </div>
                            <div className="card" style={{textAlign: 'center', padding: '20px', background: 'var(--bg-sage-light)', border: 'none'}}>
                                <div style={{fontSize: '36px', fontWeight: '700', color: 'var(--purple-accent)'}}>
                                    {engineStats ? engineStats.correction_count : '...'}
                                </div>
                                <div style={{fontSize: '14px', color: 'var(--text-medium)', fontWeight: '600'}}>Corrections Made</div>
                            </div>
                            <div className="card" style={{textAlign: 'center', padding: '20px', background: 'var(--bg-sage-light)', border: 'none'}}>
                                <div style={{fontSize: '36px', fontWeight: '700', color: engineStats?.enabled ? 'var(--green-bright)' : 'var(--text-light)'}}>
                                    {engineStats?.enabled ? 'ON' : 'OFF'}
                                </div>
                                <div style={{fontSize: '14px', color: 'var(--text-medium)', fontWeight: '600'}}>Engine Status</div>
                            </div>
                        </div>

                        {/* Compact Grid */}
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '16px'}}>
                            {/* Quick Actions */}
                            <div className="card" style={{background: 'white'}}>
                                <h3 style={{fontSize: '18px', fontWeight: '600', marginBottom: '12px'}}>Quick Actions</h3>
                                <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                                    <button className="btn-large btn-primary" style={{fontSize: '14px', padding: '10px'}} onClick={loadBrooklineDefaults}>
                                        Load Brookline Template
                                    </button>
                                    <button className="btn-large btn-outline" style={{fontSize: '14px', padding: '10px'}} onClick={exportEngine}>
                                        Download Current Engine
                                    </button>
                                </div>
                            </div>

                            {/* Add Term */}
                            <div className="card" style={{background: 'white'}}>
                                <h3 style={{fontSize: '18px', fontWeight: '600', marginBottom: '12px'}}>Add Term</h3>
                                <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        placeholder="Term (e.g., Bernard Greene)"
                                        value={newTerm.term}
                                        onChange={(e) => setNewTerm({...newTerm, term: e.target.value})}
                                        style={{fontSize: '14px', padding: '8px'}}
                                    />
                                    <select
                                        className="setting-input"
                                        value={newTerm.category}
                                        onChange={(e) => setNewTerm({...newTerm, category: e.target.value})}
                                        style={{fontSize: '14px', padding: '8px'}}
                                    >
                                        <option value="person">Person</option>
                                        <option value="place">Place</option>
                                        <option value="organization">Organization</option>
                                    </select>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        placeholder="Aliases (comma-separated)"
                                        value={newTerm.aliases}
                                        onChange={(e) => setNewTerm({...newTerm, aliases: e.target.value})}
                                        style={{fontSize: '14px', padding: '8px'}}
                                    />
                                    <button className="btn-large btn-primary" style={{fontSize: '14px', padding: '10px'}} onClick={addTerm}>
                                        Add Term
                                    </button>
                                </div>
                            </div>

                            {/* Test Engine */}
                            <div className="card" style={{background: 'white', gridColumn: 'span 2'}}>
                                <h3 style={{fontSize: '18px', fontWeight: '600', marginBottom: '12px'}}>Test Corrections</h3>
                                <div style={{display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '12px', alignItems: 'center'}}>
                                    <textarea
                                        className="setting-input"
                                        rows="3"
                                        placeholder="Type text to test..."
                                        value={testText}
                                        onChange={(e) => setTestText(e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                    <button className="btn-large btn-primary" style={{fontSize: '14px', padding: '10px'}} onClick={testCorrection}>
                                        Test →
                                    </button>
                                    <div style={{padding: '12px', background: 'var(--bg-sage-light)', borderRadius: '8px', minHeight: '78px', fontSize: '14px'}}>
                                        {testResult || 'Result will appear here...'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function EngineWizard({ onBack, language, setLanguage, t }) {
            const [engineStats, setEngineStats] = useState(null);
            const [newTerm, setNewTerm] = useState({ term: '', category: 'person', aliases: '' });
            const [testText, setTestText] = useState('');
            const [testResult, setTestResult] = useState('');
            const [aiConfig, setAiConfig] = useState(null);
            const [recentTerms, setRecentTerms] = useState([]);

            // Load AI config and engine stats
            useEffect(() => {
                fetch('/api/ai/config')
                    .then(r => r.json())
                    .then(data => setAiConfig(data));

                loadEngineStats();
                const interval = setInterval(loadEngineStats, 2000);
                return () => clearInterval(interval);
            }, []);

            const loadEngineStats = () => {
                fetch('/api/engine/status')
                    .then(r => r.json())
                    .then(data => {
                        setEngineStats(data);
                    });

                fetch('/api/engine/terms')
                    .then(r => r.json())
                    .then(data => {
                        if (data.terms) {
                            const termsList = Object.entries(data.terms)
                                .map(([key, val]) => ({ key, ...val }))
                                .slice(0, 10);
                            setRecentTerms(termsList);
                        }
                    });
            };

            const isAILocal = aiConfig && (
                aiConfig.provider === 'ollama' ||
                aiConfig.provider === 'lmstudio' ||
                (aiConfig.provider === 'custom' && (aiConfig.custom_base_url.includes('localhost') || aiConfig.custom_base_url.includes('127.0.0.1')))
            );

            const addTerm = () => {
                if (!newTerm.term) return;

                const aliasArray = newTerm.aliases.split(',').map(a => a.trim()).filter(a => a);

                fetch('/api/engine/term', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        term: newTerm.term,
                        category: newTerm.category,
                        aliases: aliasArray
                    })
                })
                .then(r => r.json())
                .then(data => {
                    setNewTerm({ term: '', category: 'person', aliases: '' });
                    loadEngineStats();
                    alert('Term added successfully!');
                });
            };

            const loadBrooklineDefaults = () => {
                if (confirm('Load Brookline, MA template? This will add default terms for Brookline government.')) {
                    fetch('/api/engine/defaults', { method: 'POST' })
                        .then(r => r.json())
                        .then(data => {
                            alert('Brookline defaults loaded!');
                            loadEngineStats();
                        });
                }
            };

            const testCorrection = () => {
                fetch(`/api/engine/test?text=${encodeURIComponent(testText)}`)
                    .then(r => r.json())
                    .then(data => {
                        setTestResult(data.corrected || testText);
                    });
            };

            const exportEngine = () => {
                window.open('/api/engine/export', '_blank');
            };

            const uploadEngine = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const engineData = JSON.parse(e.target.result);
                        fetch('/api/engine/import', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(engineData)
                        })
                        .then(r => r.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert(`Engine uploaded! Loaded ${data.terms_count || 0} terms.`);
                                loadEngineStats();
                            } else {
                                alert('Error: ' + (data.error || 'Unknown error'));
                            }
                        });
                    } catch (err) {
                        alert('Invalid engine file: ' + err.message);
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <h1 className="dashboard-title">{t('AI Caption Engine')}</h1>
                        <button className="back-btn" onClick={onBack}>← {t('Back to Home')}</button>
                    </div>

                    <div style={{padding: '0 24px 24px'}}>
                        {/* Stats Overview */}
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginBottom: '24px'}}>
                            <div className="card" style={{textAlign: 'center', padding: '20px'}}>
                                <div style={{fontSize: '36px', fontWeight: '700', color: 'var(--sage-primary)'}}>
                                    {engineStats ? engineStats.term_count : '...'}
                                </div>
                                <div style={{fontSize: '14px', color: 'var(--text-medium)', fontWeight: '600'}}>{t('Total Terms')}</div>
                            </div>
                            <div className="card" style={{textAlign: 'center', padding: '20px'}}>
                                <div style={{fontSize: '36px', fontWeight: '700', color: 'var(--purple-accent)'}}>
                                    {engineStats ? engineStats.correction_count : '...'}
                                </div>
                                <div style={{fontSize: '14px', color: 'var(--text-medium)', fontWeight: '600'}}>{t('Corrections Made')}</div>
                            </div>
                            <div className="card" style={{textAlign: 'center', padding: '20px'}}>
                                <div style={{fontSize: '36px', fontWeight: '700', color: engineStats?.enabled ? 'var(--green-bright)' : 'var(--text-light)'}}>
                                    {engineStats?.enabled ? 'ON' : 'OFF'}
                                </div>
                                <div style={{fontSize: '14px', color: 'var(--text-medium)', fontWeight: '600'}}>{t('Engine Status')}</div>
                            </div>
                        </div>

                        {/* Main Grid */}
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '20px'}}>
                            {/* Quick Start Templates */}
                            <div className="card">
                                <h2 className="card-title">Quick Start</h2>
                                <p style={{fontSize: '14px', color: 'var(--text-medium)', marginBottom: '16px'}}>
                                    Load a pre-built template or upload an existing engine to get started quickly.
                                </p>
                                <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                                    <button className="btn-large btn-primary" onClick={loadBrooklineDefaults}>
                                        Load Brookline Template
                                    </button>
                                    <label className="btn-large btn-outline" style={{display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'}}>
                                        Upload Engine JSON
                                        <input type="file" accept=".json" onChange={uploadEngine} style={{display: 'none'}} />
                                    </label>
                                    <button className="btn-large btn-outline" onClick={exportEngine}>
                                        Download Current Engine
                                    </button>
                                </div>
                            </div>

                            {/* Manual Term Entry */}
                            <div className="card">
                                <h2 className="card-title">Add Term Manually</h2>
                                <p style={{fontSize: '14px', color: 'var(--text-medium)', marginBottom: '16px'}}>
                                    Fine-tune your engine by adding individual terms, names, and places.
                                </p>
                                <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                                    <div className="setting-group">
                                        <label className="setting-label">Term</label>
                                        <input
                                            type="text"
                                            className="setting-input"
                                            placeholder="e.g., Bernard Greene"
                                            value={newTerm.term}
                                            onChange={(e) => setNewTerm({...newTerm, term: e.target.value})}
                                        />
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">Category</label>
                                        <select
                                            className="setting-input"
                                            value={newTerm.category}
                                            onChange={(e) => setNewTerm({...newTerm, category: e.target.value})}
                                        >
                                            <option value="person">Person</option>
                                            <option value="place">Place</option>
                                            <option value="organization">Organization</option>
                                        </select>
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">Aliases (comma-separated)</label>
                                        <input
                                            type="text"
                                            className="setting-input"
                                            placeholder="e.g., bernard green, bernie greene"
                                            value={newTerm.aliases}
                                            onChange={(e) => setNewTerm({...newTerm, aliases: e.target.value})}
                                        />
                                    </div>
                                    <button className="btn-large btn-primary" onClick={addTerm}>
                                        Add Term
                                    </button>
                                </div>
                            </div>

                            {/* AI Document Extraction */}
                            <div className="card">
                                <h2 className="card-title">Extract from Document</h2>
                                <p style={{fontSize: '14px', color: 'var(--text-medium)', marginBottom: '16px'}}>
                                    Paste text from agendas, rosters, or directories. AI extracts names automatically.
                                </p>
                                {(!aiConfig || !aiConfig.active) && (
                                    <div style={{padding: '16px', background: '#FEF3C7', borderRadius: '8px', marginBottom: '12px'}}>
                                        <p style={{fontSize: '13px', color: 'var(--text-dark)'}}>
                                            Configure AI provider in AI Settings to enable extraction.
                                        </p>
                                    </div>
                                )}
                                <div className="setting-group">
                                    <label className="setting-label">Paste Document Text</label>
                                    <textarea
                                        className="setting-input"
                                        rows="6"
                                        placeholder="Paste meeting agendas, staff directories, etc..."
                                        id="documentText"
                                        disabled={!aiConfig || !aiConfig.active}
                                    />
                                </div>
                                <button
                                    className="btn-large btn-primary"
                                    disabled={!aiConfig || !aiConfig.active}
                                    onClick={() => {
                                        const text = document.getElementById('documentText').value;
                                        if (!text) {
                                            alert('Please paste some text first');
                                            return;
                                        }
                                        fetch('/api/engine/document/extract', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ text })
                                        })
                                        .then(r => r.json())
                                        .then(data => {
                                            if (data.error) {
                                                alert('Error: ' + data.error);
                                            } else {
                                                alert(`Extracted ${data.terms_added || 0} terms!`);
                                                document.getElementById('documentText').value = '';
                                                loadEngineStats();
                                            }
                                        });
                                    }}
                                >
                                    Extract Terms with AI
                                </button>
                                {aiConfig && aiConfig.active && (
                                    <p style={{fontSize: '12px', color: 'var(--text-medium)', marginTop: '8px'}}>
                                        {isAILocal ? 'Local processing' : 'Cloud processing'} via {aiConfig.provider.toUpperCase()}
                                    </p>
                                )}
                            </div>

                            {/* AI Web Scraping */}
                            <div className="card">
                                <h2 className="card-title">Extract from Website</h2>
                                <p style={{fontSize: '14px', color: 'var(--text-medium)', marginBottom: '16px'}}>
                                    Enter URLs to staff directories, council member lists, or community pages.
                                </p>
                                {(!aiConfig || !aiConfig.active) && (
                                    <div style={{padding: '16px', background: '#FEF3C7', borderRadius: '8px', marginBottom: '12px'}}>
                                        <p style={{fontSize: '13px', color: 'var(--text-dark)'}}>
                                            Configure AI provider in AI Settings to enable scraping.
                                        </p>
                                    </div>
                                )}
                                <div className="setting-group">
                                    <label className="setting-label">Website URL</label>
                                    <input
                                        type="url"
                                        className="setting-input"
                                        placeholder="https://example.com/staff-directory"
                                        id="webUrl"
                                        disabled={!aiConfig || !aiConfig.active}
                                    />
                                </div>
                                <button
                                    className="btn-large btn-primary"
                                    disabled={!aiConfig || !aiConfig.active}
                                    onClick={() => {
                                        const url = document.getElementById('webUrl').value;
                                        if (!url) {
                                            alert('Please enter a URL first');
                                            return;
                                        }
                                        fetch('/api/engine/web/extract', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ url })
                                        })
                                        .then(r => r.json())
                                        .then(data => {
                                            if (data.error) {
                                                alert('Error: ' + data.error);
                                            } else {
                                                alert(`Extracted ${data.terms_added || 0} terms from ${url}!`);
                                                document.getElementById('webUrl').value = '';
                                                loadEngineStats();
                                            }
                                        });
                                    }}
                                >
                                    Scrape Website with AI
                                </button>
                                {aiConfig && aiConfig.active && (
                                    <p style={{fontSize: '12px', color: 'var(--text-medium)', marginTop: '8px'}}>
                                        {isAILocal ? 'Local processing' : 'Cloud processing'} via {aiConfig.provider.toUpperCase()}
                                    </p>
                                )}
                            </div>

                            {/* Test Engine */}
                            <div className="card" style={{gridColumn: 'span 2'}}>
                                <h2 className="card-title">Test Your Engine</h2>
                                <p style={{fontSize: '14px', color: 'var(--text-medium)', marginBottom: '16px'}}>
                                    Type text with misspellings to see how the engine corrects it in real-time.
                                </p>
                                <div style={{display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '16px', alignItems: 'start'}}>
                                    <div>
                                        <label className="setting-label">Input (with errors)</label>
                                        <textarea
                                            className="setting-input"
                                            rows="4"
                                            placeholder="e.g., Brooklyn Select Board with bernard green"
                                            value={testText}
                                            onChange={(e) => setTestText(e.target.value)}
                                        />
                                    </div>
                                    <div style={{display: 'flex', alignItems: 'center', paddingTop: '32px'}}>
                                        <button className="btn-large btn-primary" onClick={testCorrection}>
                                            Test →
                                        </button>
                                    </div>
                                    <div>
                                        <label className="setting-label">Output (corrected)</label>
                                        <div style={{padding: '16px', background: 'var(--bg-sage-light)', borderRadius: 'var(--radius-md)', minHeight: '96px', fontSize: '14px', lineHeight: '1.6'}}>
                                            {testResult || 'Corrected text will appear here...'}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Recent Terms */}
                            {recentTerms.length > 0 && (
                                <div className="card" style={{gridColumn: 'span 2'}}>
                                    <h2 className="card-title">Current Terms ({engineStats?.term_count || 0})</h2>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))', gap: '8px', marginTop: '12px'}}>
                                        {recentTerms.map((term, idx) => (
                                            <div key={idx} style={{padding: '10px', background: 'var(--bg-sage-light)', borderRadius: '8px', fontSize: '14px'}}>
                                                <div style={{fontWeight: '600', color: 'var(--text-dark)'}}>{term.term}</div>
                                                <div style={{fontSize: '12px', color: 'var(--text-medium)'}}>{term.category}</div>
                                            </div>
                                        ))}
                                    </div>
                                    <p style={{fontSize: '12px', color: 'var(--text-medium)', marginTop: '12px', fontStyle: 'italic'}}>
                                        Showing first 10 terms. Download engine JSON to see all terms.
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function AISettings({ onBack }) {
            const [config, setConfig] = useState(null);
            const [provider, setProvider] = useState('none');
            const [openaiKey, setOpenaiKey] = useState('');
            const [openaiModel, setOpenaiModel] = useState('gpt-4o-mini');
            const [ollamaUrl, setOllamaUrl] = useState('http://localhost:11434');
            const [ollamaModel, setOllamaModel] = useState('llama3.2');
            const [lmstudioUrl, setLmstudioUrl] = useState('http://localhost:1234/v1');
            const [lmstudioModel, setLmstudioModel] = useState('local-model');
            const [customUrl, setCustomUrl] = useState('');
            const [customKey, setCustomKey] = useState('');
            const [customModel, setCustomModel] = useState('');
            const [testResult, setTestResult] = useState('');
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                // Load current config
                fetch('/api/ai/config')
                    .then(r => r.json())
                    .then(data => {
                        setConfig(data);
                        setProvider(data.provider || 'none');
                        if (data.openai_api_key && data.openai_api_key !== '***') setOpenaiKey(data.openai_api_key);
                        setOpenaiModel(data.openai_model || 'gpt-4o-mini');
                        setOllamaUrl(data.ollama_base_url || 'http://localhost:11434');
                        setOllamaModel(data.ollama_model || 'llama3.2');
                        setLmstudioUrl(data.lmstudio_base_url || 'http://localhost:1234/v1');
                        setLmstudioModel(data.lmstudio_model || 'local-model');
                        setCustomUrl(data.custom_base_url || '');
                        setCustomKey(data.custom_api_key || '');
                        setCustomModel(data.custom_model || '');
                    });
            }, []);

            const saveConfig = () => {
                setSaving(true);
                setTestResult('');

                const newConfig = {
                    provider,
                    openai_api_key: openaiKey,
                    openai_model: openaiModel,
                    ollama_base_url: ollamaUrl,
                    ollama_model: ollamaModel,
                    lmstudio_base_url: lmstudioUrl,
                    lmstudio_model: lmstudioModel,
                    custom_base_url: customUrl,
                    custom_api_key: customKey,
                    custom_model: customModel
                };

                fetch('/api/ai/config/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newConfig)
                })
                .then(r => r.json())
                .then(data => {
                    setSaving(false);
                    if (data.error) {
                        alert('Error: ' + data.error);
                    } else {
                        setConfig(data);
                        alert('AI configuration saved!');
                    }
                });
            };

            const testConnection = () => {
                setTestResult('Testing...');
                fetch('/api/ai/test', { method: 'POST' })
                    .then(r => r.json())
                    .then(data => {
                        if (data.error) {
                            setTestResult('❌ Test failed: ' + data.error);
                        } else {
                            setTestResult(`✓ Test successful! Response: "${data.response}" (${data.is_local ? 'LOCAL' : 'CLOUD'})`);
                        }
                    });
            };

            const isLocal = config && (
                provider === 'ollama' ||
                provider === 'lmstudio' ||
                (provider === 'custom' && (customUrl.includes('localhost') || customUrl.includes('127.0.0.1')))
            );

            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <h1 className="dashboard-title">AI Settings</h1>
                        <button className="back-btn" onClick={onBack}>← Back</button>
                    </div>

                    <div className="dashboard-content">
                        <div className="info-box" style={{marginBottom: '24px'}}>
                            <div className="info-box-title">AI Provider Configuration</div>
                            <p style={{color: 'var(--text-medium)', marginBottom: '12px'}}>
                                Choose an AI provider for features like session summaries and document term extraction.
                                Local providers keep your data private.
                            </p>
                            {config && config.active && (
                                <div style={{padding: '12px', background: isLocal ? 'var(--bg-sage-light)' : '#FEF3C7', borderRadius: '8px', marginTop: '12px'}}>
                                    <strong>{isLocal ? 'Local Processing' : 'Cloud Processing'}</strong>
                                    <div style={{fontSize: '14px', marginTop: '4px', color: 'var(--text-medium)'}}>
                                        {isLocal
                                            ? 'Your data stays on your machine. No external API calls.'
                                            : 'Your data is sent to ' + provider.toUpperCase() + ' for processing.'}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="setting-group">
                            <label className="setting-label">AI Provider</label>
                            <select
                                className="setting-input"
                                value={provider}
                                onChange={(e) => setProvider(e.target.value)}
                            >
                                <option value="none">None (Disable AI Features)</option>
                                <option value="openai">OpenAI (Cloud - GPT-4)</option>
                                <option value="ollama">Ollama (Local - Free)</option>
                                <option value="lmstudio">LM Studio (Local - Free)</option>
                                <option value="custom">Custom API Endpoint</option>
                            </select>
                        </div>

                        {provider === 'openai' && (
                            <div>
                                <div className="privacy-warning" style={{padding: '16px', background: '#FEF3C7', border: '2px solid #FCD34D', borderRadius: '8px', marginBottom: '16px'}}>
                                    <strong>Cloud Processing Notice</strong>
                                    <p style={{fontSize: '14px', marginTop: '8px', color: 'var(--text-dark)'}}>
                                        When using OpenAI, your caption text and documents will be sent to OpenAI's servers for processing.
                                        Make sure this complies with your privacy requirements.
                                    </p>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">OpenAI API Key</label>
                                    <input
                                        type="password"
                                        className="setting-input"
                                        placeholder="sk-..."
                                        value={openaiKey}
                                        onChange={(e) => setOpenaiKey(e.target.value)}
                                    />
                                    <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>
                                        Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank" style={{color: 'var(--sage-primary)'}}>platform.openai.com/api-keys</a>
                                    </p>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model</label>
                                    <select
                                        className="setting-input"
                                        value={openaiModel}
                                        onChange={(e) => setOpenaiModel(e.target.value)}
                                    >
                                        <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cheap)</option>
                                        <option value="gpt-4o">GPT-4o (Best Quality)</option>
                                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                    </select>
                                </div>
                            </div>
                        )}

                        {provider === 'ollama' && (
                            <div>
                                <div className="privacy-ok" style={{padding: '16px', background: 'var(--bg-sage-light)', border: '2px solid var(--sage-primary)', borderRadius: '8px', marginBottom: '16px'}}>
                                    <strong>Local Processing</strong>
                                    <p style={{fontSize: '14px', marginTop: '8px', color: 'var(--text-dark)'}}>
                                        Ollama runs entirely on your computer. Your data never leaves your machine.
                                    </p>
                                </div>

                                <div className="info-box" style={{marginBottom: '16px'}}>
                                    <div className="info-box-title">Setup Instructions</div>
                                    <ol style={{paddingLeft: '20px', color: 'var(--text-medium)', fontSize: '14px'}}>
                                        <li>Download Ollama from <a href="https://ollama.ai" target="_blank" style={{color: 'var(--sage-primary)'}}>ollama.ai</a></li>
                                        <li>Run: <code style={{background: '#f5f5f5', padding: '2px 6px', borderRadius: '4px'}}>ollama pull llama3.2</code></li>
                                        <li>Verify it's running on port 11434</li>
                                    </ol>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Ollama Base URL</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={ollamaUrl}
                                        onChange={(e) => setOllamaUrl(e.target.value)}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model Name</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={ollamaModel}
                                        onChange={(e) => setOllamaModel(e.target.value)}
                                    />
                                    <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>
                                        Popular: llama3.2, mistral, phi3
                                    </p>
                                </div>
                            </div>
                        )}

                        {provider === 'lmstudio' && (
                            <div>
                                <div className="privacy-ok" style={{padding: '16px', background: 'var(--bg-sage-light)', border: '2px solid var(--sage-primary)', borderRadius: '8px', marginBottom: '16px'}}>
                                    <strong>Local Processing</strong>
                                    <p style={{fontSize: '14px', marginTop: '8px', color: 'var(--text-dark)'}}>
                                        LM Studio runs entirely on your computer. Your data never leaves your machine.
                                    </p>
                                </div>

                                <div className="info-box" style={{marginBottom: '16px'}}>
                                    <div className="info-box-title">Setup Instructions</div>
                                    <ol style={{paddingLeft: '20px', color: 'var(--text-medium)', fontSize: '14px'}}>
                                        <li>Download LM Studio from <a href="https://lmstudio.ai" target="_blank" style={{color: 'var(--sage-primary)'}}>lmstudio.ai</a></li>
                                        <li>Download a model (e.g., Llama 3.2, Mistral)</li>
                                        <li>Start the local server (default port 1234)</li>
                                    </ol>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">LM Studio Base URL</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={lmstudioUrl}
                                        onChange={(e) => setLmstudioUrl(e.target.value)}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model Name</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={lmstudioModel}
                                        onChange={(e) => setLmstudioModel(e.target.value)}
                                    />
                                </div>
                            </div>
                        )}

                        {provider === 'custom' && (
                            <div>
                                <div className="setting-group">
                                    <label className="setting-label">API Base URL</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        placeholder="http://localhost:8000/v1 or https://api.example.com/v1"
                                        value={customUrl}
                                        onChange={(e) => setCustomUrl(e.target.value)}
                                    />
                                    <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>
                                        {customUrl && (customUrl.includes('localhost') || customUrl.includes('127.0.0.1'))
                                            ? 'Local endpoint detected'
                                            : 'External endpoint - data will be sent over the network'}
                                    </p>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">API Key (if required)</label>
                                    <input
                                        type="password"
                                        className="setting-input"
                                        placeholder="Optional"
                                        value={customKey}
                                        onChange={(e) => setCustomKey(e.target.value)}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model Name</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        placeholder="model-name"
                                        value={customModel}
                                        onChange={(e) => setCustomModel(e.target.value)}
                                    />
                                </div>
                            </div>
                        )}

                        {provider !== 'none' && (
                            <div style={{display: 'flex', gap: '12px', marginTop: '24px'}}>
                                <button
                                    className="btn-large btn-primary"
                                    onClick={saveConfig}
                                    disabled={saving}
                                >
                                    {saving ? 'Saving...' : 'Save Configuration'}
                                </button>

                                {config && config.active && (
                                    <button
                                        className="btn-large"
                                        style={{background: 'var(--sage-light)', color: 'var(--sage-darker)'}}
                                        onClick={testConnection}
                                    >
                                        Test Connection
                                    </button>
                                )}
                            </div>
                        )}

                        {testResult && (
                            <div style={{marginTop: '16px', padding: '16px', background: testResult.includes('✓') ? 'var(--bg-sage-light)' : '#FEE2E2', borderRadius: '8px'}}>
                                {testResult}
                            </div>
                        )}

                        {provider === 'none' && (
                            <div className="info-box" style={{marginTop: '24px'}}>
                                <div className="info-box-title">AI Features Disabled</div>
                                <p style={{color: 'var(--text-medium)'}}>
                                    Select a provider above to enable AI-powered summaries and document extraction.
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function AboutPage({ onBack }) {
            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <h1 className="dashboard-title">About Community Captioner</h1>
                        <button className="back-btn" onClick={onBack}>← Back</button>
                    </div>

                    <div style={{maxWidth: '900px', margin: '0 auto', padding: '40px'}} className="about-content">
                        <div className="card">
                            <h2>Project Overview</h2>
                            <p>
                                Community Captioner v2 is a free, open-source live captioning system built specifically for
                                community media organizations. It provides real-time speech-to-text with local AI-powered
                                corrections for proper nouns (names, places, organizations).
                            </p>

                            <h3>Primary User</h3>
                            <p>
                                Brookline Interactive Group (BIG) - a community media organization in Brookline, MA that
                                broadcasts town meetings, events, and local programming.
                            </p>

                            <h3>Problem Solved</h3>
                            <p>
                                Commercial captioning encoders cost $30,000+. Community Captioner provides a zero-cost
                                alternative using browser APIs and optional local Whisper AI.
                            </p>
                        </div>

                        <div className="card">
                            <h2>What Makes It Unique</h2>
                            <p>
                                The AI Caption Engine is the standout feature. Unlike generic speech recognition systems,
                                Community Captioner learns your community's specific vocabulary.
                            </p>

                            <div className="info-box">
                                <div className="info-box-title">The Caption Engine</div>
                                <p>
                                    Uses a local knowledge base to correct ASR (Automatic Speech Recognition) errors in real-time:
                                </p>
                                <div className="example-correction">
                                    <div>"Brooklyn" → "Brookline"</div>
                                    <div>"bernard green" → "Bernard Greene"</div>
                                    <div>"selectboard" → "Select Board"</div>
                                </div>
                                <p style={{marginTop: '12px'}}>
                                    This correction system is built using RAG (Retrieval-Augmented Generation) principles,
                                    maintaining a database of proper nouns with common misspellings and aliases.
                                </p>
                            </div>
                        </div>

                        <div className="card">
                            <h2>Architecture</h2>
                            <div className="architecture-diagram">
{`┌─────────────────────────────────────────────────────────────┐
│                    Browser (index.html)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ Web Speech  │  │   React     │  │  Settings/Controls  │  │
│  │    API      │  │    UI       │  │                     │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
└─────────┼────────────────┼───────────────────┼──────────────┘
          │                │                   │
          ▼                ▼                   ▼
┌─────────────────────────────────────────────────────────────┐
│                 Python Server (start-server.py)              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   Whisper   │  │   Caption   │  │     Session         │  │
│  │   Engine    │  │   Engine    │  │     Manager         │  │
│  │ (optional)  │  │   (RAG)     │  │                     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
          │                │                   │
          ▼                ▼                   ▼
┌─────────────────────────────────────────────────────────────┐
│                      File System                             │
│  context-data/     sessions/          engines/               │
│  (engine state)    (recordings)       (portable engines)     │
└─────────────────────────────────────────────────────────────┘`}
                            </div>

                            <h3>Core Components</h3>
                            <ul>
                                <li><strong>Web Speech API</strong> - Browser-based, real-time (~200ms latency), requires Chrome/Edge + internet</li>
                                <li><strong>Whisper AI</strong> - Local transcription, more accurate, 2-4s latency, works offline</li>
                                <li><strong>Caption Engine</strong> - RAG-based correction system for local proper nouns</li>
                                <li><strong>Session Manager</strong> - Records timestamps, corrections, exports to SRT/VTT/TXT/JSON</li>
                                <li><strong>Portable Engines</strong> - Export/import correction databases as JSON</li>
                            </ul>
                        </div>

                        <div className="card">
                            <h2>Feature Comparison</h2>
                            <table className="comparison-table">
                                <thead>
                                    <tr>
                                        <th>Feature</th>
                                        <th>Community Captioner</th>
                                        <th>Commercial Systems</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Cost</td>
                                        <td>Free / Open Source</td>
                                        <td>$30,000+</td>
                                    </tr>
                                    <tr>
                                        <td>Local Name Correction</td>
                                        <td>Yes (AI Engine)</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>Offline Mode</td>
                                        <td>Yes (with Whisper)</td>
                                        <td>Usually No</td>
                                    </tr>
                                    <tr>
                                        <td>Export Formats</td>
                                        <td>SRT, VTT, TXT, JSON</td>
                                        <td>Varies</td>
                                    </tr>
                                    <tr>
                                        <td>OBS/vMix Integration</td>
                                        <td>Yes</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>Customizable Styling</td>
                                        <td>Full Control</td>
                                        <td>Limited</td>
                                    </tr>
                                    <tr>
                                        <td>Source Code Access</td>
                                        <td>Yes (CC BY-SA 4.0)</td>
                                        <td>No</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div className="card">
                            <h2>Installation</h2>
                            <h3>Basic Installation (Browser Speech Only)</h3>
                            <p>No dependencies required! Just run:</p>
                            <div className="architecture-diagram">
python3 start-server.py
                            </div>
                            <p>Then open http://localhost:8080 in Chrome or Edge.</p>

                            <h3>Full Installation (with Whisper AI)</h3>
                            <div className="architecture-diagram">
{`# Install Python dependencies
pip3 install faster-whisper sounddevice numpy

# Mac users
brew install portaudio

# Linux users
sudo apt install portaudio19-dev

# Start server
python3 start-server.py`}
                            </div>
                        </div>

                        <div className="card">
                            <h2>Use Cases</h2>
                            <ul>
                                <li><strong>Town Meetings</strong> - Live caption city council, select board, and committee meetings</li>
                                <li><strong>Public Events</strong> - Community forums, candidate debates, public hearings</li>
                                <li><strong>Local News</strong> - Community TV news programs and interviews</li>
                                <li><strong>Educational Content</strong> - School board meetings, educational programming</li>
                                <li><strong>Accessibility</strong> - Make all public content accessible to deaf/hard-of-hearing viewers</li>
                                <li><strong>Archival</strong> - Create searchable transcripts of all public meetings</li>
                            </ul>
                        </div>

                        <div className="card">
                            <h2>Credits</h2>
                            <h3>Developed By</h3>
                            <p>
                                <strong>Stephen Walter</strong> - weirdmachine.org<br/>
                                In partnership with <strong>Brookline Interactive Group (BIG)</strong>
                            </p>

                            <h3>Powered By</h3>
                            <ul>
                                <li>React (UI framework)</li>
                                <li>Web Speech API (browser speech recognition)</li>
                                <li>faster-whisper (local AI transcription)</li>
                                <li>Python standard library (zero-dependency server)</li>
                            </ul>

                            <h3>Special Thanks</h3>
                            <ul>
                                <li>Brookline Interactive Group for testing and feedback</li>
                                <li>Neighborhood.AI for AI consulting</li>
                                <li>The open-source community</li>
                            </ul>
                        </div>

                        <div className="card">
                            <h2>License</h2>
                            <p>
                                Community Captioner is licensed under <strong>CC BY-SA 4.0</strong>
                                (Creative Commons Attribution-ShareAlike 4.0 International).
                            </p>
                            <p>
                                This means you are free to:
                            </p>
                            <ul>
                                <li><strong>Share</strong> - Copy and redistribute in any medium or format</li>
                                <li><strong>Adapt</strong> - Remix, transform, and build upon the material</li>
                            </ul>
                            <p>
                                Under the following terms:
                            </p>
                            <ul>
                                <li><strong>Attribution</strong> - Give appropriate credit to the original creator</li>
                                <li><strong>ShareAlike</strong> - Distribute your contributions under the same license</li>
                            </ul>
                            <p style={{marginTop: '16px', fontStyle: 'italic', color: 'var(--text-light)'}}>
                                Built for the public good. Use it, improve it, share it.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
