<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Captioner - Free AI-Powered Live Captioning</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            /* Sage green & warm background palette */
            --bg-warm: #F5F3EE;
            --bg-sage-light: #E8EDE7;
            --bg-white: #F5F3EE;
            --sage-primary: #7D9B76;
            --sage-dark: #5A7C55;
            --sage-darker: #3D5A47;
            --sage-muted: #A8BAA3;
            --text-dark: #2D3A2E;
            --text-medium: #5A6B5E;
            --text-light: #8A9A8E;
            --border-light: #D4D2CD;
            --border-sage: #C4D3BE;

            /* Accent colors - purple used sparingly */
            --purple-accent: #8B7FC7;
            --purple-light: #A69DD6;

            /* Functional colors */
            --red-primary: #DC2626;
            --orange-primary: #EA580C;
            --green-bright: #00A676;

            /* Spacing */
            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 18px;
            --radius-xl: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', 'Inter', -apple-system, sans-serif;
            background: var(--bg-warm);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            padding: 0;
            background: #F5F3EE;
            position: relative;
            overflow-x: hidden;
        }

        .blob-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.15;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        .blob-1 {
            width: 400px;
            height: 400px;
            background: #81C784;
            top: 10%;
            left: 10%;
            animation: float-1 20s infinite;
        }

        .blob-2 {
            width: 350px;
            height: 350px;
            background: #9575CD;
            top: 60%;
            left: 70%;
            animation: float-2 25s infinite;
        }

        .blob-3 {
            width: 450px;
            height: 450px;
            background: #66BB6A;
            top: 30%;
            left: 60%;
            animation: float-3 30s infinite;
        }

        .blob-4 {
            width: 300px;
            height: 300px;
            background: #AB47BC;
            top: 70%;
            left: 20%;
            animation: float-4 22s infinite;
        }

        .blob-5 {
            width: 380px;
            height: 380px;
            background: #7E57C2;
            top: 15%;
            left: 80%;
            animation: float-5 28s infinite;
        }

        @keyframes float-1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -50px) scale(1.1); }
            50% { transform: translate(-20px, 30px) scale(0.9); }
            75% { transform: translate(40px, 20px) scale(1.05); }
        }

        @keyframes float-2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(-40px, 30px) scale(0.95); }
            50% { transform: translate(20px, -40px) scale(1.1); }
            75% { transform: translate(-30px, -20px) scale(1); }
        }

        @keyframes float-3 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-50px, 40px) scale(1.05); }
            66% { transform: translate(30px, -30px) scale(0.95); }
        }

        @keyframes float-4 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(25px, 35px) scale(1.08); }
            50% { transform: translate(-35px, -25px) scale(0.92); }
            75% { transform: translate(15px, -40px) scale(1.03); }
        }

        @keyframes float-5 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(40px, -35px) scale(0.97); }
            66% { transform: translate(-25px, 45px) scale(1.08); }
        }

        .landing-header {
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-light);
            background: #F5F3EE;
            position: relative;
            z-index: 10;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            justify-content: center;
        }

        .logo-bar {
            height: 9px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .logo-bar-1 { background: var(--sage-darker); width: 100%; }
        .logo-bar-2 { background: var(--sage-primary); width: 75%; }
        .logo-bar-3 { background: var(--sage-muted); width: 50%; }

        .logo-text {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-dark);
            letter-spacing: 0.5px;
            line-height: 1.1;
            text-transform: uppercase;
        }

        .cc-inline {
            font-size: 17px;
            font-weight: 900;
            color: var(--sage-darker);
            font-family: 'Inter', -apple-system, sans-serif;
            letter-spacing: 0.5px;
            border: 1.5px solid var(--sage-darker);
            padding: 1px 4px;
            border-radius: 3px;
            display: inline-block;
        }

        .badge-tag {
            display: block;
            background: transparent;
            color: var(--text-medium);
            padding: 0;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.2px;
            line-height: 1.3;
            max-width: 280px;
            margin-top: 4px;
        }

        /* Demo Section */
        .demo-section {
            max-width: 700px;
            margin: 40px auto 40px;
            padding: 0 32px;
            position: relative;
            z-index: 5;
        }

        .demo-card {
            background: rgba(245, 243, 238, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid var(--sage-primary);
            border-radius: 20px;
            padding: 28px;
            box-shadow: 0 15px 40px rgba(61, 90, 71, 0.12);
        }

        .demo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
        }

        .demo-title {
            font-size: 22px;
            font-weight: 800;
            color: var(--sage-darker);
            margin: 0;
        }

        .demo-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px;
            background: #f5f5f5;
            border-radius: 20px;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #9E9E9E;
            transition: all 0.3s;
        }

        .indicator-dot.active {
            background: #00A676;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .indicator-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
            min-width: 100px;
        }

        .demo-box {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 14px;
            padding: 32px 28px;
            margin-bottom: 16px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .demo-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.03) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .demo-text {
            font-size: 24px;
            font-weight: 600;
            color: white;
            text-align: center;
            line-height: 1.5;
            transition: all 0.5s ease;
            position: relative;
            z-index: 1;
        }

        .demo-text.phase-correcting {
            color: #FF6B6B;
            transform: scale(1.02);
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
        }

        .demo-text.phase-corrected,
        .demo-text.phase-waiting {
            color: #51CF66;
            text-shadow: 0 0 20px rgba(81, 207, 102, 0.4);
        }

        .demo-progress {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #D1D5DB;
            transition: all 0.3s;
        }

        .progress-dot.active {
            width: 32px;
            border-radius: 5px;
            background: var(--sage-primary);
            border: 2px solid var(--border-light);
            color: var(--text-medium);
        }

        .demo-btn.secondary:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
            transform: translateY(-2px);
        }

        .hero-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 32px 80px;
            text-align: center;
            position: relative;
            z-index: 5;
        }

        .hero-title {
            font-size: 96px;
            font-weight: 900;
            color: var(--sage-darker);
            line-height: 1.05;
            margin-bottom: 36px;
            letter-spacing: -3px;
            animation: titleFloat 3s ease-in-out infinite;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .hero-subtitle {
            font-size: 32px;
            color: var(--text-dark);
            margin-bottom: 28px;
            font-weight: 700;
            line-height: 1.35;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-subtitle strong {
            color: var(--sage-darker);
            font-weight: 800;
        }

        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .hero-description {
            font-size: 19px;
            color: var(--text-medium);
            max-width: 750px;
            margin: 0 auto 48px;
            line-height: 1.8;
            font-weight: 400;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 80px;
        }

        .cta-btn {
            padding: 20px 42px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .cta-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .cta-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .cta-btn-primary {
            background: var(--sage-darker);
            color: white;
            box-shadow: 0 4px 15px rgba(61, 90, 71, 0.3);
        }

        .cta-btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(61, 90, 71, 0.4);
        }

        .cta-btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: var(--sage-darker);
            border: 3px solid var(--sage-primary);
            box-shadow: 0 4px 15px rgba(61, 90, 71, 0.1);
        }

        .cta-btn-secondary:hover {
            background: white;
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(61, 90, 71, 0.2);
        }

        .feature-cards {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 32px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            position: relative;
            z-index: 5;
        }

        .feature-card {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 40px 32px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .feature-card:hover {
            border-color: var(--sage-primary);
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(125, 155, 118, 0.15);
        }

        .feature-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .feature-desc {
            font-size: 15px;
            color: var(--text-medium);
            line-height: 1.6;
        }

        .feature-link {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
            font-size: 14px;
            font-weight: 600;
            color: var(--sage-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .feature-link .arrow {
            transition: transform 0.2s;
        }

        .feature-card:hover .feature-link .arrow {
            transform: translateX(4px);
        }

        .feature-link.special-link {
            color: var(--purple-accent);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: var(--bg-sage-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--sage-darker);
            transition: all 0.3s;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.05);
            background: var(--sage-light);
        }

        .feature-card.special .feature-icon {
            background: linear-gradient(135deg, var(--purple-accent), var(--purple-light));
            color: white;
        }

        .feature-card.special:hover .feature-icon {
            background: linear-gradient(135deg, var(--purple-accent), var(--purple-light));
        }

        .special-badge {
            display: inline-block;
            background: var(--purple-accent);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        /* About/FAQ Sections */
        .info-section {
            max-width: 1200px;
            margin: 80px auto;
            padding: 0 32px;
            position: relative;
            z-index: 5;
        }

        .section-title {
            font-size: 42px;
            font-weight: 900;
            color: var(--sage-darker);
            margin-bottom: 16px;
            text-align: center;
        }

        .section-subtitle {
            font-size: 18px;
            color: var(--text-medium);
            text-align: center;
            margin-bottom: 48px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 28px;
            margin-bottom: 40px;
        }

        .info-card {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 32px;
            transition: all 0.3s;
        }

        .info-card:hover {
            border-color: var(--sage-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(61, 90, 71, 0.1);
        }

        .info-card h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--sage-darker);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .info-card p, .info-card li {
            font-size: 16px;
            color: var(--text-medium);
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .info-card ul {
            list-style: none;
            padding-left: 0;
        }

        .info-card li::before {
            content: "â†’";
            color: var(--sage-primary);
            font-weight: bold;
            margin-right: 10px;
        }

        .faq-item {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .faq-question {
            font-size: 18px;
            font-weight: 700;
            color: var(--sage-darker);
            margin-bottom: 12px;
        }

        .faq-answer {
            font-size: 16px;
            color: var(--text-medium);
            line-height: 1.7;
        }

        .highlight-box {
            background: var(--bg-sage-light);
            border-left: 4px solid var(--sage-primary);
            padding: 20px 24px;
            border-radius: 8px;
            margin: 24px 0;
        }

        .highlight-box strong {
            color: var(--sage-darker);
            font-size: 17px;
        }

        /* About Section - Modern Card Grid */
        .about-section .info-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(245,243,238,0.95) 100%);
            border-left: 4px solid var(--sage-primary);
            position: relative;
            overflow: hidden;
        }

        .about-section .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(125,155,118,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .about-section h3 {
            font-size: 20px !important;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 800;
            border-bottom: 2px solid var(--sage-primary);
            padding-bottom: 12px;
            margin-bottom: 20px !important;
        }

        /* Architecture Diagram Section */
        .architecture-section {
            background: var(--bg-white);
            padding: 60px 32px;
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-light);
            text-align: center;
            overflow: visible;
        }

        .architecture-diagram {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: visible;
        }

        .arch-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: nowrap;
            overflow: visible;
        }

        @media (max-width: 800px) {
            .arch-row {
                flex-wrap: wrap;
            }
        }

        .arch-secondary {
            overflow: visible;
        }

        .arch-box {
            background: var(--bg-sage-light);
            border: 2px solid var(--border-sage);
            border-radius: var(--radius-md);
            padding: 20px 24px;
            text-align: center;
            min-width: 150px;
            max-width: 180px;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
        }

        .arch-box:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(125, 155, 118, 0.2);
            z-index: 10;
        }

        .arch-box.special {
            background: linear-gradient(135deg, var(--purple-accent), var(--purple-light));
            border-color: var(--purple-accent);
            color: white;
        }

        .arch-box.special .arch-detail {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Tooltip styles */
        .arch-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-dark);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.5;
            width: 220px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            margin-bottom: 8px;
        }

        .arch-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--text-dark);
        }

        .arch-box:hover .arch-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .arch-tooltip a {
            color: #A5D6A7;
            text-decoration: none;
            font-weight: 600;
        }

        .arch-tooltip a:hover {
            text-decoration: underline;
        }

        .arch-icon {
            margin-bottom: 8px;
            color: var(--sage-darker);
        }

        .arch-box.special .arch-icon {
            color: white;
        }

        .arch-icon.small {
            margin-bottom: 6px;
        }

        .arch-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .arch-box.special .arch-label {
            color: white;
        }

        .arch-detail {
            font-size: 12px;
            color: var(--text-medium);
        }

        .arch-arrow {
            font-size: 28px;
            color: var(--sage-primary);
            font-weight: bold;
            flex-shrink: 0;
        }

        .arch-connector-line {
            width: 100%;
            max-width: 600px;
            height: 40px;
            margin: 16px auto;
            position: relative;
        }

        .arch-connector-line::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--border-sage);
        }

        .arch-connector-line::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--border-sage);
        }

        .arch-secondary {
            margin-top: 0;
            position: relative;
            width: 100%;
        }

        .arch-row-secondary {
            padding-top: 20px;
            justify-content: center;
            gap: 16px;
        }

        .arch-row-secondary .arch-box {
            padding: 16px 18px;
            min-width: 120px;
            max-width: 140px;
            background: white;
            border-color: var(--border-light);
        }

        .arch-row-secondary .arch-label {
            font-size: 12px;
        }

        .arch-row-secondary .arch-detail {
            font-size: 10px;
        }

        .arch-caption {
            text-align: center;
            color: var(--text-medium);
            font-size: 14px;
            max-width: 700px;
            margin: 32px auto 0;
            line-height: 1.6;
        }

        /* How-To Section - Interactive Steps */
        .howto-section {
            background: linear-gradient(135deg, rgba(125,155,118,0.03) 0%, rgba(139,127,199,0.03) 100%);
            padding: 80px 32px;
            max-width: 100%;
        }

        .howto-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        @media (max-width: 1024px) {
            .howto-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .howto-grid {
                grid-template-columns: 1fr;
            }
        }

        .howto-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 32px 24px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(61, 90, 71, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .howto-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--sage-primary), var(--sage-dark));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .howto-card:hover::before {
            transform: scaleX(1);
        }

        .howto-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 40px rgba(61, 90, 71, 0.15);
        }

        .howto-step-number {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--sage-primary), var(--sage-darker));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            margin: 0 auto 20px;
            transition: transform 0.3s ease;
        }

        .howto-card:hover .howto-step-number {
            transform: scale(1.1);
        }

        .howto-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            color: var(--sage-darker);
        }

        .howto-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 12px;
        }

        .howto-desc {
            font-size: 14px;
            color: var(--text-medium);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .howto-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .howto-feature-tag {
            background: var(--bg-sage-light);
            color: var(--sage-darker);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .howto-section h3 {
            font-size: 22px !important;
            font-weight: 700;
            margin-bottom: 16px !important;
        }

        /* FAQ Section - Accordion Style */
        .faq-section .faq-item {
            background: white;
            border: none;
            border-left: 3px solid transparent;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            transition: all 0.3s;
            cursor: pointer;
        }

        .faq-section .faq-item:hover {
            border-left-color: var(--sage-primary);
            box-shadow: 0 4px 20px rgba(61, 90, 71, 0.12);
            transform: translateX(4px);
        }

        .faq-question {
            position: relative;
            padding-left: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-toggle {
            font-size: 24px;
            font-weight: 700;
            color: var(--sage-primary);
            margin-left: 12px;
            flex-shrink: 0;
        }

        .faq-question::before {
            content: 'Q';
            position: absolute;
            left: 0;
            top: 0;
            width: 18px;
            height: 18px;
            background: var(--sage-primary);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .faq-answer {
            padding-left: 24px;
            border-left: 2px solid var(--bg-sage-light);
            margin-left: 9px;
        }

        /* Values Section */
        .values-section .info-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        @media (max-width: 900px) {
            .values-section .info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .values-section .info-grid {
                grid-template-columns: 1fr;
            }
        }

        .values-section .info-card {
            text-align: center;
            padding: 36px 28px;
        }

        .value-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            color: var(--sage-darker);
            background: var(--bg-sage-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .values-section .info-card:hover .value-icon {
            transform: scale(1.1);
            background: var(--sage-primary);
            color: white;
        }

        .values-section .info-card h3 {
            justify-content: center;
            margin-bottom: 12px !important;
        }

        /* Footer Styles */
        .site-footer {
            background: var(--sage-darker);
            color: white;
            padding: 48px 32px 32px;
            margin-top: 100px;
            position: relative;
            z-index: 5;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 28px;
        }

        .footer-text {
            font-size: 16px;
            line-height: 1.8;
            text-align: center;
            max-width: 800px;
        }

        .footer-text a {
            color: #A5D6A7;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s;
        }

        .footer-text a:hover {
            color: #C8E6C9;
            text-decoration: underline;
        }

        .footer-logos {
            display: flex;
            align-items: center;
            gap: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-logo {
            height: 70px;
            object-fit: contain;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .footer-logo:hover {
            opacity: 1;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .footer-icon-link {
            color: white;
            font-size: 28px;
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-icon-link:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        .footer-license {
            font-size: 13px;
            color: #C8E6C9;
            text-align: center;
            margin-top: 16px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Dashboard Styles */
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px;
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid var(--border-light);
        }

        .dashboard-title {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-dark);
        }

        .back-btn {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-medium);
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 28px;
        }

        .preview-section {
            background: #1a1a1a;
            border-radius: var(--radius-xl);
            padding: 48px 32px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 28px;
        }

        .preview-label {
            position: absolute;
            top: 16px;
            left: 20px;
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .preview-badges {
            position: absolute;
            top: 16px;
            right: 20px;
            display: flex;
            gap: 8px;
        }

        .preview-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }

        .preview-badge.mode { background: var(--sage-primary); }
        .preview-badge.whisper { background: var(--orange-primary); }
        .preview-badge.engine { background: var(--purple-accent); }
        .preview-badge.corrections { background: var(--green-bright); }
        .preview-badge.listening {
            background: var(--red-primary);
            animation: pulse 1.5s infinite;
        }

        .preview-text {
            font-size: 32px;
            font-weight: 600;
            color: white;
            text-align: center;
            max-width: 90%;
            line-height: 1.4;
        }

        .preview-text.empty {
            color: #555;
            font-size: 18px;
        }

        .card {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-badge {
            padding: 4px 10px;
            background: var(--purple-accent);
            color: white;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .mode-btn {
            padding: 18px 24px;
            background: var(--bg-sage-light);
            border: 2px solid var(--border-sage);
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-medium);
        }

        .mode-btn:hover {
            border-color: var(--sage-primary);
        }

        .mode-btn.active {
            background: var(--sage-darker);
            border-color: var(--sage-darker);
            color: white;
        }

        .mode-btn.active.whisper {
            background: var(--orange-primary);
            border-color: var(--orange-primary);
        }

        .btn-large {
            width: 100%;
            padding: 18px 24px;
            font-size: 17px;
            font-weight: 700;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .btn-primary {
            background: var(--sage-darker);
            color: white;
        }

        .btn-primary:hover {
            background: var(--sage-primary);
        }

        .btn-danger {
            background: var(--red-primary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-light);
            color: var(--text-medium);
        }

        .btn-outline:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .setting-group {
            margin-bottom: 24px;
        }

        .setting-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-value {
            font-weight: 600;
            color: var(--sage-darker);
        }

        .setting-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--sage-primary);
        }

        .setting-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-light);
            outline: none;
            -webkit-appearance: none;
        }

        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--sage-darker);
            cursor: pointer;
        }

        .setting-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--sage-darker);
            cursor: pointer;
            border: none;
        }

        .color-input-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .toggle-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-sage-light);
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
        }

        .toggle-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .toggle-switch {
            width: 50px;
            height: 28px;
            background: var(--border-light);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.on {
            background: var(--sage-primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.on::after {
            transform: translateX(22px);
        }

        .rec-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
        }

        .rec-indicator.recording {
            background: #FEE2E2;
            border-color: var(--red-primary);
            color: var(--red-primary);
        }

        .rec-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-light);
        }

        .rec-indicator.recording .rec-dot {
            background: var(--red-primary);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .url-display {
            background: var(--bg-sage-light);
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
        }

        .url-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-medium);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .url-text {
            font-family: 'Monaco', monospace;
            font-size: 14px;
            color: var(--sage-darker);
            word-break: break-all;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid var(--border-sage);
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 16px;
        }

        .export-btn {
            padding: 12px 16px;
            background: var(--bg-sage-light);
            border: 2px solid var(--border-sage);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-dark);
            transition: all 0.2s;
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .export-btn:hover {
            background: var(--sage-darker);
            color: white;
            border-color: var(--sage-darker);
        }

        /* Wizard Styles */
        .wizard-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-light);
            z-index: 0;
        }

        .wizard-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .wizard-step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-white);
            border: 3px solid var(--border-light);
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--text-light);
            transition: all 0.3s;
        }

        .wizard-step.active .wizard-step-circle {
            background: var(--sage-darker);
            border-color: var(--sage-darker);
            color: white;
        }

        .wizard-step.completed .wizard-step-circle {
            background: var(--sage-primary);
            border-color: var(--sage-primary);
            color: white;
        }

        .wizard-step-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
        }

        .wizard-step.active .wizard-step-label {
            color: var(--sage-darker);
        }

        .wizard-content {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 40px;
            margin-bottom: 24px;
        }

        .wizard-nav {
            display: flex;
            justify-content: space-between;
            gap: 16px;
        }

        .wizard-btn {
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 700;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wizard-btn-primary {
            background: var(--sage-darker);
            color: white;
            flex: 1;
        }

        .wizard-btn-primary:hover {
            background: var(--sage-primary);
        }

        .wizard-btn-secondary {
            background: transparent;
            border: 2px solid var(--border-light);
            color: var(--text-medium);
        }

        .wizard-btn-secondary:hover {
            border-color: var(--sage-primary);
            color: var(--sage-darker);
        }

        .template-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .template-card {
            padding: 24px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .template-card:hover {
            border-color: var(--sage-primary);
            transform: translateY(-2px);
        }

        .template-card.selected {
            border-color: var(--sage-darker);
            background: var(--bg-sage-light);
        }

        .template-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .template-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .template-desc {
            font-size: 13px;
            color: var(--text-medium);
        }

        .term-form {
            background: var(--bg-sage-light);
            padding: 24px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }

        .term-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .term-item {
            padding: 12px 16px;
            background: white;
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .term-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .term-category {
            font-size: 12px;
            padding: 4px 8px;
            background: var(--sage-primary);
            color: white;
            border-radius: 6px;
            margin-left: 8px;
        }

        .term-remove {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: var(--red-primary);
            cursor: pointer;
            font-weight: 600;
        }

        .info-box {
            background: var(--bg-sage-light);
            padding: 20px;
            border-radius: var(--radius-md);
            margin: 20px 0;
            border-left: 4px solid var(--sage-primary);
        }

        .info-box-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--sage-darker);
        }

        .example-correction {
            padding: 12px;
            background: white;
            border-radius: var(--radius-sm);
            margin-top: 12px;
            font-family: monospace;
        }

        .correction-before {
            color: var(--red-primary);
            text-decoration: line-through;
        }

        .correction-after {
            color: var(--green-bright);
            font-weight: 600;
        }

        .about-content h2 {
            font-size: 28px;
            margin-top: 32px;
            margin-bottom: 16px;
            color: var(--text-dark);
        }

        .about-content h3 {
            font-size: 20px;
            margin-top: 24px;
            margin-bottom: 12px;
            color: var(--sage-darker);
        }

        .about-content p {
            font-size: 16px;
            line-height: 1.7;
            color: var(--text-medium);
            margin-bottom: 16px;
        }

        .about-content ul {
            margin: 16px 0;
            padding-left: 24px;
        }

        .about-content li {
            margin-bottom: 8px;
            color: var(--text-medium);
        }

        .comparison-table {
            width: 100%;
            margin: 24px 0;
            border-collapse: collapse;
        }

        .comparison-table th {
            background: var(--sage-darker);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 700;
        }

        .comparison-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-light);
        }

        .comparison-table tr:nth-child(even) {
            background: var(--bg-sage-light);
        }

        .architecture-diagram {
            background: var(--bg-white);
            padding: 24px;
            border-radius: var(--radius-md);
            border: 2px solid var(--border-light);
            margin: 24px 0;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.8;
            overflow-x: auto;
        }

        @media (max-width: 1024px) {
            .feature-cards {
                grid-template-columns: 1fr;
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .template-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Translation dictionary
        const translations = {
            en: {
                // Header
                'AI for Accessibility': 'AI for Accessibility',
                'Live captioning and analysis tools for community media. Zero cost. Open Source. Powered by AI + Human intelligence for the public good.': 'Live captioning and analysis tools for community media. Zero cost. Open Source. Powered by AI + Human intelligence for the public good.',
                'Open Control Dashboard': 'Open Control Dashboard',
                'Learn More': 'Learn More',
                'AI Settings': 'AI Settings',
                // Dashboard
                'Control Dashboard': 'Control Dashboard',
                'Back to Home': 'Back to Home',
                'Configure Engine': 'Configure Engine',
                'Upload Engine': 'Upload Engine',
                'Live Preview': 'Live Preview',
                'Captioning Mode': 'Captioning Mode',
                'Browser Speech': 'Browser Speech',
                'Whisper AI': 'Whisper AI',
                'Start Browser Captions': 'Start Browser Captions',
                'Stop Browser Captions': 'Stop Browser Captions',
                'AI Caption Engine': 'AI Caption Engine',
                'Engine Active': 'Engine Active',
                'Engine Disabled': 'Engine Disabled',
                'Total Terms': 'Total Terms',
                'Corrections Made': 'Corrections Made',
                'Engine Status': 'Engine Status',
            },
            es: {
                // Header
                'AI for Accessibility': 'IA para Accesibilidad',
                'Live captioning and analysis tools for community media. Zero cost. Open Source. Powered by AI + Human intelligence for the public good.': 'Herramientas de subtitulado y anÃ¡lisis en vivo para medios comunitarios. Costo cero. CÃ³digo abierto. Impulsado por IA + inteligencia humana para el bien pÃºblico.',
                'Open Control Dashboard': 'Abrir Panel de Control',
                'Learn More': 'MÃ¡s InformaciÃ³n',
                'AI Settings': 'ConfiguraciÃ³n de IA',
                // Dashboard
                'Control Dashboard': 'Panel de Control',
                'Back to Home': 'Volver al Inicio',
                'Configure Engine': 'Configurar Motor',
                'Upload Engine': 'Cargar Motor',
                'Live Preview': 'Vista Previa en Vivo',
                'Captioning Mode': 'Modo de Subtitulado',
                'Browser Speech': 'Voz del Navegador',
                'Whisper AI': 'Whisper IA',
                'Start Browser Captions': 'Iniciar SubtÃ­tulos del Navegador',
                'Stop Browser Captions': 'Detener SubtÃ­tulos del Navegador',
                'AI Caption Engine': 'Motor de SubtÃ­tulos IA',
                'Engine Active': 'Motor Activo',
                'Engine Disabled': 'Motor Deshabilitado',
                'Total Terms': 'TÃ©rminos Totales',
                'Corrections Made': 'Correcciones Realizadas',
                'Engine Status': 'Estado del Motor',
            },
            pt: {
                // Header
                'AI for Accessibility': 'IA para Acessibilidade',
                'Live captioning and analysis tools for community media. Zero cost. Open Source. Powered by AI + Human intelligence for the public good.': 'Ferramentas de legendagem e anÃ¡lise ao vivo para mÃ­dia comunitÃ¡ria. Custo zero. CÃ³digo aberto. Alimentado por IA + inteligÃªncia humana para o bem pÃºblico.',
                'Open Control Dashboard': 'Abrir Painel de Controle',
                'Learn More': 'Saiba Mais',
                'AI Settings': 'ConfiguraÃ§Ãµes de IA',
                // Dashboard
                'Control Dashboard': 'Painel de Controle',
                'Back to Home': 'Voltar ao InÃ­cio',
                'Configure Engine': 'Configurar Motor',
                'Upload Engine': 'Carregar Motor',
                'Live Preview': 'VisualizaÃ§Ã£o ao Vivo',
                'Captioning Mode': 'Modo de Legendagem',
                'Browser Speech': 'Fala do Navegador',
                'Whisper AI': 'Whisper IA',
                'Start Browser Captions': 'Iniciar Legendas do Navegador',
                'Stop Browser Captions': 'Parar Legendas do Navegador',
                'AI Caption Engine': 'Motor de Legendas IA',
                'Engine Active': 'Motor Ativo',
                'Engine Disabled': 'Motor Desativado',
                'Total Terms': 'Termos Totais',
                'Corrections Made': 'CorreÃ§Ãµes Feitas',
                'Engine Status': 'Status do Motor',
            },
            fr: {
                // Header
                'AI for Accessibility': 'IA pour l\'AccessibilitÃ©',
                'Live captioning and analysis tools for community media. Zero cost. Open Source. Powered by AI + Human intelligence for the public good.': 'Outils de sous-titrage et d\'analyse en direct pour les mÃ©dias communautaires. CoÃ»t zÃ©ro. Open Source. AlimentÃ© par l\'IA + intelligence humaine pour le bien public.',
                'Open Control Dashboard': 'Ouvrir le Tableau de Bord',
                'Learn More': 'En Savoir Plus',
                'AI Settings': 'ParamÃ¨tres IA',
                // Dashboard
                'Control Dashboard': 'Tableau de Bord',
                'Back to Home': 'Retour Ã  l\'Accueil',
                'Configure Engine': 'Configurer le Moteur',
                'Upload Engine': 'TÃ©lÃ©charger le Moteur',
                'Live Preview': 'AperÃ§u en Direct',
                'Captioning Mode': 'Mode de Sous-titrage',
                'Browser Speech': 'Voix du Navigateur',
                'Whisper AI': 'Whisper IA',
                'Start Browser Captions': 'DÃ©marrer les Sous-titres du Navigateur',
                'Stop Browser Captions': 'ArrÃªter les Sous-titres du Navigateur',
                'AI Caption Engine': 'Moteur de Sous-titres IA',
                'Engine Active': 'Moteur Actif',
                'Engine Disabled': 'Moteur DÃ©sactivÃ©',
                'Total Terms': 'Termes Totaux',
                'Corrections Made': 'Corrections EffectuÃ©es',
                'Engine Status': 'Ã‰tat du Moteur',
            }
        };

        function App() {
            const [view, setView] = useState('landing');
            const [language, setLanguage] = useState('en');

            const t = (key) => translations[language][key] || key;

            const startDashboard = () => setView('dashboard');
            const showAbout = () => setView('about');
            const showAISettings = () => setView('ai-settings');
            const showDemoAnalytics = () => setView('demo-analytics');

            if (view === 'landing') {
                return <LandingPage
                    onStartDashboard={startDashboard}
                    onShowAbout={showAbout}
                    onShowAISettings={showAISettings}
                    onShowDemoAnalytics={showDemoAnalytics}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'dashboard') {
                return <Dashboard
                    onBack={() => setView('landing')}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'about') {
                return <AboutPage
                    onBack={() => setView('landing')}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'ai-settings') {
                return <AISettings
                    onBack={() => setView('landing')}
                    language={language}
                    setLanguage={setLanguage}
                    t={t}
                />;
            }

            if (view === 'demo-analytics') {
                return <DemoAnalytics
                    onBack={() => setView('landing')}
                />;
            }
        }

        function CaptionDemo() {
            const [demoIndex, setDemoIndex] = useState(0);
            const [phase, setPhase] = useState('showing'); // showing, correcting, corrected, waiting

            const demos = [
                {
                    original: "Welcome to the Brooklyn Select Board meeting",
                    corrected: "Welcome to the Brookline Select Board meeting",
                    highlight: "Brookline"
                },
                {
                    original: "Chair bernard green will lead the discussion",
                    corrected: "Chair Bernard Greene will lead the discussion",
                    highlight: "Bernard Greene"
                },
                {
                    original: "town administrated steven woo presented",
                    corrected: "Town Administrator Stephen Wu presented",
                    highlight: "Stephen Wu"
                }
            ];

            const currentDemo = demos[demoIndex];

            // Auto-loop animation
            useEffect(() => {
                const timers = [];

                // Phase 1: Show original (2s)
                timers.push(setTimeout(() => setPhase('correcting'), 2000));

                // Phase 2: Correcting animation (800ms)
                timers.push(setTimeout(() => setPhase('corrected'), 2800));

                // Phase 3: Show corrected (2s)
                timers.push(setTimeout(() => setPhase('waiting'), 4800));

                // Phase 4: Next demo (500ms fade)
                timers.push(setTimeout(() => {
                    setDemoIndex((prev) => (prev + 1) % demos.length);
                    setPhase('showing');
                }, 5300));

                return () => timers.forEach(t => clearTimeout(t));
            }, [demoIndex]);

            const displayText = phase === 'showing' || phase === 'correcting' ? currentDemo.original : currentDemo.corrected;

            return (
                <div className="demo-section">
                    <div className="demo-card">
                        <div className="demo-header">
                            <h2 className="demo-title">With AI Context Correction Engine</h2>
                            <div className="demo-indicator">
                                <div className={`indicator-dot ${phase === 'correcting' ? 'active' : ''}`}></div>
                                <span className="indicator-text">
                                    {phase === 'showing' && 'Listening...'}
                                    {phase === 'correcting' && 'Correcting...'}
                                    {(phase === 'corrected' || phase === 'waiting') && 'Corrected âœ“'}
                                </span>
                            </div>
                        </div>
                        <div className="demo-box">
                            <div className={`demo-text phase-${phase}`}>
                                {displayText}
                            </div>
                        </div>
                        <div className="demo-progress">
                            {demos.map((_, idx) => (
                                <div
                                    key={idx}
                                    className={`progress-dot ${idx === demoIndex ? 'active' : ''}`}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        function TypeWriter({ text, delay = 50, startDelay = 0, className = '', showCursor = true }) {
            const [displayText, setDisplayText] = useState('');
            const [currentIndex, setCurrentIndex] = useState(0);
            const [started, setStarted] = useState(startDelay === 0);
            const isComplete = currentIndex >= text.length;

            useEffect(() => {
                if (startDelay > 0 && !started) {
                    const startTimer = setTimeout(() => setStarted(true), startDelay);
                    return () => clearTimeout(startTimer);
                }
            }, [startDelay, started]);

            useEffect(() => {
                if (started && currentIndex < text.length) {
                    const timer = setTimeout(() => {
                        setDisplayText(prev => prev + text[currentIndex]);
                        setCurrentIndex(prev => prev + 1);
                    }, delay);

                    return () => clearTimeout(timer);
                }
            }, [started, currentIndex, text, delay]);

            return (
                <span className={`${className} ${showCursor && !isComplete ? 'typing-cursor' : ''}`}>
                    {displayText}
                </span>
            );
        }

        function LandingPage({ onStartDashboard, onShowAbout, onShowAISettings, onShowDemoAnalytics, language, setLanguage, t }) {
            const [expandedFAQ, setExpandedFAQ] = useState(null);

            const toggleFAQ = (index) => {
                setExpandedFAQ(expandedFAQ === index ? null : index);
            };

            return (
                <div className="landing-page">
                    <div className="blob-container">
                        <div className="blob blob-1"></div>
                        <div className="blob blob-2"></div>
                        <div className="blob blob-3"></div>
                        <div className="blob blob-4"></div>
                        <div className="blob blob-5"></div>
                    </div>
                    <header className="landing-header">
                        <div className="logo-section">
                            <div className="logo-icon">
                                <div className="logo-bar logo-bar-1"></div>
                                <div className="logo-bar logo-bar-2"></div>
                                <div className="logo-bar logo-bar-3"></div>
                            </div>
                            <div>
                                <div className="logo-text">
                                    COMMUNITY<br/>CAPTIONER <span className="cc-inline">CC</span>
                                </div>
                                <span className="badge-tag">Free, Open Source Captions + More</span>
                            </div>
                        </div>
                        <div style={{display: 'flex', gap: '12px', alignItems: 'center'}}>
                            <select
                                value={language}
                                onChange={(e) => setLanguage(e.target.value)}
                                style={{
                                    padding: '8px 12px',
                                    background: 'var(--bg-white)',
                                    color: 'var(--text-dark)',
                                    border: '2px solid var(--border-sage)',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                    fontFamily: 'DM Sans, sans-serif'
                                }}
                            >
                                <option value="en">English</option>
                                <option value="es">EspaÃ±ol</option>
                                <option value="pt">PortuguÃªs</option>
                                <option value="fr">FranÃ§ais</option>
                            </select>
                            <button
                                onClick={onShowAISettings}
                                style={{
                                    padding: '8px 16px',
                                    background: 'var(--sage-primary)',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '500'
                                }}
                            >
                                {t('AI Settings')}
                            </button>
                        </div>
                    </header>

                    <section className="hero-section">
                        <h1 className="hero-title">
                            <TypeWriter text={t('AI for Accessibility')} delay={80} key={language + '-title'} />
                        </h1>

                        <p className="hero-subtitle">
                            <TypeWriter
                                text={t('Live captioning and analysis tools for community media. Zero cost. Open Source. Powered by AI + Human intelligence for the public good.')}
                                delay={30}
                                startDelay={1600}
                                key={language + '-subtitle'}
                            />
                        </p>

                        <div className="cta-buttons">
                            <button className="cta-btn cta-btn-primary" onClick={onStartDashboard}>
                                {t('Open Control Dashboard')}
                            </button>
                            <button className="cta-btn cta-btn-secondary" onClick={() => {
                                document.getElementById('about-section')?.scrollIntoView({ behavior: 'smooth' });
                            }}>
                                {t('Learn More')}
                            </button>
                        </div>

                        <CaptionDemo />
                    </section>

                    {/* How It Works Section */}
                    <section className="info-section howto-section" style={{marginTop: '60px'}}>
                        <h2 className="section-title">How It Works</h2>
                        <p className="section-subtitle">
                            Understanding the captioning workflow from audio input to corrected text output
                        </p>

                        <div className="howto-grid">
                            <div className="howto-card">
                                <div className="howto-step-number">1</div>
                                <div className="howto-icon">
                                    <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" strokeWidth="2.5">
                                        <circle cx="24" cy="16" r="6"/>
                                        <path d="M12 38c0-6.6 5.4-12 12-12s12 5.4 12 12"/>
                                        <path d="M24 32v6M21 35h6" strokeLinecap="round"/>
                                    </svg>
                                </div>
                                <h3 className="howto-title">Generate Captions</h3>
                                <p className="howto-desc">
                                    Audio from your microphone, mixer, or any input device is captured and streamed to the ASR engine in real-time. Choose between two approaches: Browser Mode uses built-in Web Speech API (fast, ~200ms, requires internet) or Whisper Mode uses OpenAI's open-source model running locally (more accurate, 2-4s latency, works offline).
                                </p>
                                <div className="howto-features">
                                    <span className="howto-feature-tag">Browser Mode</span>
                                    <span className="howto-feature-tag">Whisper AI</span>
                                    <span className="howto-feature-tag">Real-time</span>
                                </div>
                            </div>

                            <div className="howto-card">
                                <div className="howto-step-number">2</div>
                                <div className="howto-icon">
                                    <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" strokeWidth="2.5">
                                        <circle cx="24" cy="24" r="14"/>
                                        <path d="M18 24l4 4 8-10" strokeLinecap="round" strokeLinejoin="round"/>
                                        <circle cx="38" cy="10" r="6" fill="currentColor" opacity="0.2"/>
                                        <path d="M35 10h6M38 7v6" strokeWidth="2" strokeLinecap="round"/>
                                    </svg>
                                </div>
                                <h3 className="howto-title">Create a Custom AI Caption Engine that Learns</h3>
                                <p className="howto-desc">
                                    Drag and drop documents, videos, and web sources to build a picture of your local context. Then AI crafts a custom dictionary of proper names, places, etc, relevant to you. This is called Retrieval Augmented Generation (RAG), with semantic matching and fuzzy detection. All at no additional cost.
                                </p>
                                <div className="howto-features">
                                    <span className="howto-feature-tag">Auto-Extract</span>
                                    <span className="howto-feature-tag">RAG Engine</span>
                                    <span className="howto-feature-tag">Zero Cost</span>
                                </div>
                            </div>

                            <div className="howto-card">
                                <div className="howto-step-number">3</div>
                                <div className="howto-icon">
                                    <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" strokeWidth="2.5">
                                        <circle cx="24" cy="24" r="14"/>
                                        <path d="M18 24l4 4 8-10" strokeLinecap="round" strokeLinejoin="round"/>
                                        <path d="M24 10v8M16 24h16" strokeWidth="2" strokeLinecap="round"/>
                                    </svg>
                                </div>
                                <h3 className="howto-title">AI Correction</h3>
                                <p className="howto-desc">
                                    The RAG Caption Engine corrects proper nouns using your custom vocabulary. "Bernard green" becomes "Bernard Greene" and "Brooklyn" becomes "Brookline" automatically. It does this both in real time and lets you do another, more accurate pass afterwards when speed is less of a concern.
                                </p>
                                <div className="howto-features">
                                    <span className="howto-feature-tag">Real-time</span>
                                    <span className="howto-feature-tag">Post-process</span>
                                    <span className="howto-feature-tag">Accurate</span>
                                </div>
                            </div>

                            <div className="howto-card">
                                <div className="howto-step-number">4</div>
                                <div className="howto-icon">
                                    <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" strokeWidth="2.5">
                                        <rect x="8" y="10" width="32" height="22" rx="3"/>
                                        <path d="M8 26h32"/>
                                        <rect x="14" y="34" width="20" height="4" rx="1" fill="currentColor" opacity="0.3"/>
                                        <path d="M14 18h20M14 22h12" strokeLinecap="round"/>
                                    </svg>
                                </div>
                                <h3 className="howto-title">Display & Record</h3>
                                <p className="howto-desc">
                                    Corrected captions display in a 1920x1080 overlay ready for broadcast and streaming, anywhere that accepts dynamic text. You can customize the look, feel, and size/position of captions on the fly. Also record sessions and export to SRT, VTT, or JSON for post production and other workflows.
                                </p>
                                <div className="howto-features">
                                    <span className="howto-feature-tag">SRT</span>
                                    <span className="howto-feature-tag">VTT</span>
                                    <span className="howto-feature-tag">Customizable</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Data Analytics Section */}
                    <section className="info-section" style={{background: 'linear-gradient(135deg, rgba(125, 155, 118, 0.05) 0%, rgba(139, 127, 199, 0.05) 100%)', padding: '60px 40px', borderRadius: 'var(--radius-xl)', marginTop: '60px'}}>
                        <h2 className="section-title">Built-In Data Analytics, Summarization, & Video Editing Tools</h2>
                        <p className="section-subtitle" style={{maxWidth: '900px', margin: '0 auto 40px'}}>
                            Every captioning session automatically generates rich analytics data that goes far beyond simple transcripts. Upload your associated video to sync it with captions for powerful search capabilities, or let the AI magically cut together a 1-2 minute highlight reel from hours of footage.
                        </p>

                        <div className="info-grid" style={{marginBottom: '40px'}}>
                            <div className="info-card">
                                <h3>Automatic Session Analytics</h3>
                                <p>
                                    The moment you stop recording, Community Captioner generates comprehensive analytics automatically. Word frequency analysis, sentiment timelines, topic detection, correction heatmaps, and quality metricsâ€”all without lifting a finger.
                                </p>
                                <p>
                                    Track which terms were corrected most frequently, analyze the pace of speech over time, and identify key discussion topics. Perfect for meeting summaries and archival research.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>AI-Powered Video Intelligence</h3>
                                <p>
                                    Upload the video file from your session and sync it with your captions. The AI analyzes the entire transcript to identify the most important momentsâ€”decisions, votes, announcements, heated discussions.
                                </p>
                                <p>
                                    With one click, the system uses ffmpeg to extract and compile these moments into a professional highlight reel. Turn a 3-hour town meeting into a 90-second recap automatically.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Full-Text Search Across Video</h3>
                                <p>
                                    Once your video is synced with captions, you can search the entire recording by keyword. Looking for when "budget" was discussed? Instantly jump to every moment it was mentioned.
                                </p>
                                <p>
                                    Export clips of specific discussions, create timestamp links for sharing, or generate indexed videos where viewers can navigate by topic.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Unique Data Richness</h3>
                                <p>
                                    Unlike commercial captioning systems that just output text, Community Captioner tracks every correction made, when it was made, and why. This metadata reveals patterns in how ASR systems fail on your local terminology.
                                </p>
                                <p>
                                    Export all data as JSON for custom analysis, integrate with your archival systems, or use the built-in word clouds and charts to visualize your meetings.
                                </p>
                            </div>
                        </div>

                        {/* Demo Analytics Preview */}
                        <div style={{background: 'white', borderRadius: 'var(--radius-lg)', padding: '32px', border: '2px solid var(--border-sage)', boxShadow: '0 4px 12px rgba(0,0,0,0.08)'}}>
                            <h3 style={{fontSize: '20px', fontWeight: '700', color: 'var(--sage-darker)', marginBottom: '20px', textAlign: 'center'}}>
                                Sample Analytics Dashboard Preview
                            </h3>

                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', marginBottom: '24px'}}>
                                <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: 'var(--radius-md)', textAlign: 'center'}}>
                                    <div style={{fontSize: '32px', fontWeight: '800', color: 'var(--sage-darker)'}}>12,847</div>
                                    <div style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>Total Words</div>
                                </div>
                                <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: 'var(--radius-md)', textAlign: 'center'}}>
                                    <div style={{fontSize: '32px', fontWeight: '800', color: 'var(--sage-darker)'}}>2:43:16</div>
                                    <div style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>Duration</div>
                                </div>
                                <div style={{background: 'rgba(139, 127, 199, 0.15)', padding: '20px', borderRadius: 'var(--radius-md)', textAlign: 'center'}}>
                                    <div style={{fontSize: '32px', fontWeight: '800', color: 'var(--purple-accent)'}}>234</div>
                                    <div style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>AI Corrections</div>
                                </div>
                                <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: 'var(--radius-md)', textAlign: 'center'}}>
                                    <div style={{fontSize: '32px', fontWeight: '800', color: 'var(--sage-darker)'}}>78</div>
                                    <div style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>Words/Minute</div>
                                </div>
                            </div>

                            <div style={{textAlign: 'center', marginTop: '24px'}}>
                                <button
                                    onClick={onShowDemoAnalytics}
                                    style={{
                                        background: 'linear-gradient(135deg, var(--sage-primary) 0%, var(--sage-dark) 100%)',
                                        color: 'white',
                                        border: 'none',
                                        padding: '14px 32px',
                                        borderRadius: 'var(--radius-md)',
                                        fontSize: '16px',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        boxShadow: '0 4px 12px rgba(125, 155, 118, 0.3)',
                                        transition: 'all 0.2s'
                                    }}
                                    onMouseOver={(e) => {
                                        e.target.style.transform = 'translateY(-2px)';
                                        e.target.style.boxShadow = '0 6px 16px rgba(125, 155, 118, 0.4)';
                                    }}
                                    onMouseOut={(e) => {
                                        e.target.style.transform = 'translateY(0)';
                                        e.target.style.boxShadow = '0 4px 12px rgba(125, 155, 118, 0.3)';
                                    }}
                                >
                                    View Full Demo Analytics â†’
                                </button>
                            </div>
                        </div>
                    </section>

                    {/* About Section */}
                    <section id="about-section" className="info-section about-section">
                        <h2 className="section-title">About Community Captioner</h2>
                        <p className="section-subtitle">
                            Free, open-source live captioning built for community media organizations
                        </p>

                        <div className="info-grid">
                            <div className="info-card">
                                <h3>Why It Exists</h3>
                                <p>
                                    Community Captioner was created at Brookline Interactive Group (BIG) in 2026. BIG is a nonprofit community media center in Brookline, MA, and the Town's public access TV provider. It needed live captions for town meetings and local programming but really struggled to afford commercial AI or live human solutions. After being quoted $30k for one such automated solution, we decided to make our own and make it free for everyone. We don't believe anyone should gatekeep accessibility.
                                </p>
                                <p>
                                    This tool provides effective, low-latency, automatic speech-to-text captioning at zero cost, using either browser APIs or open source local libraries (your choice). Bring it into your live stream or broadcast the way you would dynamic graphics.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>What Makes It Unique</h3>
                                <p>
                                    Generic speech recognition systems fail on local proper nouns. They transcribe "Bernard Greene" as "bernard green" and "Brookline" as "Brooklyn."
                                </p>
                                <p>
                                    The <strong>AI Caption Engine</strong> uses RAG (Retrieval Augmented Generation) to automatically correct these errors based on your community's specific vocabulary.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>How RAG Works</h3>
                                <p>
                                    RAG stands for Retrieval Augmented Generation. Here's how it corrects captions:
                                </p>
                                <ul>
                                    <li>You upload documents (meeting agendas, staff directories, etc.)</li>
                                    <li>AI extracts proper nouns (people, places, organizations)</li>
                                    <li>System builds a local correction dictionary</li>
                                    <li>Incoming captions are matched and corrected in real-time</li>
                                </ul>
                            </div>

                            <div className="info-card">
                                <h3>New Legal Requirements</h3>
                                <p>
                                    The FCC's 21st Century Communications and Video Accessibility Act (CVAA) and upcoming state-level legislation increasingly require live captioning for government meetings and public broadcasts.
                                </p>
                                <p>
                                    Massachusetts LD 1937 and similar bills nationwide mandate that all public meetings provide real-time captioning by 2027. Community Captioner offers a compliant, zero-cost solution for municipalities facing these requirements.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Design Values</h3>
                                <ul>
                                    <li><strong>Zero Dependencies:</strong> Works in any browser, no installation required</li>
                                    <li><strong>Privacy First:</strong> Can run 100% locally with Whisper AI</li>
                                    <li><strong>Community Focused:</strong> Built for local governments and community media</li>
                                    <li><strong>Free Forever:</strong> Open source under CC BY-NC-SA 4.0 license (non-commercial use only)</li>
                                    <li><strong>No Catch:</strong> For real, we are not monetizing this app in any way, and there is no cost to us when anyone else uses it</li>
                                    <li><strong>Human AI:</strong> Software like this does not replace the richness of live human-typed captions, but it tries to fill a gap so accessibility is no longer a cost-prohibitive matter for many</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    {/* Adding to Your Broadcasts Section */}
                    <section className="info-section">
                        <h2 className="section-title">Adding to Your Broadcasts</h2>
                        <p className="section-subtitle">
                            Multiple ways to integrate live captions into your streams and broadcasts
                        </p>

                        <div className="info-grid">
                            <div className="info-card">
                                <h3>ASR Options</h3>
                                <p>
                                    <strong>ASR (Automatic Speech Recognition)</strong> is the technology that converts spoken words into text. Community Captioner offers two approaches:
                                </p>
                                <p>
                                    <strong>Browser Mode:</strong> Uses your browser's Web Speech API. Ultra-fast (~200ms latency), requires Chrome/Edge and internet connection. Best for live events where speed matters most.
                                </p>
                                <p>
                                    <strong>Whisper (Open Source):</strong> OpenAI's Whisper AI model running locally on your computer. More accurate, works offline, but has 2-4 second latency. Perfect for recordings or when accuracy is critical.
                                </p>
                            </div>

                            <div className="info-card">
                                <h3>Broadcast Integration</h3>
                                <p>
                                    The caption overlay (1920x1080) can be added to your broadcasts in several ways:
                                </p>
                                <ul>
                                    <li><strong>OBS Browser Source:</strong> Add the overlay URL as a browser source in OBS Studio. Position and style as needed.</li>
                                    <li><strong>vMix / Switcher:</strong> Use the browser input feature to load the overlay URL into your production switcher.</li>
                                    <li><strong>Dynamic Key/Fill:</strong> Use the overlay as a downstream key with luma key or alpha channel for transparent backgrounds.</li>
                                    <li><strong>NDI / RTMP:</strong> Capture the browser window with NDI Tools or similar for network streaming.</li>
                                </ul>
                            </div>

                            <div className="info-card">
                                <h3>Audio Sources</h3>
                                <p>
                                    You can caption audio from multiple sources:
                                </p>
                                <ul>
                                    <li><strong>System Microphone:</strong> Use your computer's default mic or any connected USB microphone.</li>
                                    <li><strong>Mixer Feed:</strong> Route audio from your broadcast mixer into your computer via USB, Dante, or audio interface.</li>
                                    <li><strong>Virtual Audio Cable:</strong> Use tools like VB-Cable or BlackHole to route any system audio to the captioning engine.</li>
                                    <li><strong>Live Stream Audio:</strong> Capture audio from a live stream URL using ffmpeg or audio routing software.</li>
                                    <li><strong>Pre-recorded Video:</strong> Upload MP4/MOV files for automatic transcription and highlight generation.</li>
                                </ul>
                            </div>

                            <div className="info-card">
                                <h3>Zero Additional Equipment</h3>
                                <p>
                                    Community Captioner was designed to work with tools community media stations already have:
                                </p>
                                <ul>
                                    <li>No specialized hardware encoders required</li>
                                    <li>No expensive cloud subscriptions needed</li>
                                    <li>Works with your existing production workflow</li>
                                    <li>Compatible with any streaming software that supports browser sources</li>
                                    <li>Can run on the same computer as your streaming software or a separate machine</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    {/* Architecture Section */}
                    <section className="info-section architecture-section" style={{textAlign: 'center'}}>
                        <h2 className="section-title">System Architecture</h2>
                        <p className="section-subtitle">
                            How the v4.0 AI-powered captioning pipeline works â€” hover over each component for details
                        </p>

                        <div className="architecture-diagram" style={{margin: '0 auto', display: 'flex', flexDirection: 'column', alignItems: 'center'}}>
                            <div className="arch-row">
                                <div className="arch-box arch-input">
                                    <div className="arch-tooltip">
                                        Audio input from your microphone is captured and streamed to the ASR engine.
                                        <br/><br/>
                                        <a href="https://en.wikipedia.org/wiki/Microphone" target="_blank" rel="noopener">Learn about microphones â†’</a>
                                    </div>
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <rect x="12" y="4" width="8" height="14" rx="4" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M8 14c0 4.4 3.6 8 8 8s8-3.6 8-8" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M16 22v6M12 28h8" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">Speech Input</div>
                                    <div className="arch-detail">Microphone</div>
                                </div>
                                <div className="arch-arrow">â†’</div>
                                <div className="arch-box arch-asr">
                                    <div className="arch-tooltip">
                                        Automatic Speech Recognition converts audio to text. Use Browser API for speed or Whisper for accuracy.
                                        <br/><br/>
                                        <a href="https://en.wikipedia.org/wiki/Speech_recognition" target="_blank" rel="noopener">Learn about ASR â†’</a>
                                    </div>
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <rect x="6" y="4" width="20" height="24" rx="2" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M10 10h12M10 14h8M10 18h10M10 22h6" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">ASR Engine</div>
                                    <div className="arch-detail">Browser / Whisper</div>
                                </div>
                                <div className="arch-arrow">â†’</div>
                                <div className="arch-box arch-rag special">
                                    <div className="arch-tooltip" style={{background: 'var(--purple-accent)'}}>
                                        RAG uses vector embeddings and semantic search to correct proper nouns in real-time. The core v4.0 feature.
                                        <br/><br/>
                                        <a href="https://en.wikipedia.org/wiki/Retrieval-augmented_generation" target="_blank" rel="noopener" style={{color: '#C8E6C9'}}>Learn about RAG â†’</a>
                                    </div>
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <circle cx="16" cy="16" r="10" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M12 16l3 3 5-6" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">RAG Engine v4.0</div>
                                    <div className="arch-detail">Semantic Matching</div>
                                </div>
                                <div className="arch-arrow">â†’</div>
                                <div className="arch-box arch-output">
                                    <div className="arch-tooltip">
                                        Corrected captions are displayed in a browser overlay that can be added to OBS, vMix, or any streaming software.
                                        <br/><br/>
                                        <a href="https://en.wikipedia.org/wiki/OBS_Studio" target="_blank" rel="noopener">Learn about OBS â†’</a>
                                    </div>
                                    <div className="arch-icon">
                                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                            <rect x="4" y="6" width="24" height="16" rx="2" stroke="currentColor" strokeWidth="2"/>
                                            <path d="M8 14h16M8 18h10" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                                            <rect x="10" y="24" width="12" height="3" rx="1" fill="currentColor" opacity="0.3"/>
                                        </svg>
                                    </div>
                                    <div className="arch-label">Live Overlay</div>
                                    <div className="arch-detail">OBS / Stream</div>
                                </div>
                            </div>

                            <div className="arch-connector-line"></div>

                            <div className="arch-secondary">
                                <div className="arch-row arch-row-secondary">
                                    <div className="arch-box arch-kb">
                                        <div className="arch-tooltip">
                                            Upload PDFs, DOCX, or paste text. AI extracts names, places, and organizations to build correction rules.
                                            <br/><br/>
                                            <a href="https://en.wikipedia.org/wiki/Knowledge_base" target="_blank" rel="noopener">Learn about knowledge bases â†’</a>
                                        </div>
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M4 6h16M4 10h16M4 14h12M4 18h8" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">Knowledge Base</div>
                                        <div className="arch-detail">Documents, URLs</div>
                                    </div>
                                    <div className="arch-box arch-embed">
                                        <div className="arch-tooltip">
                                            Text is converted to vector embeddings for semantic similarity matching. Finds "Bernard Greene" even when ASR outputs "bernard green".
                                            <br/><br/>
                                            <a href="https://en.wikipedia.org/wiki/Word_embedding" target="_blank" rel="noopener">Learn about embeddings â†’</a>
                                        </div>
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <circle cx="12" cy="12" r="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                                <circle cx="12" cy="12" r="3" fill="currentColor" opacity="0.3"/>
                                                <path d="M12 4v3M12 17v3M4 12h3M17 12h3" stroke="currentColor" strokeWidth="1.5"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">Embeddings</div>
                                        <div className="arch-detail">Vector Search</div>
                                    </div>
                                    <div className="arch-box arch-learn">
                                        <div className="arch-tooltip">
                                            The system observes ASR mistakes and automatically builds correction patterns. Gets smarter over time.
                                            <br/><br/>
                                            <a href="https://en.wikipedia.org/wiki/Machine_learning" target="_blank" rel="noopener">Learn about ML â†’</a>
                                        </div>
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M4 18l4-4 4 4 8-10" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">ASR Learner</div>
                                        <div className="arch-detail">Auto-Improve</div>
                                    </div>
                                    <div className="arch-box arch-analytics">
                                        <div className="arch-tooltip">
                                            Track session statistics, word frequency, sentiment analysis, and export detailed reports.
                                            <br/><br/>
                                            <a href="https://en.wikipedia.org/wiki/Text_mining" target="_blank" rel="noopener">Learn about text analytics â†’</a>
                                        </div>
                                        <div className="arch-icon small">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <rect x="4" y="14" width="4" height="6" fill="currentColor" opacity="0.3"/>
                                                <rect x="10" y="10" width="4" height="10" fill="currentColor" opacity="0.5"/>
                                                <rect x="16" y="6" width="4" height="14" fill="currentColor" opacity="0.7"/>
                                            </svg>
                                        </div>
                                        <div className="arch-label">Analytics</div>
                                        <div className="arch-detail">Insights</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="arch-caption">
                            The v4.0 RAG engine uses vector embeddings for semantic similarity matching,
                            fuzzy detection for typos, and learns from ASR mistakes to improve over time.
                        </div>
                    </section>

                    {/* Values Section */}
                    <section className="info-section values-section">
                        <h2 className="section-title">Our Values</h2>
                        <p className="section-subtitle">
                            Community Captioner is built on principles of accessibility, openness, and empowerment
                        </p>

                        <div className="info-grid">
                            <div className="info-card">
                                <div className="value-icon">
                                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" strokeWidth="2">
                                        <circle cx="16" cy="16" r="12"/>
                                        <circle cx="16" cy="12" r="4"/>
                                        <path d="M10 24c0-3.3 2.7-6 6-6s6 2.7 6 6"/>
                                    </svg>
                                </div>
                                <h3>Accessibility First</h3>
                                <p>
                                    Everyone deserves access to information. Captioning shouldn't be a luxury for those who can afford expensive equipment. We're democratizing accessibility technology for community organizations worldwide.
                                </p>
                            </div>

                            <div className="info-card">
                                <div className="value-icon">
                                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" strokeWidth="2">
                                        <path d="M16 4l12 7v10l-12 7-12-7V11l12-7z"/>
                                        <path d="M16 14v8M12 16h8" strokeLinecap="round"/>
                                    </svg>
                                </div>
                                <h3>Truly Open Source</h3>
                                <p>
                                    No vendor lock-in, no hidden costs, no paywalls. Our code is open (CC BY-NC-SA 4.0), our data stays with you, and you can modify everything to fit your needs. This is your tool, not ours. Non-commercial use onlyâ€”no one can profit from this work.
                                </p>
                            </div>

                            <div className="info-card">
                                <div className="value-icon">
                                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" strokeWidth="2">
                                        <circle cx="10" cy="10" r="4"/>
                                        <circle cx="22" cy="10" r="4"/>
                                        <circle cx="16" cy="22" r="4"/>
                                        <path d="M12 13l3 6M20 13l-3 6M13 10h6"/>
                                    </svg>
                                </div>
                                <h3>Community-Powered</h3>
                                <p>
                                    Built by community media for community media. We understand your workflows, budgets, and challenges because we live them. Share your correction engines, help each other, lift all boats together.
                                </p>
                            </div>

                            <div className="info-card">
                                <div className="value-icon">
                                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" strokeWidth="2">
                                        <rect x="6" y="10" width="20" height="16" rx="2"/>
                                        <path d="M10 10V8a6 6 0 0112 0v2"/>
                                        <circle cx="16" cy="18" r="2" fill="currentColor"/>
                                        <path d="M16 20v3"/>
                                    </svg>
                                </div>
                                <h3>Privacy by Design</h3>
                                <p>
                                    Your content, your control. Run everything locally with Whisper mode. Use local AI providers. No telemetry, no tracking, no data mining. Government meetings and sensitive content stay private.
                                </p>
                            </div>

                            <div className="info-card">
                                <div className="value-icon">
                                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" strokeWidth="2">
                                        <circle cx="10" cy="16" r="5"/>
                                        <path d="M22 11c-3 0-5 2-5 5s2 5 5 5" fill="none"/>
                                        <path d="M19 13l3 3-3 3"/>
                                        <circle cx="22" cy="16" r="1" fill="currentColor"/>
                                        <path d="M15 16h-2"/>
                                    </svg>
                                </div>
                                <h3>Human + AI Collaboration</h3>
                                <p>
                                    AI isn't magic and it's not perfect. We combine the speed of AI with human knowledge of local communities. You teach the engine your vocabulary - it handles the repetitive corrections.
                                </p>
                            </div>

                            <div className="info-card">
                                <div className="value-icon">
                                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" strokeWidth="2">
                                        <path d="M8 6h16v20H8z" rx="1"/>
                                        <path d="M12 12h8M12 16h8M12 20h4"/>
                                        <path d="M20 18l2 2 4-5" strokeLinecap="round" strokeLinejoin="round"/>
                                    </svg>
                                </div>
                                <h3>Legal Compliance Made Simple</h3>
                                <p>
                                    FCC CVAA requirements and state captioning laws apply to you. Commercial solutions cost tens of thousands. We provide the same compliance for free, because accessibility is a right, not a privilege.
                                </p>
                            </div>
                        </div>
                    </section>

                    {/* FAQ Section */}}
                    <section className="info-section faq-section">
                        <h2 className="section-title">Frequently Asked Questions</h2>

                        <div className={`faq-item ${expandedFAQ === 0 ? 'expanded' : ''}`} onClick={() => toggleFAQ(0)}>
                            <div className="faq-question">
                                Do I need an OpenAI API key?
                                <span className="faq-toggle">{expandedFAQ === 0 ? 'âˆ’' : '+'}</span>
                            </div>
                            {expandedFAQ === 0 && (
                                <div className="faq-answer">
                                    No! The basic captioning features work without any AI. You only need an API key if you want AI-powered features like automatic term extraction from documents or session summaries. You can also use local AI providers like Ollama or LM Studio for free.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 1 ? 'expanded' : ''}`} onClick={() => toggleFAQ(1)}>
                            <div className="faq-question">
                                What's the difference between Browser Mode and Whisper Mode?
                                <span className="faq-toggle">{expandedFAQ === 1 ? 'âˆ’' : '+'}</span>
                            </div>
                            {expandedFAQ === 1 && (
                                <div className="faq-answer">
                                    <strong>Browser Mode:</strong> Uses your browser's built-in speech recognition (Web Speech API). Fast (~200ms latency) but requires Chrome/Edge and internet connection. Less accurate with proper nouns.<br/><br/>
                                    <strong>Whisper Mode:</strong> Uses OpenAI's Whisper AI model running locally on your computer. More accurate, works offline, but has 2-4 second latency. Requires Python and faster-whisper installation.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 2 ? 'expanded' : ''}`} onClick={() => toggleFAQ(2)}>
                            <div className="faq-question">
                                Can I use this for live streaming?
                                <span className="faq-toggle">{expandedFAQ === 2 ? 'âˆ’' : '+'}</span>
                            </div>
                            {expandedFAQ === 2 && (
                                <div className="faq-answer">
                                    Yes! The overlay URL can be added to OBS, vMix, or any streaming software that supports browser sources. Captions will appear live on your stream.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 3 ? 'expanded' : ''}`} onClick={() => toggleFAQ(3)}>
                            <div className="faq-question">
                                How do I share my correction engine with other organizations?
                                <span className="faq-toggle">{expandedFAQ === 3 ? 'âˆ’' : '+'}</span>
                            </div>
                            {expandedFAQ === 3 && (
                                <div className="faq-answer">
                                    Click "Configure Engine" â†’ "Download Engine" to export your correction rules as a JSON file. Other organizations can import this file to instantly get your community's vocabulary. Perfect for sharing between towns or sister organizations.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 4 ? 'expanded' : ''}`} onClick={() => toggleFAQ(4)}>
                            <div className="faq-question">
                                Is my data private?
                                <span className="faq-toggle">{expandedFAQ === 4 ? 'âˆ’' : '+'}</span>
                            </div>
                            {expandedFAQ === 4 && (
                                <div className="faq-answer">
                                    <strong>Browser Mode:</strong> Audio is sent to Google/Microsoft's servers for transcription.<br/>
                                    <strong>Whisper Mode:</strong> Everything stays on your computer. No data leaves your machine.<br/>
                                    <strong>AI Features:</strong> If using OpenAI, document text is sent for processing. If using Ollama/LM Studio, everything stays local.
                                </div>
                            )}
                        </div>

                        <div className={`faq-item ${expandedFAQ === 5 ? 'expanded' : ''}`} onClick={() => toggleFAQ(5)}>
                            <div className="faq-question">
                                What file formats can I export?
                                <span className="faq-toggle">{expandedFAQ === 5 ? 'âˆ’' : '+'}</span>
                            </div>
                            {expandedFAQ === 5 && (
                                <div className="faq-answer">
                                    Sessions can be exported as SRT (subtitles), VTT (web video), TXT (plain transcript), or JSON (full data including corrections and timestamps). Perfect for archival or post-production editing.
                                </div>
                            )}
                        </div>
                    </section>

                    {/* Learn More Button */}
                    <div style={{textAlign: 'center', marginTop: '60px', marginBottom: '40px'}}>
                        <button className="cta-btn cta-btn-secondary" onClick={onShowAbout}>
                            Learn More About the Technology + Design Philosophy
                        </button>
                    </div>

                    {/* Footer */}
                    <footer className="site-footer">
                        <div className="footer-content">
                            <div className="footer-text">
                                A <a href="https://community.weirdmachine.org" target="_blank" rel="noopener noreferrer">Community AI Project</a> from <a href="https://brooklineinteractive.org" target="_blank" rel="noopener noreferrer">Brookline Interactive Group</a> in partnership with <a href="https://neighborhoodai.org" target="_blank" rel="noopener noreferrer">Neighborhood AI</a>
                                <br/>
                                Designed and developed by <a href="https://weirdmachine.org" target="_blank" rel="noopener noreferrer">Stephen Walter</a> + AI
                            </div>

                            <div className="footer-logos">
                                <img src="/big-logo.png" alt="Brookline Interactive Group" className="footer-logo" style={{height: '70px'}} />
                                <a href="https://weirdmachine.org" target="_blank" rel="noopener noreferrer" style={{display: 'flex', alignItems: 'center'}}>
                                    <svg width="140" height="70" viewBox="0 0 280 140" fill="none" xmlns="http://www.w3.org/2000/svg" style={{opacity: 0.95}}>
                                        <rect x="4" y="4" width="272" height="132" stroke="white" strokeWidth="3" fill="none"/>
                                        <rect x="10" y="10" width="260" height="120" stroke="white" strokeWidth="1.5" fill="none"/>
                                        <text x="140" y="58" textAnchor="middle" fill="white" fontFamily="DM Sans, sans-serif" fontSize="32" fontWeight="800" letterSpacing="4">WEIRD</text>
                                        <text x="140" y="98" textAnchor="middle" fill="white" fontFamily="DM Sans, sans-serif" fontSize="32" fontWeight="800" letterSpacing="4">MACHINE</text>
                                    </svg>
                                </a>
                            </div>

                            <div className="footer-links">
                                <a href="https://github.com/weirdmachine-org/community-captioner-v2" target="_blank" rel="noopener noreferrer" className="footer-icon-link" title="View on GitHub">
                                    <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                </a>
                            </div>

                            <div style={{display: 'flex', gap: '24px', alignItems: 'center', marginTop: '8px'}}>
                                <a href="terms.html" style={{color: '#A5D6A7', textDecoration: 'none', fontSize: '14px', fontWeight: '600'}}>
                                    Terms of Service
                                </a>
                                <span style={{color: 'rgba(255,255,255,0.3)'}}>â€¢</span>
                                <button
                                    onClick={() => {
                                        const subject = encodeURIComponent('Community Captioner Feedback');
                                        const body = encodeURIComponent('Please share your feedback below:\n\n');
                                        window.location.href = `mailto:Stephen@weirdmachine.org?subject=${subject}&body=${body}`;
                                    }}
                                    style={{
                                        background: 'transparent',
                                        border: '2px solid #A5D6A7',
                                        color: '#A5D6A7',
                                        padding: '8px 16px',
                                        borderRadius: 'var(--radius-sm)',
                                        fontSize: '14px',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s',
                                        fontFamily: 'inherit'
                                    }}
                                    onMouseOver={(e) => {
                                        e.target.style.background = '#A5D6A7';
                                        e.target.style.color = 'var(--sage-darker)';
                                    }}
                                    onMouseOut={(e) => {
                                        e.target.style.background = 'transparent';
                                        e.target.style.color = '#A5D6A7';
                                    }}
                                >
                                    Send Feedback
                                </button>
                            </div>

                            <div className="footer-license">
                                Licensed under CC BY-NC-SA 4.0 â€” Free to use, modify, and share with attribution for non-commercial purposes only
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        // Session Analysis Page Component - Post-session data analysis
        function SessionAnalysisPage({ data, onBack, t }) {
            // Collapsible section states
            const [showTranscript, setShowTranscript] = useState(true);
            const [showCorrections, setShowCorrections] = useState(true);
            const [showAnalytics, setShowAnalytics] = useState(false);

            // Search and filter states
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedWord, setSelectedWord] = useState(null);

            // AI Analysis state
            const [aiAnalysis, setAiAnalysis] = useState(null);
            const [aiAnalysisLoading, setAiAnalysisLoading] = useState(false);

            // Whisper reprocessing state
            const [reprocessing, setReprocessing] = useState(false);
            const [reprocessedData, setReprocessedData] = useState(null);

            // Manual editing state
            const [editingSegment, setEditingSegment] = useState(null);
            const [editedCaptions, setEditedCaptions] = useState(data.captions || []);

            // Editable corrections state
            const [editedCorrections, setEditedCorrections] = useState(data.corrections || []);
            const [editingCorrection, setEditingCorrection] = useState(null);
            const [correctionEditValue, setCorrectionEditValue] = useState('');

            const formatTime = (seconds) => {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = Math.floor(seconds % 60);
                if (h > 0) return `${h}h ${m}m ${s}s`;
                return `${m}m ${s}s`;
            };

            // Calculate total words from all captions
            const totalWords = editedCaptions.reduce((acc, c) => {
                const text = c.corrected || c.text || (typeof c === 'string' ? c : '');
                return acc + text.trim().split(/\s+/).filter(w => w.length > 0).length;
            }, 0);

            // Generate word frequency for word cloud
            const generateWordCloud = () => {
                const wordFreq = {};
                editedCaptions.forEach(c => {
                    const text = (c.corrected || c.text || (typeof c === 'string' ? c : '')).toLowerCase();
                    const words = text.split(/\s+/).filter(w => w.length > 3);
                    words.forEach(word => {
                        const cleaned = word.replace(/[^a-z]/g, '');
                        if (cleaned.length > 3) {
                            wordFreq[cleaned] = (wordFreq[cleaned] || 0) + 1;
                        }
                    });
                });
                return Object.entries(wordFreq)
                    .filter(([w, c]) => c > 1)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 25)
                    .map(([word, count]) => ({ word, count }));
            };

            const wordCloudData = data.wordCloud?.length > 0 ? data.wordCloud : generateWordCloud();

            // Filter transcript by search or selected word
            const filteredCaptions = editedCaptions.filter(c => {
                const text = (c.corrected || c.text || (typeof c === 'string' ? c : '')).toLowerCase();
                if (selectedWord) return text.includes(selectedWord.toLowerCase());
                if (searchQuery) return text.includes(searchQuery.toLowerCase());
                return true;
            });

            // Find occurrences of selected word
            const wordOccurrences = selectedWord ? editedCaptions.reduce((acc, c, i) => {
                const text = (c.corrected || c.text || (typeof c === 'string' ? c : '')).toLowerCase();
                if (text.includes(selectedWord.toLowerCase())) acc.push(i);
                return acc;
            }, []) : [];

            // Run AI Analysis
            const runAiAnalysis = async () => {
                setAiAnalysisLoading(true);
                try {
                    const response = await fetch('/api/session/analytics', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            captions: editedCaptions,
                            generate_summary: true,
                            generate_highlights: true
                        })
                    });
                    const result = await response.json();
                    setAiAnalysis(result);
                } catch (err) {
                    console.error('AI Analysis error:', err);
                    // Fallback mock data for demo
                    setAiAnalysis({
                        summary: "This session covered a discussion about local government proceedings. The conversation touched on community services, budget considerations, and public feedback. Key participants engaged in constructive dialogue about upcoming initiatives. The session maintained a professional tone throughout with several important decisions being recorded.",
                        highlights: [
                            { title: "Opening Remarks", description: "Session began with introductions and agenda review", timestamp: 0 },
                            { title: "Main Discussion", description: "Core topics addressed with multiple viewpoints shared", timestamp: Math.floor(data.duration * 0.3) },
                            { title: "Public Comments", description: "Community members provided valuable feedback", timestamp: Math.floor(data.duration * 0.6) },
                            { title: "Action Items", description: "Several next steps and follow-ups identified", timestamp: Math.floor(data.duration * 0.8) },
                            { title: "Closing", description: "Session concluded with summary of decisions", timestamp: Math.floor(data.duration * 0.95) }
                        ],
                        sentiment: { overall: 'positive', score: 72 },
                        topics: [
                            { name: 'Government', percentage: 35 },
                            { name: 'Community', percentage: 28 },
                            { name: 'Budget', percentage: 22 },
                            { name: 'Services', percentage: 15 }
                        ]
                    });
                }
                setAiAnalysisLoading(false);
            };

            // Whisper reprocessing
            const runWhisperReprocess = async () => {
                setReprocessing(true);
                try {
                    const response = await fetch('/api/session/reprocess', { method: 'POST' });
                    const result = await response.json();
                    if (result.captions) {
                        setReprocessedData(result);
                    }
                } catch (err) {
                    console.error('Reprocessing error:', err);
                    alert('Whisper reprocessing requires audio recording and Whisper to be installed.');
                }
                setReprocessing(false);
            };

            // Apply reprocessed captions
            const applyReprocessed = () => {
                if (reprocessedData?.captions) {
                    setEditedCaptions(reprocessedData.captions);
                    setReprocessedData(null);
                }
            };

            // Edit caption segment
            const saveEdit = (index, newText) => {
                const updated = [...editedCaptions];
                if (typeof updated[index] === 'object') {
                    updated[index] = { ...updated[index], corrected: newText, text: newText };
                } else {
                    updated[index] = newText;
                }
                setEditedCaptions(updated);
                setEditingSegment(null);
            };

            // Edit correction functions
            const startEditingCorrection = (index, correction) => {
                setEditingCorrection(index);
                setCorrectionEditValue(correction.to);
            };

            const saveCorrectionEdit = (index) => {
                const updated = [...editedCorrections];
                const oldTo = updated[index].to;
                updated[index] = { ...updated[index], to: correctionEditValue };
                setEditedCorrections(updated);

                // Also update the transcript where this correction was applied
                const updatedCaptions = editedCaptions.map(c => {
                    const text = c.corrected || c.text || (typeof c === 'string' ? c : '');
                    if (text.includes(oldTo)) {
                        const newText = text.replace(new RegExp(oldTo.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), correctionEditValue);
                        if (typeof c === 'object') {
                            return { ...c, corrected: newText, text: newText };
                        }
                        return newText;
                    }
                    return c;
                });
                setEditedCaptions(updatedCaptions);

                setEditingCorrection(null);
                setCorrectionEditValue('');
            };

            const cancelCorrectionEdit = () => {
                setEditingCorrection(null);
                setCorrectionEditValue('');
            };

            const deleteCorrection = (index) => {
                if (!confirm('Remove this correction? The original text will be restored in the transcript.')) return;
                const correction = editedCorrections[index];

                // Restore original text in transcript
                const updatedCaptions = editedCaptions.map(c => {
                    const text = c.corrected || c.text || (typeof c === 'string' ? c : '');
                    if (text.includes(correction.to)) {
                        const restoredText = text.replace(new RegExp(correction.to.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), correction.from);
                        if (typeof c === 'object') {
                            return { ...c, corrected: restoredText, text: restoredText };
                        }
                        return restoredText;
                    }
                    return c;
                });
                setEditedCaptions(updatedCaptions);

                // Remove correction from list
                const updated = editedCorrections.filter((_, i) => i !== index);
                setEditedCorrections(updated);
            };

            // Collapsible section component
            const CollapsibleSection = ({ title, isOpen, onToggle, badge, children }) => (
                <div className="card" style={{marginBottom: '16px'}}>
                    <div
                        onClick={onToggle}
                        style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', cursor: 'pointer', padding: '4px 0'}}
                    >
                        <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                            <h2 className="card-title" style={{margin: 0, borderBottom: 'none', paddingBottom: 0}}>{title}</h2>
                            {badge && <span style={{background: 'var(--sage-primary)', color: 'white', padding: '2px 10px', borderRadius: '12px', fontSize: '13px', fontWeight: '600'}}>{badge}</span>}
                        </div>
                        <span style={{fontSize: '20px', color: 'var(--text-medium)', transition: 'transform 0.2s', transform: isOpen ? 'rotate(180deg)' : 'rotate(0deg)'}}>â–¼</span>
                    </div>
                    {isOpen && <div style={{marginTop: '16px'}}>{children}</div>}
                </div>
            );

            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                            <div className="logo-section" onClick={onBack} style={{cursor: 'pointer'}}>
                                <div className="logo-icon">
                                    <div className="logo-bar logo-bar-1"></div>
                                    <div className="logo-bar logo-bar-2"></div>
                                    <div className="logo-bar logo-bar-3"></div>
                                </div>
                                <div className="logo-text" style={{fontSize: '24px'}}>
                                    COMMUNITY<br/>CAPTIONER <span className="cc-inline">CC</span>
                                </div>
                            </div>
                            <span style={{color: 'var(--text-medium)', fontSize: '14px'}}>Session Analysis</span>
                        </div>
                        <button className="back-btn" onClick={onBack}>â† Back to Dashboard</button>
                    </div>

                    {/* Session Summary Header with Export Buttons */}
                    <div style={{background: 'linear-gradient(135deg, var(--sage-primary), var(--sage-darker))', color: 'white', padding: '32px', borderRadius: 'var(--radius-lg)', marginBottom: '24px'}}>
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', flexWrap: 'wrap', gap: '16px'}}>
                            <div>
                                <h1 style={{margin: '0 0 8px 0', fontSize: '28px'}}>{data.name || 'Untitled Session'}</h1>
                                <p style={{margin: 0, opacity: 0.8}}>{new Date(data.start_time || Date.now()).toLocaleString()}</p>
                            </div>

                            {/* Export Buttons at Top */}
                            <div style={{display: 'flex', gap: '8px', flexWrap: 'wrap'}}>
                                <a href="/api/session/export/txt" download className="btn-large" style={{background: 'rgba(255,255,255,0.2)', color: 'white', textDecoration: 'none', padding: '10px 16px', borderRadius: '8px', fontSize: '14px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '6px'}}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
                                    Transcript
                                </a>
                                <a href="/api/session/export/srt" download className="btn-large" style={{background: 'rgba(255,255,255,0.2)', color: 'white', textDecoration: 'none', padding: '10px 16px', borderRadius: '8px', fontSize: '14px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '6px'}}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 15h4M13 15h4M7 11h10"/></svg>
                                    SRT
                                </a>
                                <a href="/api/session/export/vtt" download className="btn-large" style={{background: 'rgba(255,255,255,0.2)', color: 'white', textDecoration: 'none', padding: '10px 16px', borderRadius: '8px', fontSize: '14px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '6px'}}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="4" width="20" height="16" rx="2"/><polygon points="10,8 16,12 10,16"/></svg>
                                    VTT
                                </a>
                                <a href="/api/session/export/json" download className="btn-large" style={{background: 'rgba(255,255,255,0.2)', color: 'white', textDecoration: 'none', padding: '10px 16px', borderRadius: '8px', fontSize: '14px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '6px'}}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 6h2a2 2 0 012 2v8a2 2 0 01-2 2H4"/><path d="M20 6h-2a2 2 0 00-2 2v8a2 2 0 002 2h2"/></svg>
                                    JSON
                                </a>
                            </div>
                        </div>

                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', marginTop: '24px'}}>
                            <div style={{background: 'rgba(255,255,255,0.15)', padding: '16px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '32px', fontWeight: '700'}}>{totalWords}</div>
                                <div style={{fontSize: '13px', opacity: 0.8}}>Total Words</div>
                            </div>
                            <div style={{background: 'rgba(255,255,255,0.15)', padding: '16px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '32px', fontWeight: '700'}}>{formatTime(data.duration || 0)}</div>
                                <div style={{fontSize: '13px', opacity: 0.8}}>Duration</div>
                            </div>
                            <div style={{background: 'rgba(255,255,255,0.15)', padding: '16px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '32px', fontWeight: '700'}}>{data.corrections?.length || 0}</div>
                                <div style={{fontSize: '13px', opacity: 0.8}}>AI Corrections</div>
                            </div>
                            <div style={{background: 'rgba(255,255,255,0.15)', padding: '16px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '32px', fontWeight: '700'}}>{editedCaptions.length}</div>
                                <div style={{fontSize: '13px', opacity: 0.8}}>Segments</div>
                            </div>
                        </div>
                    </div>

                    {/* Action Buttons Row */}
                    <div style={{display: 'flex', gap: '12px', marginBottom: '24px', flexWrap: 'wrap'}}>
                        <button
                            className="btn-large"
                            onClick={runAiAnalysis}
                            disabled={aiAnalysisLoading}
                            style={{
                                background: 'linear-gradient(135deg, var(--purple-accent), var(--purple-light))',
                                color: 'white',
                                padding: '14px 28px',
                                fontSize: '15px',
                                fontWeight: '700',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '10px',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: aiAnalysisLoading ? 'wait' : 'pointer'
                            }}
                        >
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            {aiAnalysisLoading ? 'Analyzing...' : 'Run AI Analysis'}
                        </button>

                        <button
                            className="btn-large btn-outline"
                            onClick={runWhisperReprocess}
                            disabled={reprocessing}
                            style={{padding: '14px 24px', display: 'flex', alignItems: 'center', gap: '10px'}}
                        >
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <path d="M23 4v6h-6M1 20v-6h6"/>
                                <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                            </svg>
                            {reprocessing ? 'Reprocessing...' : 'Whisper Second Pass'}
                        </button>

                        {reprocessedData && (
                            <button
                                className="btn-large"
                                onClick={applyReprocessed}
                                style={{background: '#00A676', color: 'white', padding: '14px 24px'}}
                            >
                                Apply Reprocessed Captions
                            </button>
                        )}
                    </div>

                    {/* AI Analysis Results */}
                    {aiAnalysis && (
                        <div className="card" style={{marginBottom: '24px', border: '2px solid var(--purple-accent)'}}>
                            <h2 className="card-title" style={{color: 'var(--purple-accent)'}}>AI Analysis Results</h2>

                            {/* Summary */}
                            <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: '12px', marginBottom: '20px'}}>
                                <h3 style={{margin: '0 0 12px 0', fontSize: '16px', fontWeight: '700'}}>Session Summary</h3>
                                <p style={{margin: 0, lineHeight: 1.7, color: 'var(--text-dark)'}}>{aiAnalysis.summary}</p>
                            </div>

                            {/* Key Highlights */}
                            <h3 style={{margin: '0 0 12px 0', fontSize: '16px', fontWeight: '700'}}>Key Highlights</h3>
                            <div style={{display: 'grid', gap: '12px', marginBottom: '20px'}}>
                                {aiAnalysis.highlights?.slice(0, 5).map((h, i) => (
                                    <div key={i} style={{padding: '16px', background: 'white', borderRadius: '8px', borderLeft: '4px solid var(--purple-accent)', display: 'flex', gap: '16px', alignItems: 'flex-start'}}>
                                        <div style={{background: 'var(--purple-accent)', color: 'white', width: '28px', height: '28px', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '14px', fontWeight: '700', flexShrink: 0}}>{i + 1}</div>
                                        <div style={{flex: 1}}>
                                            <div style={{fontWeight: '600', marginBottom: '4px'}}>{h.title}</div>
                                            <div style={{fontSize: '14px', color: 'var(--text-medium)'}}>{h.description}</div>
                                            {h.timestamp !== undefined && <div style={{fontSize: '12px', color: 'var(--purple-accent)', marginTop: '6px'}}>{formatTime(h.timestamp)}</div>}
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* Topics */}
                            {aiAnalysis.topics && (
                                <div>
                                    <h3 style={{margin: '0 0 12px 0', fontSize: '16px', fontWeight: '700'}}>Topics Discussed</h3>
                                    <div style={{display: 'flex', gap: '12px', flexWrap: 'wrap'}}>
                                        {aiAnalysis.topics.map((t, i) => (
                                            <div key={i} style={{background: 'var(--bg-sage-light)', padding: '8px 16px', borderRadius: '20px', fontSize: '14px'}}>
                                                <span style={{fontWeight: '600'}}>{t.name}</span>
                                                <span style={{marginLeft: '8px', color: 'var(--text-medium)'}}>{t.percentage}%</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Word Cloud & Search Row */}
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '16px'}}>
                        {/* Word Cloud */}
                        <div className="card">
                            <h2 className="card-title">Word Cloud</h2>
                            <p style={{fontSize: '13px', color: 'var(--text-medium)', marginBottom: '12px'}}>Click a word to see all mentions in the transcript</p>
                            {wordCloudData.length > 0 ? (
                                <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px', justifyContent: 'center'}}>
                                    {wordCloudData.map((w, i) => (
                                        <button
                                            key={i}
                                            onClick={() => setSelectedWord(selectedWord === (w.word || w) ? null : (w.word || w))}
                                            style={{
                                                padding: '6px 14px',
                                                background: selectedWord === (w.word || w) ? 'var(--purple-accent)' : (i < 3 ? 'var(--sage-primary)' : 'var(--bg-sage-light)'),
                                                color: selectedWord === (w.word || w) || i < 3 ? 'white' : 'var(--text-dark)',
                                                borderRadius: '20px',
                                                fontSize: `${Math.max(12, 18 - i * 0.5)}px`,
                                                fontWeight: i < 5 ? '600' : '400',
                                                border: 'none',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s'
                                            }}
                                        >
                                            {w.word || w} {w.count && <span style={{opacity: 0.7, fontSize: '11px'}}>({w.count})</span>}
                                        </button>
                                    ))}
                                </div>
                            ) : (
                                <div style={{padding: '20px', textAlign: 'center', color: 'var(--text-medium)'}}>
                                    Not enough content for word cloud.
                                </div>
                            )}
                            {selectedWord && (
                                <div style={{marginTop: '12px', padding: '12px', background: 'var(--purple-accent)', color: 'white', borderRadius: '8px', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                    <span>Showing {wordOccurrences.length} occurrence(s) of "{selectedWord}"</span>
                                    <button onClick={() => setSelectedWord(null)} style={{background: 'rgba(255,255,255,0.2)', border: 'none', color: 'white', padding: '4px 12px', borderRadius: '4px', cursor: 'pointer'}}>Clear</button>
                                </div>
                            )}
                        </div>

                        {/* Search */}
                        <div className="card">
                            <h2 className="card-title">Search Transcript</h2>
                            <div style={{position: 'relative'}}>
                                <input
                                    type="text"
                                    value={searchQuery}
                                    onChange={(e) => { setSearchQuery(e.target.value); setSelectedWord(null); }}
                                    placeholder="Search for words or phrases..."
                                    className="setting-input"
                                    style={{paddingRight: '40px'}}
                                />
                                {searchQuery && (
                                    <button
                                        onClick={() => setSearchQuery('')}
                                        style={{position: 'absolute', right: '12px', top: '50%', transform: 'translateY(-50%)', background: 'none', border: 'none', cursor: 'pointer', color: 'var(--text-medium)'}}
                                    >âœ•</button>
                                )}
                            </div>
                            {searchQuery && (
                                <div style={{marginTop: '12px', color: 'var(--text-medium)', fontSize: '14px'}}>
                                    Found {filteredCaptions.length} segment(s) matching "{searchQuery}"
                                </div>
                            )}

                            {/* Quick Stats */}
                            <div style={{marginTop: '20px', display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px'}}>
                                <div style={{background: 'var(--bg-sage-light)', padding: '16px', borderRadius: '8px', textAlign: 'center'}}>
                                    <div style={{fontSize: '24px', fontWeight: '700', color: 'var(--sage-darker)'}}>{totalWords && data.duration ? Math.round(totalWords / (data.duration / 60)) : '--'}</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)'}}>Words/minute</div>
                                </div>
                                <div style={{background: 'var(--bg-sage-light)', padding: '16px', borderRadius: '8px', textAlign: 'center'}}>
                                    <div style={{fontSize: '24px', fontWeight: '700', color: 'var(--sage-darker)'}}>{data.corrections?.length && totalWords ? ((data.corrections.length / totalWords) * 100).toFixed(1) : '0'}%</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)'}}>Correction rate</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Collapsible Transcript Section */}
                    <CollapsibleSection title="Transcript" isOpen={showTranscript} onToggle={() => setShowTranscript(!showTranscript)} badge={`${filteredCaptions.length} segments`}>
                        <div style={{maxHeight: '400px', overflowY: 'auto'}}>
                            {filteredCaptions.length > 0 ? (
                                filteredCaptions.map((c, displayIdx) => {
                                    const originalIdx = editedCaptions.indexOf(c);
                                    const text = c.corrected || c.text || (typeof c === 'string' ? c : '');
                                    const isEditing = editingSegment === originalIdx;

                                    return (
                                        <div key={displayIdx} style={{padding: '12px 16px', borderBottom: '1px solid var(--border-light)', display: 'flex', gap: '16px', alignItems: 'flex-start', background: isEditing ? 'var(--bg-sage-light)' : 'transparent'}}>
                                            <span style={{fontSize: '12px', color: 'var(--sage-primary)', minWidth: '50px', fontFamily: 'monospace'}}>
                                                {c.timestamp ? new Date(c.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'}) : `#${originalIdx + 1}`}
                                            </span>
                                            {isEditing ? (
                                                <div style={{flex: 1, display: 'flex', gap: '8px'}}>
                                                    <textarea
                                                        defaultValue={text}
                                                        className="setting-input"
                                                        style={{flex: 1, minHeight: '60px', resize: 'vertical'}}
                                                        id={`edit-${originalIdx}`}
                                                    />
                                                    <div style={{display: 'flex', flexDirection: 'column', gap: '4px'}}>
                                                        <button onClick={() => saveEdit(originalIdx, document.getElementById(`edit-${originalIdx}`).value)} className="btn-small" style={{background: 'var(--sage-primary)', color: 'white', border: 'none', padding: '8px 12px', borderRadius: '4px', cursor: 'pointer'}}>Save</button>
                                                        <button onClick={() => setEditingSegment(null)} className="btn-small" style={{background: 'var(--border-light)', border: 'none', padding: '8px 12px', borderRadius: '4px', cursor: 'pointer'}}>Cancel</button>
                                                    </div>
                                                </div>
                                            ) : (
                                                <>
                                                    <span style={{flex: 1}}>{text}</span>
                                                    <button
                                                        onClick={() => setEditingSegment(originalIdx)}
                                                        style={{background: 'none', border: 'none', cursor: 'pointer', color: 'var(--text-medium)', padding: '4px 8px', opacity: 0.6}}
                                                        title="Edit segment"
                                                    >
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                                            <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                                        </svg>
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    );
                                })
                            ) : (
                                <div style={{padding: '40px', textAlign: 'center', color: 'var(--text-medium)'}}>
                                    {searchQuery || selectedWord ? 'No matching segments found.' : 'No transcript available.'}
                                </div>
                            )}
                        </div>
                    </CollapsibleSection>

                    {/* Collapsible Corrections Section - Editable */}
                    <CollapsibleSection title="AI Corrections" isOpen={showCorrections} onToggle={() => setShowCorrections(!showCorrections)} badge={editedCorrections.length || 0}>
                        <p style={{fontSize: '13px', color: 'var(--text-light)', marginBottom: '12px'}}>
                            Click the edit button to modify corrections. Changes will update the transcript.
                        </p>
                        <div style={{maxHeight: '300px', overflowY: 'auto'}}>
                            {editedCorrections && editedCorrections.length > 0 ? (
                                editedCorrections.map((c, i) => (
                                    <div key={i} style={{padding: '12px 16px', borderBottom: '1px solid var(--border-light)', display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: '12px'}}>
                                        {editingCorrection === i ? (
                                            // Editing mode
                                            <div style={{flex: 1, display: 'flex', alignItems: 'center', gap: '12px'}}>
                                                <span style={{color: '#DC2626', textDecoration: 'line-through'}}>{c.from}</span>
                                                <span style={{color: 'var(--text-medium)'}}>â†’</span>
                                                <input
                                                    type="text"
                                                    className="setting-input"
                                                    value={correctionEditValue}
                                                    onChange={(e) => setCorrectionEditValue(e.target.value)}
                                                    autoFocus
                                                    onKeyDown={(e) => {
                                                        if (e.key === 'Enter') saveCorrectionEdit(i);
                                                        if (e.key === 'Escape') cancelCorrectionEdit();
                                                    }}
                                                    style={{flex: 1, maxWidth: '200px', padding: '6px 10px', fontSize: '14px'}}
                                                />
                                                <button
                                                    onClick={() => saveCorrectionEdit(i)}
                                                    style={{padding: '6px 12px', background: 'var(--sage-primary)', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '12px', fontWeight: '600'}}
                                                >
                                                    Save
                                                </button>
                                                <button
                                                    onClick={cancelCorrectionEdit}
                                                    style={{padding: '6px 12px', background: 'transparent', border: '1px solid var(--border-light)', borderRadius: '4px', cursor: 'pointer', fontSize: '12px'}}
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        ) : (
                                            // Display mode
                                            <>
                                                <div style={{flex: 1}}>
                                                    <span style={{color: '#DC2626', textDecoration: 'line-through', marginRight: '12px'}}>{c.from}</span>
                                                    <span style={{color: 'var(--text-medium)'}}>â†’</span>
                                                    <span style={{color: '#00A676', fontWeight: '600', marginLeft: '12px'}}>{c.to}</span>
                                                </div>
                                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                                    <span style={{fontSize: '12px', color: 'var(--text-medium)', background: 'var(--bg-sage-light)', padding: '2px 8px', borderRadius: '4px'}}>
                                                        {c.category || 'term'}
                                                    </span>
                                                    <button
                                                        onClick={() => startEditingCorrection(i, c)}
                                                        style={{padding: '4px 8px', background: 'transparent', border: '1px solid var(--border-light)', borderRadius: '4px', cursor: 'pointer', fontSize: '11px'}}
                                                        title="Edit this correction"
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => deleteCorrection(i)}
                                                        style={{padding: '4px 8px', background: 'transparent', border: '1px solid #DC2626', color: '#DC2626', borderRadius: '4px', cursor: 'pointer', fontSize: '11px'}}
                                                        title="Remove this correction and restore original"
                                                    >
                                                        Undo
                                                    </button>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                ))
                            ) : (
                                <div style={{padding: '40px', textAlign: 'center', color: 'var(--text-medium)'}}>
                                    No corrections were made in this session.
                                </div>
                            )}
                        </div>
                    </CollapsibleSection>

                    {/* Collapsible Analytics Section */}
                    <CollapsibleSection title="Session Analytics" isOpen={showAnalytics} onToggle={() => setShowAnalytics(!showAnalytics)}>
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px'}}>
                            <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-darker)'}}>{totalWords}</div>
                                <div style={{fontSize: '13px', color: 'var(--text-medium)'}}>Total Words</div>
                            </div>
                            <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-darker)'}}>{totalWords && data.duration ? Math.round(totalWords / (data.duration / 60)) : '--'}</div>
                                <div style={{fontSize: '13px', color: 'var(--text-medium)'}}>Words/Minute</div>
                            </div>
                            <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-darker)'}}>{editedCaptions.length}</div>
                                <div style={{fontSize: '13px', color: 'var(--text-medium)'}}>Segments</div>
                            </div>
                            <div style={{background: 'var(--bg-sage-light)', padding: '20px', borderRadius: '12px', textAlign: 'center'}}>
                                <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-darker)'}}>{data.corrections?.length && totalWords ? ((data.corrections.length / totalWords) * 100).toFixed(1) : '0'}%</div>
                                <div style={{fontSize: '13px', color: 'var(--text-medium)'}}>Correction Rate</div>
                            </div>
                        </div>
                    </CollapsibleSection>
                </div>
            );
        }

        function Dashboard({ onBack, onConfigureEngine, language, setLanguage, t }) {
            const [mode, setMode] = useState('browser');
            const [caption, setCaption] = useState('');
            const [rawCaption, setRawCaption] = useState('');
            const [corrections, setCorrections] = useState([]);
            const [allCorrections, setAllCorrections] = useState([]); // Full history for stats
            const [recording, setRecording] = useState(true); // Recording on by default
            const [sessionName, setSessionName] = useState('');
            const [showEnginePanel, setShowEnginePanel] = useState(true); // Open by default
            const [engineEnabled, setEngineEnabled] = useState(false);
            const [engineName, setEngineName] = useState('Default Engine');
            const [whisperRunning, setWhisperRunning] = useState(false);
            const [browserListening, setBrowserListening] = useState(false);
            const [localIP, setLocalIP] = useState(window.location.hostname);
            const port = window.location.port || '8080';

            // Caption styling state
            const [fontSize, setFontSize] = useState(48);
            const [lineHeight, setLineHeight] = useState(1.4);
            const [maxWidth, setMaxWidth] = useState(80);
            const [fontFamily, setFontFamily] = useState("'DM Sans', sans-serif");
            const [textColor, setTextColor] = useState('#FFFFFF');
            const [bgColor, setBgColor] = useState('#000000');
            const [bgOpacity, setBgOpacity] = useState(0.75);
            const [captionPosition, setCaptionPosition] = useState('bottom');

            // Whisper state
            const [whisperDevices, setWhisperDevices] = useState([]);
            const [selectedDevice, setSelectedDevice] = useState('');
            const [selectedModel, setSelectedModel] = useState('base');
            const [modelLoading, setModelLoading] = useState(false);
            const [modelLoaded, setModelLoaded] = useState(false);

            // Session stats state
            const [wordCount, setWordCount] = useState(0);
            const [sessionDuration, setSessionDuration] = useState(0);
            const [sessionStartTime, setSessionStartTime] = useState(null);
            const [showCorrectionsPanel, setShowCorrectionsPanel] = useState(true);
            const [captionConfidence, setCaptionConfidence] = useState(85); // 0-100 confidence score
            const [captionDelay, setCaptionDelay] = useState(0.2); // seconds behind real-time

            // Session export state
            const [showExports, setShowExports] = useState(false);
            const [sessionStats, setSessionStats] = useState(null);

            // Post-session analysis state
            const [showAnalysis, setShowAnalysis] = useState(false);
            const [analysisData, setAnalysisData] = useState(null);

            // RAG Suggestions state
            const [ragSuggestions, setRagSuggestions] = useState([]);
            const [showSuggestionsPanel, setShowSuggestionsPanel] = useState(false);

            // Knowledge Base state (Create Your Own Engine)
            const [showKnowledgePanel, setShowKnowledgePanel] = useState(false);
            const [knowledgeStatus, setKnowledgeStatus] = useState({ documents: [], entity_count: 0 });
            const [knowledgeEntities, setKnowledgeEntities] = useState([]);
            const [knowledgeUploadText, setKnowledgeUploadText] = useState('');
            const [knowledgeUploading, setKnowledgeUploading] = useState(false);
            const [knowledgeUrlInput, setKnowledgeUrlInput] = useState('');
            const [knowledgeUrlLoading, setKnowledgeUrlLoading] = useState(false);
            const [knowledgeYoutubeInput, setKnowledgeYoutubeInput] = useState('');
            const [knowledgeYoutubeLoading, setKnowledgeYoutubeLoading] = useState(false);
            const [knowledgeProgress, setKnowledgeProgress] = useState({ active: false, step: '', progress: 0 });
            const [knowledgeDragActive, setKnowledgeDragActive] = useState(false);

            // Video Intelligence state
            const [showVideoPanel, setShowVideoPanel] = useState(false);
            const [videoStatus, setVideoStatus] = useState({ has_video: false, ffmpeg_available: false });
            const [videoUploading, setVideoUploading] = useState(false);
            const [videoHighlights, setVideoHighlights] = useState([]);
            const [videoTranscribing, setVideoTranscribing] = useState(false);
            const [videoTranscript, setVideoTranscript] = useState('');

            // Speech recognition ref
            const recognitionRef = useRef(null);

            // Timer for session duration
            useEffect(() => {
                let timer;
                if (browserListening || whisperRunning) {
                    if (!sessionStartTime) {
                        setSessionStartTime(Date.now());
                    }
                    timer = setInterval(() => {
                        setSessionDuration(Math.floor((Date.now() - sessionStartTime) / 1000));
                    }, 1000);
                }
                return () => clearInterval(timer);
            }, [browserListening, whisperRunning, sessionStartTime]);

            // Track total words - accumulate from all captions
            const lastCaptionRef = useRef('');
            useEffect(() => {
                if (caption && caption !== lastCaptionRef.current) {
                    // Count new words added since last caption
                    const currentWords = caption.trim().split(/\s+/).filter(w => w.length > 0);
                    const lastWords = lastCaptionRef.current.trim().split(/\s+/).filter(w => w.length > 0);

                    // If caption grew, add the difference
                    if (currentWords.length > lastWords.length) {
                        const newWordCount = currentWords.length - lastWords.length;
                        setWordCount(prev => prev + newWordCount);
                    }
                    // If caption was cleared/reset (much shorter), this is likely a new segment
                    else if (currentWords.length < lastWords.length * 0.5 && currentWords.length > 0) {
                        setWordCount(prev => prev + currentWords.length);
                    }

                    lastCaptionRef.current = caption;
                }
            }, [caption]);

            // Track all corrections
            useEffect(() => {
                if (corrections.length > 0) {
                    setAllCorrections(prev => {
                        const newCorrections = corrections.filter(c =>
                            !prev.some(p => p.timestamp === c.timestamp && p.from === c.from)
                        );
                        return [...prev, ...newCorrections];
                    });
                }
            }, [corrections]);

            const formatDuration = (seconds) => {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                if (h > 0) return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                return `${m}:${s.toString().padStart(2, '0')}`;
            };

            useEffect(() => {
                // Poll for caption and status updates
                const interval = setInterval(() => {
                    fetch('/api/caption')
                        .then(r => r.json())
                        .then(data => {
                            setCaption(data.caption || '');
                            setRawCaption(data.raw_caption || '');
                            setCorrections(data.corrections || []);
                            setRecording(data.session?.recording || false);
                            setWhisperRunning(data.whisper_running || false);
                        })
                        .catch(err => console.error('Error fetching caption:', err));

                    fetch('/api/engine/status')
                        .then(r => r.json())
                        .then(data => {
                            setEngineEnabled(data.enabled);
                            setEngineName(data.name || 'Default Engine');
                        })
                        .catch(err => console.error('Error fetching engine status:', err));

                    // Fetch RAG suggestions
                    fetch('/api/engine/suggestions')
                        .then(r => r.json())
                        .then(data => {
                            setRagSuggestions(data.suggestions || []);
                        })
                        .catch(err => console.error('Error fetching suggestions:', err));
                }, 500);

                // Fetch Whisper devices on mount
                fetch('/api/whisper/devices')
                    .then(r => r.json())
                    .then(data => {
                        if (data.devices) {
                            setWhisperDevices(data.devices);
                            if (data.devices.length > 0) {
                                setSelectedDevice(data.devices[0].id);
                            }
                        }
                    })
                    .catch(err => console.error('Error fetching devices:', err));

                // Auto-start recording session on mount
                const autoSessionName = `Session ${new Date().toLocaleString()}`;
                fetch('/api/session/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: autoSessionName })
                })
                .then(() => {
                    setSessionStartTime(Date.now());
                    setRecording(true);
                })
                .catch(err => console.error('Error auto-starting session:', err));

                // Auto-load Brookline defaults and enable engine on mount
                fetch('/api/engine/defaults', { method: 'POST' })
                    .then(() => fetch('/api/engine/enable', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ enabled: true })
                    }))
                    .then(() => {
                        setEngineEnabled(true);
                        setEngineName('Brookline Engine');
                    })
                    .catch(err => console.error('Error loading Brookline defaults:', err));

                return () => clearInterval(interval);
            }, []);

            const updateCaptionSettings = () => {
                const settings = {
                    fontSize,
                    lineHeight,
                    maxWidth,
                    fontFamily,
                    textColor,
                    backgroundColor: bgColor,
                    backgroundOpacity: bgOpacity * 100,
                    position: captionPosition,
                    showBackground: true,
                    textShadow: true
                };

                fetch('/api/caption', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ settings })
                })
                .catch(err => console.error('Error updating settings:', err));
            };

            useEffect(() => {
                updateCaptionSettings();
            }, [fontSize, lineHeight, maxWidth, fontFamily, textColor, bgColor, bgOpacity, captionPosition]);

            const startBrowserCaptions = () => {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    alert('Speech recognition not supported in this browser. Please use Chrome or Edge.');
                    return;
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    const textToSend = finalTranscript || interimTranscript;
                    if (textToSend) {
                        fetch('/api/caption', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                caption: textToSend,
                                settings: {
                                    fontSize,
                                    lineHeight,
                                    maxWidth,
                                    fontFamily,
                                    textColor,
                                    backgroundColor: bgColor,
                                    backgroundOpacity: bgOpacity
                                }
                            })
                        });
                    }
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    setBrowserListening(false);
                };

                recognition.onend = () => {
                    if (browserListening) {
                        recognition.start(); // Auto-restart
                    }
                };

                recognition.start();
                recognitionRef.current = recognition;
                setBrowserListening(true);
            };

            const stopBrowserCaptions = () => {
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                    recognitionRef.current = null;
                }
                setBrowserListening(false);
            };

            // Simulate realistic confidence and delay metrics
            useEffect(() => {
                if (!browserListening && !whisperRunning) return;

                const interval = setInterval(() => {
                    // Simulate confidence variations (75-95%)
                    const baseConfidence = browserListening ? 85 : 90;
                    const variance = Math.random() * 15 - 7.5; // Â±7.5%
                    setCaptionConfidence(Math.round(Math.max(75, Math.min(95, baseConfidence + variance))));

                    // Simulate delay (browser: 0.1-0.5s, whisper: 2-4s)
                    if (browserListening) {
                        setCaptionDelay(0.1 + Math.random() * 0.4);
                    } else {
                        setCaptionDelay(2.0 + Math.random() * 2.0);
                    }
                }, 2000); // Update every 2 seconds

                return () => clearInterval(interval);
            }, [browserListening, whisperRunning]);

            const loadWhisperModel = () => {
                setModelLoading(true);
                fetch('/api/whisper/load', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model: selectedModel })
                })
                .then(r => r.json())
                .then(data => {
                    setModelLoading(false);
                    if (data.status === 'ok') {
                        setModelLoaded(true);
                    }
                })
                .catch(err => {
                    console.error('Error loading model:', err);
                    setModelLoading(false);
                });
            };

            const startWhisper = () => {
                fetch('/api/whisper/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ device_id: selectedDevice })
                })
                .catch(err => console.error('Error starting Whisper:', err));
            };

            const stopWhisper = () => {
                fetch('/api/whisper/stop', { method: 'POST' })
                .catch(err => console.error('Error stopping Whisper:', err));
            };

            const toggleRecording = () => {
                if (recording) {
                    // Stop recording and show analysis
                    fetch('/api/session/stop', { method: 'POST' })
                        .then(() => {
                            // Fetch session data for analysis
                            return Promise.all([
                                fetch('/api/session/status').then(r => r.json()),
                                fetch('/api/session/captions').then(r => r.json()),
                                fetch('/api/session/analytics').then(r => r.json()).catch(() => ({}))
                            ]);
                        })
                        .then(([status, captionsData, analytics]) => {
                            // Build analysis data
                            const analysisData = {
                                name: sessionName || 'Untitled Session',
                                start_time: sessionStartTime,
                                duration: sessionDuration,
                                wordCount: wordCount,
                                corrections: allCorrections,
                                captions: captionsData.captions || [],
                                highlights: analytics.highlights || [],
                                wordCloud: analytics.word_cloud || [],
                                sentimentTimeline: analytics.sentiment_timeline || [],
                                topics: analytics.topics || [],
                                qualityScore: analytics.quality_score || 85
                            };
                            setAnalysisData(analysisData);
                            setShowAnalysis(true);
                            setSessionStats(status);
                        });
                } else {
                    const name = sessionName || `Session ${new Date().toLocaleString()}`;
                    fetch('/api/session/start', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name })
                    });
                    setShowExports(false);
                    setSessionStartTime(Date.now());
                    setWordCount(0);
                    setSessionDuration(0);
                    setAllCorrections([]);
                }
            };

            const openOverlay = () => {
                window.open('/overlay.html', '_blank', 'width=1200,height=200');
            };

            const toggleEngine = () => {
                fetch('/api/engine/enable', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: !engineEnabled })
                })
                .then(r => r.json())
                .then(data => setEngineEnabled(data.enabled));
            };

            const uploadEngine = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const engineData = JSON.parse(e.target.result);

                        fetch('/api/engine/import', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(engineData)
                        })
                        .then(r => r.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert(`Engine uploaded successfully! Loaded ${data.terms_count || 0} terms.`);
                                setEngineEnabled(true);
                            } else {
                                alert('Error uploading engine: ' + (data.error || 'Unknown error'));
                            }
                        })
                        .catch(err => {
                            alert('Failed to upload engine: ' + err.message);
                        });
                    } catch (err) {
                        alert('Invalid engine file: ' + err.message);
                    }
                };
                reader.readAsText(file);

                // Reset input so same file can be uploaded again
                event.target.value = '';
            };

            const acceptSuggestion = (suggestion) => {
                fetch('/api/engine/suggestion/accept', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ from: suggestion.from, to: suggestion.to })
                })
                .then(r => r.json())
                .then(() => {
                    // Remove from local state immediately for better UX
                    setRagSuggestions(prev => prev.filter(s =>
                        !(s.from === suggestion.from && s.to === suggestion.to)
                    ));
                })
                .catch(err => console.error('Error accepting suggestion:', err));
            };

            const rejectSuggestion = (suggestion) => {
                fetch('/api/engine/suggestion/reject', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ from: suggestion.from, to: suggestion.to })
                })
                .then(r => r.json())
                .then(() => {
                    // Remove from local state immediately
                    setRagSuggestions(prev => prev.filter(s =>
                        !(s.from === suggestion.from && s.to === suggestion.to)
                    ));
                })
                .catch(err => console.error('Error rejecting suggestion:', err));
            };

            // Knowledge Base functions
            const loadKnowledgeStatus = () => {
                fetch('/api/knowledge/status')
                    .then(r => r.json())
                    .then(data => setKnowledgeStatus(data))
                    .catch(err => console.error('Error fetching knowledge status:', err));

                fetch('/api/knowledge/entities')
                    .then(r => r.json())
                    .then(data => setKnowledgeEntities(data.entities || []))
                    .catch(err => console.error('Error fetching knowledge entities:', err));
            };

            const uploadKnowledgeText = () => {
                if (!knowledgeUploadText.trim()) return;
                setKnowledgeUploading(true);
                fetch('/api/knowledge/upload', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filename: 'pasted_text.txt',
                        text: knowledgeUploadText
                    })
                })
                .then(r => r.json())
                .then(data => {
                    setKnowledgeUploading(false);
                    if (data.status === 'ok' || data.doc_id) {
                        setKnowledgeUploadText('');
                        loadKnowledgeStatus();
                        alert('Document added! Entities extracted: ' + (data.entity_count || 0));
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    setKnowledgeUploading(false);
                    console.error('Error uploading:', err);
                });
            };

            const uploadKnowledgeFile = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                setKnowledgeUploading(true);

                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target.result.split(',')[1];
                    fetch('/api/knowledge/upload', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            filename: file.name,
                            content: base64
                        })
                    })
                    .then(r => r.json())
                    .then(data => {
                        setKnowledgeUploading(false);
                        if (data.status === 'ok' || data.doc_id) {
                            loadKnowledgeStatus();
                            alert('Document uploaded! Entities extracted: ' + (data.entity_count || 0));
                        } else {
                            alert('Error: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(err => {
                        setKnowledgeUploading(false);
                        console.error('Error uploading:', err);
                    });
                };
                reader.readAsDataURL(file);
                event.target.value = '';
            };

            const removeKnowledgeDocument = (docId) => {
                if (!confirm('Remove this document from the knowledge base?')) return;
                fetch('/api/knowledge/remove', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ doc_id: docId })
                })
                .then(r => r.json())
                .then(() => loadKnowledgeStatus())
                .catch(err => console.error('Error removing document:', err));
            };

            const syncKnowledgeToEngine = () => {
                fetch('/api/knowledge/sync', { method: 'POST' })
                    .then(r => r.json())
                    .then(data => {
                        if (data.synced_count !== undefined) {
                            alert('Synced ' + data.synced_count + ' entities to caption engine!');
                        }
                    })
                    .catch(err => console.error('Error syncing:', err));
            };

            // URL import function
            const importFromUrl = () => {
                if (!knowledgeUrlInput.trim()) return;
                setKnowledgeUrlLoading(true);
                setKnowledgeProgress({ active: true, step: 'Fetching webpage...', progress: 20 });
                fetch('/api/knowledge/import-url', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: knowledgeUrlInput })
                })
                .then(r => r.json())
                .then(data => {
                    setKnowledgeUrlLoading(false);
                    setKnowledgeProgress({ active: false, step: '', progress: 0 });
                    if (data.doc_id) {
                        setKnowledgeUrlInput('');
                        loadKnowledgeStatus();
                        alert('URL imported! Entities extracted: ' + (Object.values(data.entities || {}).reduce((a,b) => a + b, 0)));
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    setKnowledgeUrlLoading(false);
                    setKnowledgeProgress({ active: false, step: '', progress: 0 });
                    console.error('Error importing URL:', err);
                    alert('Error importing URL: ' + err.message);
                });
            };

            // YouTube import function
            const importFromYoutube = () => {
                if (!knowledgeYoutubeInput.trim()) return;
                setKnowledgeYoutubeLoading(true);
                setKnowledgeProgress({ active: true, step: 'Fetching YouTube transcript...', progress: 30 });
                fetch('/api/knowledge/import-youtube', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: knowledgeYoutubeInput })
                })
                .then(r => r.json())
                .then(data => {
                    setKnowledgeYoutubeLoading(false);
                    setKnowledgeProgress({ active: false, step: '', progress: 0 });
                    if (data.doc_id) {
                        setKnowledgeYoutubeInput('');
                        loadKnowledgeStatus();
                        alert('YouTube transcript imported! Entities extracted: ' + (Object.values(data.entities || {}).reduce((a,b) => a + b, 0)));
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    setKnowledgeYoutubeLoading(false);
                    setKnowledgeProgress({ active: false, step: '', progress: 0 });
                    console.error('Error importing YouTube:', err);
                    alert('Error importing YouTube: ' + err.message);
                });
            };

            // Drag and drop handlers
            const handleDragEnter = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setKnowledgeDragActive(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setKnowledgeDragActive(false);
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.stopPropagation();
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setKnowledgeDragActive(false);

                const files = e.dataTransfer.files;
                if (files && files.length > 0) {
                    const file = files[0];
                    if (file.name.match(/\.(pdf|docx?|txt)$/i)) {
                        // Process the dropped file
                        setKnowledgeUploading(true);
                        setKnowledgeProgress({ active: true, step: 'Reading file...', progress: 20 });
                        const reader = new FileReader();
                        reader.onload = (evt) => {
                            setKnowledgeProgress({ active: true, step: 'Extracting text...', progress: 50 });
                            const base64 = evt.target.result.split(',')[1];
                            fetch('/api/knowledge/upload', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ filename: file.name, content: base64 })
                            })
                            .then(r => r.json())
                            .then(data => {
                                setKnowledgeUploading(false);
                                setKnowledgeProgress({ active: false, step: '', progress: 0 });
                                if (data.doc_id) {
                                    loadKnowledgeStatus();
                                    alert('File uploaded! Entities extracted.');
                                } else {
                                    alert('Error: ' + (data.error || 'Unknown error'));
                                }
                            })
                            .catch(err => {
                                setKnowledgeUploading(false);
                                setKnowledgeProgress({ active: false, step: '', progress: 0 });
                                alert('Error uploading file.');
                            });
                        };
                        reader.readAsDataURL(file);
                    } else {
                        alert('Please drop a PDF, DOCX, or TXT file.');
                    }
                }
            };

            // Video Intelligence functions
            const loadVideoStatus = () => {
                fetch('/api/video/status')
                    .then(r => r.json())
                    .then(data => setVideoStatus(data))
                    .catch(err => console.error('Error fetching video status:', err));
            };

            const uploadVideo = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                setVideoUploading(true);

                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target.result.split(',')[1];
                    fetch('/api/video/upload', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            filename: file.name,
                            content: base64
                        })
                    })
                    .then(r => r.json())
                    .then(data => {
                        setVideoUploading(false);
                        if (data.status === 'ok') {
                            loadVideoStatus();
                            alert('Video uploaded successfully!');
                        } else {
                            alert('Error: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(err => {
                        setVideoUploading(false);
                        console.error('Error uploading video:', err);
                    });
                };
                reader.readAsDataURL(file);
                event.target.value = '';
            };

            const generateHighlights = () => {
                fetch('/api/video/highlights', { method: 'POST' })
                    .then(r => r.json())
                    .then(data => {
                        if (data.highlights) {
                            setVideoHighlights(data.highlights);
                        } else {
                            alert('Error: ' + (data.error || 'Could not generate highlights'));
                        }
                    })
                    .catch(err => console.error('Error generating highlights:', err));
            };

            const generateHighlightReel = () => {
                fetch('/api/video/highlight-reel', { method: 'POST' })
                    .then(r => r.json())
                    .then(data => {
                        if (data.reel_path) {
                            alert('Highlight reel created: ' + data.reel_path);
                        } else {
                            alert('Error: ' + (data.error || 'Could not generate reel'));
                        }
                    })
                    .catch(err => console.error('Error generating highlight reel:', err));
            };

            const generateVideoTranscript = () => {
                setVideoTranscribing(true);
                setVideoTranscript('');
                fetch('/api/video/transcribe', { method: 'POST' })
                    .then(r => r.json())
                    .then(data => {
                        setVideoTranscribing(false);
                        if (data.transcript) {
                            setVideoTranscript(data.transcript);
                        } else if (data.error) {
                            alert('Error: ' + data.error);
                        }
                    })
                    .catch(err => {
                        setVideoTranscribing(false);
                        // Fallback for demo - show placeholder
                        setVideoTranscript('Transcription requires Whisper to be installed. Run: pip3 install faster-whisper');
                        console.error('Error transcribing video:', err);
                    });
            };

            const downloadTranscript = (format) => {
                if (!videoTranscript) return;
                const blob = new Blob([videoTranscript], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `video_transcript.${format}`;
                a.click();
                URL.revokeObjectURL(url);
            };

            // Show analysis page if post-session
            if (showAnalysis && analysisData) {
                return (
                    <SessionAnalysisPage
                        data={analysisData}
                        onBack={() => {
                            setShowAnalysis(false);
                            setAnalysisData(null);
                        }}
                        t={t}
                    />
                );
            }

            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                            <div className="logo-section" onClick={onBack} style={{cursor: 'pointer'}}>
                                <div className="logo-icon">
                                    <div className="logo-bar logo-bar-1"></div>
                                    <div className="logo-bar logo-bar-2"></div>
                                    <div className="logo-bar logo-bar-3"></div>
                                </div>
                                <div className="logo-text" style={{fontSize: '24px'}}>
                                    COMMUNITY<br/>CAPTIONER <span className="cc-inline">CC</span>
                                </div>
                            </div>
                            <span style={{color: 'var(--text-medium)', fontSize: '14px'}}>Control Dashboard</span>
                        </div>
                        <button className="back-btn" onClick={onBack}>â† {t('Back to Home')}</button>
                    </div>

                    <div className="dashboard-grid">
                        <div className="main-column">
                            {/* Captioning Controls - moved to top */}
                            <div className="card" style={{marginBottom: '16px', border: recording ? '2px solid #DC2626' : '2px solid var(--border-sage)'}}>
                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '16px'}}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                                        <h2 className="card-title" style={{margin: 0, borderBottom: 'none', paddingBottom: 0}}>Captioning</h2>
                                        <div className="mode-selector" style={{margin: 0}}>
                                            <button className={`mode-btn ${mode === 'browser' ? 'active' : ''}`}
                                                onClick={() => setMode('browser')} style={{padding: '8px 16px', fontSize: '13px'}}>
                                                Browser
                                            </button>
                                            <button className={`mode-btn whisper ${mode === 'whisper' ? 'active whisper' : ''}`}
                                                onClick={() => setMode('whisper')} style={{padding: '8px 16px', fontSize: '13px'}}>
                                                Whisper
                                            </button>
                                        </div>
                                    </div>

                                    <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                                        {mode === 'whisper' && !modelLoaded && (
                                            <button className="btn-large btn-outline" onClick={loadWhisperModel}
                                                disabled={modelLoading} style={{padding: '10px 20px'}}>
                                                {modelLoading ? 'Loading...' : 'Load Model'}
                                            </button>
                                        )}
                                        {mode === 'whisper' && (
                                            <select className="setting-input" value={selectedModel}
                                                onChange={(e) => setSelectedModel(e.target.value)}
                                                style={{width: 'auto', padding: '10px 12px'}}>
                                                <option value="tiny">Tiny</option>
                                                <option value="base">Base</option>
                                                <option value="small">Small</option>
                                            </select>
                                        )}
                                        <button
                                            className={`btn-large ${(browserListening || whisperRunning) ? 'btn-danger' : 'btn-primary'}`}
                                            style={{padding: '10px 24px', minWidth: '160px'}}
                                            onClick={() => {
                                                if (mode === 'browser') {
                                                    browserListening ? stopBrowserCaptions() : startBrowserCaptions();
                                                } else if (modelLoaded) {
                                                    whisperRunning ? stopWhisper() : startWhisper();
                                                } else {
                                                    loadWhisperModel();
                                                }
                                            }}
                                        >
                                            {(browserListening || whisperRunning) ? 'Stop Captioning' : 'Start Captioning'}
                                        </button>

                                        <div style={{width: '1px', height: '32px', background: 'var(--border-light)', margin: '0 4px'}}></div>

                                        <button
                                            className={`btn-large ${(browserListening || whisperRunning) ? 'btn-danger' : 'btn-outline'}`}
                                            onClick={toggleRecording}
                                            disabled={!(browserListening || whisperRunning)}
                                            style={{
                                                padding: '10px 20px',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px',
                                                opacity: (browserListening || whisperRunning) ? 1 : 0.5,
                                                cursor: (browserListening || whisperRunning) ? 'pointer' : 'not-allowed'
                                            }}
                                        >
                                            <div style={{
                                                width: '10px',
                                                height: '10px',
                                                borderRadius: '50%',
                                                background: (browserListening || whisperRunning) ? '#fff' : '#999',
                                                animation: (browserListening || whisperRunning) ? 'pulse 1s infinite' : 'none'
                                            }}></div>
                                            Stop & Analyze
                                        </button>
                                    </div>
                                </div>

                                {/* Whisper device selector - shown inline when whisper mode */}
                                {mode === 'whisper' && (
                                    <div style={{marginTop: '12px', paddingTop: '12px', borderTop: '1px solid var(--border-light)', display: 'flex', alignItems: 'center', gap: '12px'}}>
                                        <label style={{fontSize: '13px', color: 'var(--text-medium)'}}>Audio Device:</label>
                                        <select className="setting-input" value={selectedDevice}
                                            onChange={(e) => setSelectedDevice(e.target.value)}
                                            style={{flex: 1, padding: '8px 12px', maxWidth: '400px'}}>
                                            {whisperDevices.map(device => (
                                                <option key={device.id} value={device.id}>{device.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                )}

                            </div>

                            {/* Live Preview - 1920x1080 aspect ratio simulation */}
                            <div className="preview-section" style={{
                                background: '#1a1a1a',
                                aspectRatio: '16/9',
                                position: 'relative',
                                overflow: 'hidden',
                                borderRadius: 'var(--radius-lg)',
                                border: '2px solid var(--border-light)'
                            }}>
                                <div className="preview-label" style={{position: 'absolute', top: '12px', left: '12px', zIndex: 10}}>
                                    {t('Live Preview')} (1920Ã—1080)
                                </div>
                                <div className="preview-badges" style={{position: 'absolute', top: '12px', right: '12px', zIndex: 10}}>
                                    <div className="preview-badge mode">{mode.toUpperCase()}</div>
                                    {browserListening && <div className="preview-badge listening">LISTENING</div>}
                                    {whisperRunning && <div className="preview-badge whisper">WHISPER</div>}
                                    {engineEnabled && <div className="preview-badge engine">ENGINE ON</div>}
                                    {recording && <div className="preview-badge" style={{background: '#DC2626'}}>REC</div>}
                                </div>

                                {/* Caption display area - simulates overlay */}
                                <div style={{
                                    position: 'absolute',
                                    left: 0,
                                    right: 0,
                                    display: 'flex',
                                    justifyContent: 'center',
                                    padding: '0 40px',
                                    ...(captionPosition === 'top' ? {top: '60px'} :
                                        captionPosition === 'middle' ? {top: '50%', transform: 'translateY(-50%)'} :
                                        {bottom: '40px'})
                                }}>
                                    <div style={{
                                        fontSize: `${Math.round(fontSize * 0.5)}px`,
                                        lineHeight: lineHeight,
                                        maxWidth: `${maxWidth}%`,
                                        fontFamily: fontFamily,
                                        color: textColor,
                                        backgroundColor: `rgba(${parseInt(bgColor.slice(1,3),16)}, ${parseInt(bgColor.slice(3,5),16)}, ${parseInt(bgColor.slice(5,7),16)}, ${bgOpacity})`,
                                        padding: '8px 20px',
                                        borderRadius: '8px',
                                        textAlign: 'center',
                                        textShadow: '2px 2px 4px rgba(0,0,0,0.8)',
                                        minHeight: caption ? 'auto' : '40px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center'
                                    }}>
                                        {caption || <span style={{opacity: 0.5, fontStyle: 'italic'}}>Captions will appear here...</span>}
                                    </div>
                                </div>
                            </div>

                            {/* Caption Styling - moved under preview */}
                            <div className="card" style={{marginTop: '16px'}}>
                                <h2 className="card-title">Caption Styling</h2>
                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px'}}>
                                    <div className="setting-group">
                                        <label className="setting-label">
                                            Font Size <span className="setting-value">{fontSize}px</span>
                                        </label>
                                        <input type="range" className="setting-slider" min="24" max="72" value={fontSize}
                                            onChange={(e) => setFontSize(parseInt(e.target.value))} />
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">
                                            Line Height <span className="setting-value">{lineHeight}</span>
                                        </label>
                                        <input type="range" className="setting-slider" min="1.0" max="2.0" step="0.1" value={lineHeight}
                                            onChange={(e) => setLineHeight(parseFloat(e.target.value))} />
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">
                                            Max Width <span className="setting-value">{maxWidth}%</span>
                                        </label>
                                        <input type="range" className="setting-slider" min="50" max="100" value={maxWidth}
                                            onChange={(e) => setMaxWidth(parseInt(e.target.value))} />
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">Position</label>
                                        <select className="setting-input" value={captionPosition}
                                            onChange={(e) => setCaptionPosition(e.target.value)}>
                                            <option value="top">Top</option>
                                            <option value="middle">Middle</option>
                                            <option value="bottom">Bottom</option>
                                        </select>
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">Font Family</label>
                                        <select className="setting-input" value={fontFamily}
                                            onChange={(e) => setFontFamily(e.target.value)}>
                                            <option value="'DM Sans', sans-serif">DM Sans</option>
                                            <option value="sans-serif">Sans Serif</option>
                                            <option value="serif">Serif</option>
                                            <option value="'Arial', sans-serif">Arial</option>
                                            <option value="'Verdana', sans-serif">Verdana</option>
                                        </select>
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">
                                            Opacity <span className="setting-value">{Math.round(bgOpacity * 100)}%</span>
                                        </label>
                                        <input type="range" className="setting-slider" min="0" max="1" step="0.05" value={bgOpacity}
                                            onChange={(e) => setBgOpacity(parseFloat(e.target.value))} />
                                    </div>
                                </div>
                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginTop: '12px'}}>
                                    <div className="setting-group">
                                        <label className="setting-label">Text Color</label>
                                        <div className="color-input-group">
                                            <input type="text" className="setting-input" value={textColor}
                                                onChange={(e) => setTextColor(e.target.value)} />
                                            <input type="color" className="color-input" value={textColor}
                                                onChange={(e) => setTextColor(e.target.value)} />
                                        </div>
                                    </div>
                                    <div className="setting-group">
                                        <label className="setting-label">Background Color</label>
                                        <div className="color-input-group">
                                            <input type="text" className="setting-input" value={bgColor}
                                                onChange={(e) => setBgColor(e.target.value)} />
                                            <input type="color" className="color-input" value={bgColor}
                                                onChange={(e) => setBgColor(e.target.value)} />
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        {/* Sidebar Column - Caption Stats, Session, Overlay */}
                        <div className="sidebar-column">
                            {/* Caption Stats Card - NEW */}
                            <div className="card" style={{background: 'linear-gradient(135deg, var(--sage-primary), var(--sage-darker))', color: 'white'}}>
                                <h2 className="card-title" style={{color: 'white', borderColor: 'rgba(255,255,255,0.3)'}}>Caption Stats</h2>

                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '16px'}}>
                                    <div style={{background: 'rgba(255,255,255,0.15)', padding: '16px', borderRadius: '8px', textAlign: 'center'}}>
                                        <div style={{fontSize: '28px', fontWeight: '700'}}>{wordCount}</div>
                                        <div style={{fontSize: '12px', opacity: 0.8}}>WORDS</div>
                                    </div>
                                    <div style={{background: 'rgba(255,255,255,0.15)', padding: '16px', borderRadius: '8px', textAlign: 'center'}}>
                                        <div style={{fontSize: '28px', fontWeight: '700'}}>{formatDuration(sessionDuration)}</div>
                                        <div style={{fontSize: '12px', opacity: 0.8}}>DURATION</div>
                                    </div>
                                </div>

                                <div style={{background: 'rgba(255,255,255,0.1)', padding: '12px', borderRadius: '8px', marginBottom: '12px'}}>
                                    <div style={{fontSize: '12px', opacity: 0.8, marginBottom: '4px'}}>AI ENGINE</div>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                        <span style={{fontWeight: '600'}}>{engineName}</span>
                                        <div className={`toggle-switch ${engineEnabled ? 'on' : ''}`}
                                            onClick={toggleEngine}
                                            style={{transform: 'scale(0.8)'}}></div>
                                    </div>
                                </div>

                                <div
                                    style={{background: 'rgba(255,255,255,0.1)', padding: '12px', borderRadius: '8px', cursor: 'pointer'}}
                                    onClick={() => setShowCorrectionsPanel(!showCorrectionsPanel)}
                                >
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                        <div>
                                            <div style={{fontSize: '12px', opacity: 0.8}}>AI CORRECTIONS</div>
                                            <div style={{fontSize: '20px', fontWeight: '700'}}>{allCorrections.length}</div>
                                        </div>
                                        <span style={{fontSize: '18px'}}>{showCorrectionsPanel ? 'â–¼' : 'â–¶'}</span>
                                    </div>
                                </div>

                                {showCorrectionsPanel && allCorrections.length > 0 && (
                                    <div style={{marginTop: '12px', maxHeight: '200px', overflowY: 'auto', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', padding: '12px'}}>
                                        {allCorrections.slice(-10).reverse().map((c, i) => (
                                            <div key={i} style={{fontSize: '13px', marginBottom: '8px', padding: '8px', background: 'rgba(255,255,255,0.1)', borderRadius: '4px'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '4px'}}>
                                                    <span style={{textDecoration: 'line-through', opacity: 0.7}}>{c.from}</span>
                                                    <span style={{fontSize: '11px', opacity: 0.6}}>{c.timestamp ? new Date(c.timestamp).toLocaleTimeString() : ''}</span>
                                                </div>
                                                <div style={{fontWeight: '600'}}>â†’ {c.to}</div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {/* Caption Confidence Meter */}
                                <div style={{background: 'rgba(255,255,255,0.1)', padding: '12px', borderRadius: '8px', marginTop: '12px'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px'}}>
                                        <div style={{fontSize: '12px', opacity: 0.8}}>CONFIDENCE</div>
                                        <div style={{fontSize: '16px', fontWeight: '700'}}>
                                            {captionConfidence}%
                                        </div>
                                    </div>
                                    <div style={{width: '100%', height: '8px', background: 'rgba(0,0,0,0.3)', borderRadius: '4px', overflow: 'hidden'}}>
                                        <div style={{
                                            width: `${captionConfidence}%`,
                                            height: '100%',
                                            background: captionConfidence >= 80 ? '#7FBA7A' : captionConfidence >= 60 ? '#F0B429' : '#E76E50',
                                            transition: 'all 0.3s ease',
                                            borderRadius: '4px'
                                        }}></div>
                                    </div>
                                    <div style={{fontSize: '10px', opacity: 0.6, marginTop: '4px'}}>
                                        {captionConfidence >= 80 ? 'High accuracy' : captionConfidence >= 60 ? 'Moderate accuracy' : 'Low accuracy - check audio'}
                                    </div>
                                </div>

                                {/* Caption Delay Indicator */}
                                <div style={{background: 'rgba(255,255,255,0.1)', padding: '12px', borderRadius: '8px', marginTop: '12px'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                        <div>
                                            <div style={{fontSize: '12px', opacity: 0.8}}>LATENCY</div>
                                            <div style={{fontSize: '20px', fontWeight: '700'}}>
                                                {captionDelay.toFixed(1)}s
                                            </div>
                                        </div>
                                        <div style={{fontSize: '24px'}}>
                                            {captionDelay < 1 ? 'âš¡' : captionDelay < 3 ? 'â±ï¸' : 'ðŸŒ'}
                                        </div>
                                    </div>
                                    <div style={{fontSize: '10px', opacity: 0.6, marginTop: '4px'}}>
                                        {captionDelay < 1 ? 'Real-time' : captionDelay < 3 ? 'Near real-time' : 'Significant delay'}
                                    </div>
                                </div>
                            </div>

                            {/* Live Overlay Card */}
                            <div className="card">
                                <h2 className="card-title">Live Overlay</h2>
                                <button className="btn-large btn-primary" onClick={openOverlay} style={{width: '100%'}}>
                                    Open Overlay Window
                                </button>
                                <div style={{marginTop: '12px', fontSize: '12px', color: 'var(--text-medium)'}}>
                                    <div style={{marginBottom: '4px'}}><strong>Local:</strong> http://localhost:{port}/overlay.html</div>
                                    <div><strong>Network:</strong> http://{localIP}:{port}/overlay.html</div>
                                </div>
                            </div>

                        </div>

                        {/* AI Caption Engine Configuration Panel - Full Width */}
                        <div className="card" style={{gridColumn: '1 / -1', border: '2px solid var(--purple-accent)'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px'}}>
                                <h2 className="card-title" style={{margin: 0, borderBottom: 'none', paddingBottom: 0}}>
                                    AI Caption Engine Configuration
                                </h2>
                                <div style={{display: 'flex', gap: '12px', alignItems: 'center'}}>
                                    <label className="btn-large btn-outline" style={{display: 'flex', alignItems: 'center', cursor: 'pointer', padding: '8px 16px'}}>
                                        Upload Engine
                                        <input type="file" accept=".json" onChange={uploadEngine} style={{display: 'none'}} />
                                    </label>
                                    <button className="btn-large btn-outline" onClick={() => setShowEnginePanel(!showEnginePanel)}
                                        style={{padding: '8px 16px'}}>
                                        {showEnginePanel ? 'Collapse â–²' : 'Expand â–¼'}
                                    </button>
                                </div>
                            </div>
                            {showEnginePanel && <EngineWizardInline onClose={() => setShowEnginePanel(false)} />}
                        </div>

                        {/* Create Your Own Engine Panel - Full Width */}
                        {!showKnowledgePanel ? (
                            <div style={{gridColumn: '1 / -1', display: 'flex', justifyContent: 'center', padding: '20px 0'}}>
                                <button
                                    onClick={() => { setShowKnowledgePanel(true); loadKnowledgeStatus(); }}
                                    style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '12px',
                                        padding: '16px 32px',
                                        fontSize: '16px',
                                        fontWeight: '600',
                                        background: 'linear-gradient(135deg, var(--sage-primary) 0%, var(--sage-dark) 100%)',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '12px',
                                        cursor: 'pointer',
                                        boxShadow: '0 4px 15px rgba(104, 132, 103, 0.3)',
                                        transition: 'all 0.3s ease',
                                    }}
                                    onMouseEnter={e => {
                                        e.target.style.transform = 'translateY(-2px)';
                                        e.target.style.boxShadow = '0 6px 20px rgba(104, 132, 103, 0.4)';
                                    }}
                                    onMouseLeave={e => {
                                        e.target.style.transform = 'translateY(0)';
                                        e.target.style.boxShadow = '0 4px 15px rgba(104, 132, 103, 0.3)';
                                    }}
                                >
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 8v8M8 12h8" strokeLinecap="round"/>
                                    </svg>
                                    Create Your Own Engine
                                    {knowledgeStatus.documents?.length > 0 && (
                                        <span style={{
                                            background: 'rgba(255,255,255,0.2)',
                                            padding: '4px 10px',
                                            borderRadius: '20px',
                                            fontSize: '13px'
                                        }}>
                                            {knowledgeStatus.documents.length} sources
                                        </span>
                                    )}
                                </button>
                            </div>
                        ) : (
                            <div className="card" style={{
                                gridColumn: '1 / -1',
                                border: '2px solid var(--sage-primary)',
                                background: 'linear-gradient(180deg, var(--bg-sage-light) 0%, white 100%)',
                                animation: 'slideDown 0.3s ease-out'
                            }}>
                                <style>{`
                                    @keyframes slideDown {
                                        from { opacity: 0; transform: translateY(-10px); }
                                        to { opacity: 1; transform: translateY(0); }
                                    }
                                `}</style>

                                {/* Header */}
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px'}}>
                                    <div>
                                        <h2 className="card-title" style={{margin: 0, borderBottom: 'none', paddingBottom: 0, display: 'flex', alignItems: 'center', gap: '12px'}}>
                                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--sage-primary)" strokeWidth="2">
                                                <circle cx="12" cy="12" r="3"/>
                                                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                                            </svg>
                                            Create Your Own Engine
                                        </h2>
                                        <p style={{margin: '8px 0 0', fontSize: '14px', color: 'var(--text-medium)', maxWidth: '600px'}}>
                                            Build a custom correction engine by importing documents, webpages, or YouTube transcripts.
                                            AI will automatically extract proper nouns (names, places, organizations) to improve caption accuracy.
                                        </p>
                                    </div>
                                    <div style={{display: 'flex', gap: '12px'}}>
                                        <button
                                            onClick={() => {
                                                fetch('/api/engine/export')
                                                    .then(r => r.json())
                                                    .then(data => {
                                                        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                                                        const url = URL.createObjectURL(blob);
                                                        const a = document.createElement('a');
                                                        a.href = url;
                                                        a.download = 'custom_engine.json';
                                                        a.click();
                                                    });
                                            }}
                                            className="btn-large btn-outline"
                                            style={{padding: '8px 16px', display: 'flex', alignItems: 'center', gap: '8px'}}
                                        >
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                            </svg>
                                            Download Engine
                                        </button>
                                        <button onClick={() => setShowKnowledgePanel(false)} className="btn-large btn-outline" style={{padding: '8px 16px'}}>
                                            Close
                                        </button>
                                    </div>
                                </div>

                                {/* Progress Indicator */}
                                {knowledgeProgress.active && (
                                    <div style={{
                                        background: 'white',
                                        border: '1px solid var(--sage-primary)',
                                        borderRadius: '8px',
                                        padding: '16px',
                                        marginBottom: '20px'
                                    }}>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '8px'}}>
                                            <div className="loading-spinner" style={{width: '20px', height: '20px'}}></div>
                                            <span style={{fontWeight: '500'}}>{knowledgeProgress.step}</span>
                                        </div>
                                        <div style={{
                                            height: '6px',
                                            background: 'var(--bg-sage-light)',
                                            borderRadius: '3px',
                                            overflow: 'hidden'
                                        }}>
                                            <div style={{
                                                height: '100%',
                                                width: `${knowledgeProgress.progress}%`,
                                                background: 'var(--sage-primary)',
                                                borderRadius: '3px',
                                                transition: 'width 0.3s ease'
                                            }}></div>
                                        </div>
                                    </div>
                                )}

                                {/* Main Content Grid */}
                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px'}}>

                                    {/* Left Column - Import Sources */}
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '16px'}}>

                                        {/* Drag & Drop Zone */}
                                        <div
                                            onDragEnter={handleDragEnter}
                                            onDragLeave={handleDragLeave}
                                            onDragOver={handleDragOver}
                                            onDrop={handleDrop}
                                            style={{
                                                border: knowledgeDragActive ? '3px dashed var(--sage-primary)' : '2px dashed var(--border-sage)',
                                                borderRadius: '12px',
                                                padding: '32px',
                                                textAlign: 'center',
                                                background: knowledgeDragActive ? 'var(--bg-sage-light)' : 'white',
                                                transition: 'all 0.2s ease',
                                                cursor: 'pointer'
                                            }}
                                            onClick={() => document.getElementById('file-upload-input').click()}
                                        >
                                            <input
                                                id="file-upload-input"
                                                type="file"
                                                accept=".pdf,.docx,.doc,.txt"
                                                onChange={uploadKnowledgeFile}
                                                style={{display: 'none'}}
                                                disabled={knowledgeUploading}
                                            />
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke={knowledgeDragActive ? 'var(--sage-primary)' : 'var(--text-light)'} strokeWidth="1.5" style={{marginBottom: '12px'}}>
                                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                                            </svg>
                                            <div style={{fontWeight: '600', fontSize: '16px', color: knowledgeDragActive ? 'var(--sage-primary)' : 'var(--text-dark)', marginBottom: '4px'}}>
                                                {knowledgeDragActive ? 'Drop file here' : 'Drag & drop files here'}
                                            </div>
                                            <div style={{fontSize: '13px', color: 'var(--text-light)'}}>
                                                or click to browse (PDF, DOCX, TXT)
                                            </div>
                                        </div>

                                        {/* URL Import */}
                                        <div style={{background: 'white', borderRadius: '12px', padding: '16px', border: '1px solid var(--border-light)'}}>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '12px'}}>
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--sage-primary)" strokeWidth="2">
                                                    <circle cx="12" cy="12" r="10"/>
                                                    <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
                                                </svg>
                                                <span style={{fontWeight: '600'}}>Import from Website</span>
                                            </div>
                                            <div style={{display: 'flex', gap: '8px'}}>
                                                <input
                                                    type="url"
                                                    className="setting-input"
                                                    placeholder="https://example.com/meeting-agenda"
                                                    value={knowledgeUrlInput}
                                                    onChange={(e) => setKnowledgeUrlInput(e.target.value)}
                                                    style={{flex: 1, fontSize: '13px'}}
                                                />
                                                <button
                                                    onClick={importFromUrl}
                                                    disabled={knowledgeUrlLoading || !knowledgeUrlInput.trim()}
                                                    className="btn-large btn-primary"
                                                    style={{padding: '8px 16px', whiteSpace: 'nowrap'}}
                                                >
                                                    {knowledgeUrlLoading ? 'Loading...' : 'Import'}
                                                </button>
                                            </div>
                                        </div>

                                        {/* YouTube Import */}
                                        <div style={{background: 'white', borderRadius: '12px', padding: '16px', border: '1px solid var(--border-light)'}}>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '12px'}}>
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FF0000" strokeWidth="2">
                                                    <rect x="2" y="4" width="20" height="16" rx="4"/>
                                                    <polygon points="10 8 16 12 10 16" fill="#FF0000"/>
                                                </svg>
                                                <span style={{fontWeight: '600'}}>Import YouTube Transcript</span>
                                            </div>
                                            <div style={{display: 'flex', gap: '8px'}}>
                                                <input
                                                    type="url"
                                                    className="setting-input"
                                                    placeholder="https://youtube.com/watch?v=..."
                                                    value={knowledgeYoutubeInput}
                                                    onChange={(e) => setKnowledgeYoutubeInput(e.target.value)}
                                                    style={{flex: 1, fontSize: '13px'}}
                                                />
                                                <button
                                                    onClick={importFromYoutube}
                                                    disabled={knowledgeYoutubeLoading || !knowledgeYoutubeInput.trim()}
                                                    className="btn-large btn-primary"
                                                    style={{padding: '8px 16px', whiteSpace: 'nowrap'}}
                                                >
                                                    {knowledgeYoutubeLoading ? 'Loading...' : 'Import'}
                                                </button>
                                            </div>
                                            <div style={{fontSize: '11px', color: 'var(--text-light)', marginTop: '8px'}}>
                                                Uses the video's captions/transcript to extract names and terms
                                            </div>
                                        </div>

                                        {/* Paste Text */}
                                        <div style={{background: 'white', borderRadius: '12px', padding: '16px', border: '1px solid var(--border-light)'}}>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '12px'}}>
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--sage-primary)" strokeWidth="2">
                                                    <rect x="9" y="9" width="13" height="13" rx="2"/>
                                                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                                                </svg>
                                                <span style={{fontWeight: '600'}}>Paste Text</span>
                                            </div>
                                            <textarea
                                                className="setting-input"
                                                rows="3"
                                                placeholder="Paste meeting agenda, roster, or any document with names..."
                                                value={knowledgeUploadText}
                                                onChange={(e) => setKnowledgeUploadText(e.target.value)}
                                                style={{fontSize: '13px', marginBottom: '8px'}}
                                            />
                                            <button
                                                onClick={uploadKnowledgeText}
                                                disabled={knowledgeUploading || !knowledgeUploadText.trim()}
                                                className="btn-large btn-outline"
                                                style={{width: '100%'}}
                                            >
                                                Extract Names from Text
                                            </button>
                                        </div>

                                    </div>

                                    {/* Right Column - Results */}
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '16px'}}>

                                        {/* Imported Sources */}
                                        <div style={{background: 'white', borderRadius: '12px', padding: '16px', border: '1px solid var(--border-light)', flex: 1}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                                                <h3 style={{margin: 0, fontSize: '16px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px'}}>
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--sage-primary)" strokeWidth="2">
                                                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                                        <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                                                    </svg>
                                                    Imported Sources ({knowledgeStatus.documents?.length || 0})
                                                </h3>
                                                <button onClick={syncKnowledgeToEngine} className="btn-large btn-primary" style={{padding: '6px 12px', fontSize: '12px'}}>
                                                    Sync to Engine
                                                </button>
                                            </div>
                                            {(!knowledgeStatus.documents || knowledgeStatus.documents.length === 0) ? (
                                                <div style={{padding: '30px', textAlign: 'center', color: 'var(--text-light)', fontSize: '14px'}}>
                                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" style={{marginBottom: '12px', opacity: 0.5}}>
                                                        <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                                                        <path d="M13 2v7h7"/>
                                                    </svg>
                                                    <div>No sources imported yet</div>
                                                    <div style={{fontSize: '12px', marginTop: '4px'}}>Add a document, URL, or YouTube video to get started</div>
                                                </div>
                                            ) : (
                                                <div style={{display: 'flex', flexDirection: 'column', gap: '8px', maxHeight: '180px', overflowY: 'auto'}}>
                                                    {knowledgeStatus.documents.map((doc, i) => (
                                                        <div key={i} style={{
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center',
                                                            padding: '10px 12px',
                                                            background: 'var(--bg-warm)',
                                                            borderRadius: '8px',
                                                            fontSize: '13px'
                                                        }}>
                                                            <div style={{display: 'flex', alignItems: 'center', gap: '8px', flex: 1, overflow: 'hidden'}}>
                                                                {(doc.filename || '').includes('youtube') ? (
                                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="#FF0000"><rect x="2" y="4" width="20" height="16" rx="4"/><polygon points="10 8 16 12 10 16" fill="white"/></svg>
                                                                ) : (doc.filename || '').includes('.pdf') ? (
                                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#E53935" strokeWidth="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
                                                                ) : (
                                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--text-medium)" strokeWidth="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
                                                                )}
                                                                <span style={{overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap'}}>
                                                                    {doc.filename || doc.doc_id}
                                                                </span>
                                                            </div>
                                                            <span style={{color: 'var(--sage-primary)', fontWeight: '500', marginLeft: '12px', whiteSpace: 'nowrap'}}>
                                                                {doc.entity_count || 0} names
                                                            </span>
                                                            <button
                                                                onClick={() => removeKnowledgeDocument(doc.doc_id)}
                                                                style={{marginLeft: '8px', padding: '4px 8px', fontSize: '11px', background: 'transparent', border: '1px solid var(--border-light)', borderRadius: '4px', cursor: 'pointer'}}
                                                            >
                                                                Remove
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>

                                        {/* Extracted Entities */}
                                        <div style={{background: 'white', borderRadius: '12px', padding: '16px', border: '1px solid var(--border-light)'}}>
                                            <h3 style={{margin: '0 0 12px', fontSize: '16px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px'}}>
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--sage-primary)" strokeWidth="2">
                                                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                                    <circle cx="9" cy="7" r="4"/>
                                                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                                                </svg>
                                                Extracted Names ({knowledgeEntities.length})
                                            </h3>
                                            {knowledgeEntities.length === 0 ? (
                                                <div style={{padding: '20px', textAlign: 'center', color: 'var(--text-light)', fontSize: '13px'}}>
                                                    Names extracted from your sources will appear here
                                                </div>
                                            ) : (
                                                <div style={{display: 'flex', flexWrap: 'wrap', gap: '6px', maxHeight: '120px', overflowY: 'auto'}}>
                                                    {knowledgeEntities.slice(0, 40).map((entity, i) => (
                                                        <span key={i} style={{
                                                            padding: '4px 10px',
                                                            background: entity.category === 'person' ? '#E8F5E9' : entity.category === 'place' ? '#E3F2FD' : '#FFF3E0',
                                                            color: entity.category === 'person' ? '#2E7D32' : entity.category === 'place' ? '#1565C0' : '#E65100',
                                                            borderRadius: '12px',
                                                            fontSize: '12px',
                                                            fontWeight: '500'
                                                        }}>
                                                            {entity.term || entity.name}
                                                        </span>
                                                    ))}
                                                    {knowledgeEntities.length > 40 && (
                                                        <span style={{padding: '4px 10px', color: 'var(--text-light)', fontSize: '12px'}}>
                                                            +{knowledgeEntities.length - 40} more
                                                        </span>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        {/* Legend */}
                                        <div style={{display: 'flex', gap: '16px', fontSize: '12px', color: 'var(--text-medium)'}}>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '6px'}}>
                                                <span style={{width: '12px', height: '12px', borderRadius: '50%', background: '#E8F5E9', border: '1px solid #2E7D32'}}></span>
                                                People
                                            </div>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '6px'}}>
                                                <span style={{width: '12px', height: '12px', borderRadius: '50%', background: '#E3F2FD', border: '1px solid #1565C0'}}></span>
                                                Places
                                            </div>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '6px'}}>
                                                <span style={{width: '12px', height: '12px', borderRadius: '50%', background: '#FFF3E0', border: '1px solid #E65100'}}></span>
                                                Organizations
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Video Intelligence Panel - Full Width */}
                        <div className="card" style={{gridColumn: '1 / -1', border: '1px solid var(--border-sage)'}}>
                            <div
                                style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', cursor: 'pointer'}}
                                onClick={() => { setShowVideoPanel(!showVideoPanel); if (!showVideoPanel) loadVideoStatus(); }}
                            >
                                <h2 className="card-title" style={{margin: 0, borderBottom: 'none', paddingBottom: 0, display: 'flex', alignItems: 'center', gap: '12px'}}>
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--sage-primary)" strokeWidth="2">
                                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                    </svg>
                                    Video Intelligence
                                    {videoStatus.has_video && (
                                        <span style={{
                                            background: 'var(--sage-primary)',
                                            color: 'white',
                                            fontSize: '12px',
                                            fontWeight: '600',
                                            padding: '2px 8px',
                                            borderRadius: '12px'
                                        }}>
                                            Video Ready
                                        </span>
                                    )}
                                </h2>
                                <button className="btn-large btn-outline" style={{padding: '8px 16px'}}>
                                    {showVideoPanel ? 'Collapse â–²' : 'Expand â–¼'}
                                </button>
                            </div>

                            {showVideoPanel && (
                                <div style={{marginTop: '20px'}}>
                                    <p style={{fontSize: '14px', color: 'var(--text-medium)', marginBottom: '20px'}}>
                                        Upload video recordings to generate AI-powered highlight clips and reels.
                                        {!videoStatus.ffmpeg_available && (
                                            <span style={{color: '#B45309', marginLeft: '8px'}}>
                                                (ffmpeg required for clip extraction)
                                            </span>
                                        )}
                                    </p>

                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px'}}>
                                        {/* Upload Section */}
                                        <div className="card" style={{background: 'var(--bg-sage-light)', border: 'none'}}>
                                            <h3 style={{fontSize: '16px', fontWeight: '600', marginBottom: '12px'}}>Upload Video</h3>
                                            <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                                                <label className="btn-large btn-primary" style={{display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'}}>
                                                    {videoUploading ? 'Uploading...' : 'Select MP4 / MOV'}
                                                    <input type="file" accept=".mp4,.mov,.webm" onChange={uploadVideo} style={{display: 'none'}} disabled={videoUploading} />
                                                </label>
                                                <div style={{fontSize: '12px', color: 'var(--text-light)', textAlign: 'center'}}>
                                                    Status: {videoStatus.has_video ? 'Video loaded' : 'No video'}
                                                    {videoStatus.duration && ` (${Math.round(videoStatus.duration / 60)} min)`}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Generate Transcript */}
                                        <div className="card" style={{background: 'white'}}>
                                            <h3 style={{fontSize: '16px', fontWeight: '600', marginBottom: '12px'}}>Generate Transcript</h3>
                                            <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                                                <button
                                                    className="btn-large btn-primary"
                                                    onClick={generateVideoTranscript}
                                                    disabled={!videoStatus.has_video || videoTranscribing}
                                                    style={{opacity: videoStatus.has_video ? 1 : 0.5}}
                                                >
                                                    {videoTranscribing ? 'Transcribing...' : 'Transcribe with Whisper'}
                                                </button>
                                                <button
                                                    className="btn-large btn-outline"
                                                    onClick={generateHighlights}
                                                    disabled={!videoStatus.has_video}
                                                    style={{opacity: videoStatus.has_video ? 1 : 0.5}}
                                                >
                                                    Detect Key Moments
                                                </button>
                                                <button
                                                    className="btn-large btn-outline"
                                                    onClick={generateHighlightReel}
                                                    disabled={!videoStatus.has_video || !videoStatus.ffmpeg_available}
                                                    style={{opacity: (videoStatus.has_video && videoStatus.ffmpeg_available) ? 1 : 0.5}}
                                                >
                                                    Create Highlight Reel
                                                </button>
                                            </div>
                                        </div>

                                        {/* Highlights List */}
                                        {videoHighlights.length > 0 && (
                                            <div className="card" style={{background: 'white', gridColumn: 'span 2'}}>
                                                <h3 style={{fontSize: '16px', fontWeight: '600', marginBottom: '12px'}}>
                                                    Detected Highlights ({videoHighlights.length})
                                                </h3>
                                                <div style={{display: 'flex', flexDirection: 'column', gap: '8px', maxHeight: '200px', overflowY: 'auto'}}>
                                                    {videoHighlights.map((highlight, i) => (
                                                        <div key={i} style={{
                                                            padding: '12px',
                                                            background: 'var(--bg-warm)',
                                                            borderRadius: '8px',
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center'
                                                        }}>
                                                            <div>
                                                                <div style={{fontWeight: '600', fontSize: '14px'}}>{highlight.title || `Highlight ${i + 1}`}</div>
                                                                <div style={{fontSize: '12px', color: 'var(--text-light)'}}>
                                                                    {highlight.start_time ? `${Math.floor(highlight.start_time / 60)}:${String(Math.floor(highlight.start_time % 60)).padStart(2, '0')}` : ''} -
                                                                    {highlight.end_time ? ` ${Math.floor(highlight.end_time / 60)}:${String(Math.floor(highlight.end_time % 60)).padStart(2, '0')}` : ''}
                                                                </div>
                                                            </div>
                                                            <span style={{
                                                                padding: '4px 10px',
                                                                background: 'var(--purple-accent)',
                                                                color: 'white',
                                                                borderRadius: '12px',
                                                                fontSize: '11px',
                                                                fontWeight: '600'
                                                            }}>
                                                                {highlight.score ? `${Math.round(highlight.score * 100)}%` : 'Key Moment'}
                                                            </span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {/* Transcript Display */}
                                        {videoTranscript && (
                                            <div className="card" style={{background: 'white', gridColumn: 'span 2'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                                                    <h3 style={{fontSize: '16px', fontWeight: '600', margin: 0}}>
                                                        Video Transcript
                                                    </h3>
                                                    <div style={{display: 'flex', gap: '8px'}}>
                                                        <button
                                                            className="btn-large btn-outline"
                                                            onClick={() => downloadTranscript('txt')}
                                                            style={{padding: '6px 12px', fontSize: '12px'}}
                                                        >
                                                            Download TXT
                                                        </button>
                                                        <button
                                                            className="btn-large btn-outline"
                                                            onClick={() => downloadTranscript('srt')}
                                                            style={{padding: '6px 12px', fontSize: '12px'}}
                                                        >
                                                            Download SRT
                                                        </button>
                                                    </div>
                                                </div>
                                                <div style={{
                                                    maxHeight: '200px',
                                                    overflowY: 'auto',
                                                    padding: '16px',
                                                    background: 'var(--bg-warm)',
                                                    borderRadius: '8px',
                                                    fontSize: '14px',
                                                    lineHeight: '1.6',
                                                    whiteSpace: 'pre-wrap'
                                                }}>
                                                    {videoTranscript}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function EngineWizardInline({ onClose }) {
            const [engineStats, setEngineStats] = useState(null);
            const [newTerm, setNewTerm] = useState({ term: '', category: 'person', aliases: '' });
            const [testText, setTestText] = useState('');
            const [testResult, setTestResult] = useState('');
            const [aiConfig, setAiConfig] = useState(null);
            const [recentTerms, setRecentTerms] = useState([]);

            // Load AI config and engine stats
            useEffect(() => {
                fetch('/api/ai/config')
                    .then(r => r.json())
                    .then(data => setAiConfig(data));

                loadEngineStats();
                const interval = setInterval(loadEngineStats, 2000);
                return () => clearInterval(interval);
            }, []);

            const loadEngineStats = () => {
                fetch('/api/engine/status')
                    .then(r => r.json())
                    .then(data => {
                        setEngineStats(data);
                    });

                fetch('/api/engine/terms')
                    .then(r => r.json())
                    .then(data => {
                        if (data.terms) {
                            const termsList = Object.entries(data.terms)
                                .map(([key, val]) => ({ key, ...val }))
                                .slice(0, 10);
                            setRecentTerms(termsList);
                        }
                    });
            };

            const isAILocal = aiConfig && (
                aiConfig.provider === 'ollama' ||
                aiConfig.provider === 'lmstudio' ||
                (aiConfig.provider === 'custom' && (aiConfig.custom_base_url.includes('localhost') || aiConfig.custom_base_url.includes('127.0.0.1')))
            );

            const addTerm = () => {
                if (!newTerm.term) return;

                const aliasArray = newTerm.aliases.split(',').map(a => a.trim()).filter(a => a);

                fetch('/api/engine/term', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        term: newTerm.term,
                        category: newTerm.category,
                        aliases: aliasArray
                    })
                })
                .then(r => r.json())
                .then(data => {
                    setNewTerm({ term: '', category: 'person', aliases: '' });
                    loadEngineStats();
                    alert('Term added successfully!');
                });
            };

            const loadBrooklineDefaults = () => {
                if (confirm('Load Brookline, MA template? This will add default terms for Brookline government.')) {
                    fetch('/api/engine/defaults', { method: 'POST' })
                        .then(r => r.json())
                        .then(data => {
                            alert('Brookline defaults loaded!');
                            loadEngineStats();
                        });
                }
            };

            const testCorrection = () => {
                fetch(`/api/engine/test?text=${encodeURIComponent(testText)}`)
                    .then(r => r.json())
                    .then(data => {
                        setTestResult(data.corrected || testText);
                    });
            };

            const exportEngine = () => {
                window.open('/api/engine/export', '_blank');
            };

            const uploadEngine = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const engineData = JSON.parse(e.target.result);
                        fetch('/api/engine/import', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(engineData)
                        })
                        .then(r => r.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert(`Engine uploaded! Loaded ${data.terms_count || 0} terms.`);
                                loadEngineStats();
                            } else {
                                alert('Error: ' + (data.error || 'Unknown error'));
                            }
                        });
                    } catch (err) {
                        alert('Invalid engine file: ' + err.message);
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            return (
                <div>
                    {/* Stats Bar - Fixed to show correct API fields */}
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '12px', marginBottom: '20px'}}>
                        <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                            <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-primary)'}}>
                                {engineStats ? engineStats.terms_count : '...'}
                            </div>
                            <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600'}}>Terms</div>
                        </div>
                        <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                            <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-primary)'}}>
                                {engineStats ? engineStats.rules_count : '...'}
                            </div>
                            <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600'}}>Rules</div>
                        </div>
                        <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                            <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--purple-accent)'}}>
                                {engineStats?.stats ? engineStats.stats.corrections_applied : '...'}
                            </div>
                            <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600'}}>Corrections</div>
                        </div>
                        <div style={{textAlign: 'center', padding: '16px', background: engineStats?.enabled ? '#E8F5E9' : '#FFEBEE', borderRadius: '8px'}}>
                            <div style={{fontSize: '28px', fontWeight: '700', color: engineStats?.enabled ? '#2E7D32' : '#C62828'}}>
                                {engineStats?.enabled ? 'ON' : 'OFF'}
                            </div>
                            <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600'}}>Status</div>
                        </div>
                    </div>

                    {/* Three-column workflow layout */}
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px', marginBottom: '20px'}}>
                        {/* Step 1: Load/Configure */}
                        <div style={{background: 'white', borderRadius: '12px', padding: '20px', border: '2px solid var(--border-sage)'}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '16px'}}>
                                <div style={{width: '28px', height: '28px', borderRadius: '50%', background: 'var(--purple-accent)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px'}}>1</div>
                                <h3 style={{fontSize: '16px', fontWeight: '700', margin: 0}}>Load Engine</h3>
                            </div>
                            <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                                <button className="btn-large btn-primary" style={{fontSize: '13px', padding: '10px'}} onClick={loadBrooklineDefaults}>
                                    Load Brookline Template
                                </button>
                                <label className="btn-large btn-outline" style={{display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', fontSize: '13px', padding: '10px'}}>
                                    Upload Custom Engine
                                    <input type="file" accept=".json" onChange={uploadEngine} style={{display: 'none'}} />
                                </label>
                            </div>
                        </div>

                        {/* Step 2: Add Terms */}
                        <div style={{background: 'white', borderRadius: '12px', padding: '20px', border: '2px solid var(--border-sage)'}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '16px'}}>
                                <div style={{width: '28px', height: '28px', borderRadius: '50%', background: 'var(--purple-accent)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px'}}>2</div>
                                <h3 style={{fontSize: '16px', fontWeight: '700', margin: 0}}>Add Terms</h3>
                            </div>
                            <div style={{display: 'flex', flexDirection: 'column', gap: '6px'}}>
                                <input
                                    type="text"
                                    className="setting-input"
                                    placeholder="Term (e.g., Bernard Greene)"
                                    value={newTerm.term}
                                    onChange={(e) => setNewTerm({...newTerm, term: e.target.value})}
                                    style={{fontSize: '13px', padding: '8px'}}
                                />
                                <div style={{display: 'flex', gap: '6px'}}>
                                    <select
                                        className="setting-input"
                                        value={newTerm.category}
                                        onChange={(e) => setNewTerm({...newTerm, category: e.target.value})}
                                        style={{fontSize: '13px', padding: '8px', flex: 1}}
                                    >
                                        <option value="person">Person</option>
                                        <option value="place">Place</option>
                                        <option value="organization">Org</option>
                                    </select>
                                    <button className="btn-large btn-primary" style={{fontSize: '13px', padding: '8px 16px'}} onClick={addTerm}>
                                        Add
                                    </button>
                                </div>
                                <input
                                    type="text"
                                    className="setting-input"
                                    placeholder="Aliases (comma-separated)"
                                    value={newTerm.aliases}
                                    onChange={(e) => setNewTerm({...newTerm, aliases: e.target.value})}
                                    style={{fontSize: '13px', padding: '8px'}}
                                />
                            </div>
                        </div>

                        {/* Step 3: Download */}
                        <div style={{background: 'white', borderRadius: '12px', padding: '20px', border: '2px solid var(--border-sage)'}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '16px'}}>
                                <div style={{width: '28px', height: '28px', borderRadius: '50%', background: 'var(--purple-accent)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px'}}>3</div>
                                <h3 style={{fontSize: '16px', fontWeight: '700', margin: 0}}>Save Engine</h3>
                            </div>
                            <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                                <button className="btn-large btn-primary" style={{fontSize: '13px', padding: '10px'}} onClick={exportEngine}>
                                    Download Engine JSON
                                </button>
                                <p style={{fontSize: '12px', color: 'var(--text-light)', margin: '8px 0 0 0'}}>
                                    Save your configured engine to reuse later or share with others.
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Test Engine - Full Width */}
                    <div style={{background: 'white', borderRadius: '12px', padding: '20px', border: '2px solid var(--border-sage)'}}>
                        <h3 style={{fontSize: '16px', fontWeight: '700', marginBottom: '12px'}}>Test Corrections</h3>
                        <div style={{display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '12px', alignItems: 'center'}}>
                            <textarea
                                className="setting-input"
                                rows="2"
                                placeholder="Type text to test (e.g., 'bernard green spoke at brooklyn town hall')..."
                                value={testText}
                                onChange={(e) => setTestText(e.target.value)}
                                style={{fontSize: '14px'}}
                            />
                            <button className="btn-large btn-primary" style={{fontSize: '14px', padding: '10px'}} onClick={testCorrection}>
                                Test â†’
                            </button>
                            <div style={{padding: '12px', background: 'var(--bg-sage-light)', borderRadius: '8px', minHeight: '50px', fontSize: '14px'}}>
                                {testResult || 'Result will appear here...'}
                            </div>
                        </div>
                    </div>

                    {/* Current Terms - Full Width */}
                    {recentTerms.length > 0 && (
                        <div style={{background: 'white', borderRadius: '12px', padding: '20px', border: '2px solid var(--border-sage)', marginTop: '16px'}}>
                            <h3 style={{fontSize: '16px', fontWeight: '700', marginBottom: '12px'}}>
                                Current Terms ({engineStats?.terms_count || 0})
                            </h3>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '10px'}}>
                                {recentTerms.map((term, idx) => (
                                    <div key={idx} style={{
                                        padding: '12px',
                                        background: term.category === 'person' ? '#E8F5E9' : term.category === 'place' ? '#E3F2FD' : '#FFF3E0',
                                        borderRadius: '8px',
                                        borderLeft: '3px solid',
                                        borderLeftColor: term.category === 'person' ? 'var(--sage-primary)' : term.category === 'place' ? '#1976D2' : '#F57C00'
                                    }}>
                                        <div style={{fontWeight: '600', fontSize: '14px', color: 'var(--text-dark)', marginBottom: '2px'}}>
                                            {term.term}
                                        </div>
                                        <div style={{fontSize: '11px', color: 'var(--text-medium)', textTransform: 'uppercase', letterSpacing: '0.5px'}}>
                                            {term.category}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <p style={{fontSize: '12px', color: 'var(--text-medium)', marginTop: '12px', fontStyle: 'italic'}}>
                                Showing first 10 terms. Download engine JSON to see all terms.
                            </p>
                        </div>
                    )}
                </div>
            );
        }


        function AISettings({ onBack }) {
            const [config, setConfig] = useState(null);
            const [provider, setProvider] = useState('none');
            const [openaiKey, setOpenaiKey] = useState('');
            const [openaiModel, setOpenaiModel] = useState('gpt-4o-mini');
            const [ollamaUrl, setOllamaUrl] = useState('http://localhost:11434');
            const [ollamaModel, setOllamaModel] = useState('llama3.2');
            const [lmstudioUrl, setLmstudioUrl] = useState('http://localhost:1234/v1');
            const [lmstudioModel, setLmstudioModel] = useState('local-model');
            const [customUrl, setCustomUrl] = useState('');
            const [customKey, setCustomKey] = useState('');
            const [customModel, setCustomModel] = useState('');
            const [testResult, setTestResult] = useState('');
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                // Load current config
                fetch('/api/ai/config')
                    .then(r => r.json())
                    .then(data => {
                        setConfig(data);
                        setProvider(data.provider || 'none');
                        if (data.openai_api_key && data.openai_api_key !== '***') setOpenaiKey(data.openai_api_key);
                        setOpenaiModel(data.openai_model || 'gpt-4o-mini');
                        setOllamaUrl(data.ollama_base_url || 'http://localhost:11434');
                        setOllamaModel(data.ollama_model || 'llama3.2');
                        setLmstudioUrl(data.lmstudio_base_url || 'http://localhost:1234/v1');
                        setLmstudioModel(data.lmstudio_model || 'local-model');
                        setCustomUrl(data.custom_base_url || '');
                        setCustomKey(data.custom_api_key || '');
                        setCustomModel(data.custom_model || '');
                    });
            }, []);

            const saveConfig = () => {
                setSaving(true);
                setTestResult('');

                const newConfig = {
                    provider,
                    openai_api_key: openaiKey,
                    openai_model: openaiModel,
                    ollama_base_url: ollamaUrl,
                    ollama_model: ollamaModel,
                    lmstudio_base_url: lmstudioUrl,
                    lmstudio_model: lmstudioModel,
                    custom_base_url: customUrl,
                    custom_api_key: customKey,
                    custom_model: customModel
                };

                fetch('/api/ai/config/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newConfig)
                })
                .then(r => r.json())
                .then(data => {
                    setSaving(false);
                    if (data.error) {
                        alert('Error: ' + data.error);
                    } else {
                        setConfig(data);
                        alert('AI configuration saved!');
                    }
                });
            };

            const testConnection = () => {
                setTestResult('Testing...');
                fetch('/api/ai/test', { method: 'POST' })
                    .then(r => r.json())
                    .then(data => {
                        if (data.error) {
                            setTestResult('âŒ Test failed: ' + data.error);
                        } else {
                            setTestResult(`âœ“ Test successful! Response: "${data.response}" (${data.is_local ? 'LOCAL' : 'CLOUD'})`);
                        }
                    });
            };

            const isLocal = config && (
                provider === 'ollama' ||
                provider === 'lmstudio' ||
                (provider === 'custom' && (customUrl.includes('localhost') || customUrl.includes('127.0.0.1')))
            );

            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <h1 className="dashboard-title">AI Settings</h1>
                        <button className="back-btn" onClick={onBack}>â† Back</button>
                    </div>

                    <div className="dashboard-content">
                        <div className="info-box" style={{marginBottom: '24px'}}>
                            <div className="info-box-title">AI Provider Configuration</div>
                            <p style={{color: 'var(--text-medium)', marginBottom: '12px'}}>
                                Choose an AI provider for features like session summaries and document term extraction.
                                Local providers keep your data private.
                            </p>
                            {config && config.active && (
                                <div style={{padding: '12px', background: isLocal ? 'var(--bg-sage-light)' : '#FEF3C7', borderRadius: '8px', marginTop: '12px'}}>
                                    <strong>{isLocal ? 'Local Processing' : 'Cloud Processing'}</strong>
                                    <div style={{fontSize: '14px', marginTop: '4px', color: 'var(--text-medium)'}}>
                                        {isLocal
                                            ? 'Your data stays on your machine. No external API calls.'
                                            : 'Your data is sent to ' + provider.toUpperCase() + ' for processing.'}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="setting-group">
                            <label className="setting-label">AI Provider</label>
                            <select
                                className="setting-input"
                                value={provider}
                                onChange={(e) => setProvider(e.target.value)}
                            >
                                <option value="none">None (Disable AI Features)</option>
                                <option value="openai">OpenAI (Cloud - GPT-4)</option>
                                <option value="ollama">Ollama (Local - Free)</option>
                                <option value="lmstudio">LM Studio (Local - Free)</option>
                                <option value="custom">Custom API Endpoint</option>
                            </select>
                        </div>

                        {provider === 'openai' && (
                            <div>
                                <div className="privacy-warning" style={{padding: '16px', background: '#FEF3C7', border: '2px solid #FCD34D', borderRadius: '8px', marginBottom: '16px'}}>
                                    <strong>Cloud Processing Notice</strong>
                                    <p style={{fontSize: '14px', marginTop: '8px', color: 'var(--text-dark)'}}>
                                        When using OpenAI, your caption text and documents will be sent to OpenAI's servers for processing.
                                        Make sure this complies with your privacy requirements.
                                    </p>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">OpenAI API Key</label>
                                    <input
                                        type="password"
                                        className="setting-input"
                                        placeholder="sk-..."
                                        value={openaiKey}
                                        onChange={(e) => setOpenaiKey(e.target.value)}
                                    />
                                    <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>
                                        Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank" style={{color: 'var(--sage-primary)'}}>platform.openai.com/api-keys</a>
                                    </p>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model</label>
                                    <select
                                        className="setting-input"
                                        value={openaiModel}
                                        onChange={(e) => setOpenaiModel(e.target.value)}
                                    >
                                        <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cheap)</option>
                                        <option value="gpt-4o">GPT-4o (Best Quality)</option>
                                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                    </select>
                                </div>
                            </div>
                        )}

                        {provider === 'ollama' && (
                            <div>
                                <div className="privacy-ok" style={{padding: '16px', background: 'var(--bg-sage-light)', border: '2px solid var(--sage-primary)', borderRadius: '8px', marginBottom: '16px'}}>
                                    <strong>Local Processing</strong>
                                    <p style={{fontSize: '14px', marginTop: '8px', color: 'var(--text-dark)'}}>
                                        Ollama runs entirely on your computer. Your data never leaves your machine.
                                    </p>
                                </div>

                                <div className="info-box" style={{marginBottom: '16px'}}>
                                    <div className="info-box-title">Setup Instructions</div>
                                    <ol style={{paddingLeft: '20px', color: 'var(--text-medium)', fontSize: '14px'}}>
                                        <li>Download Ollama from <a href="https://ollama.ai" target="_blank" style={{color: 'var(--sage-primary)'}}>ollama.ai</a></li>
                                        <li>Run: <code style={{background: '#f5f5f5', padding: '2px 6px', borderRadius: '4px'}}>ollama pull llama3.2</code></li>
                                        <li>Verify it's running on port 11434</li>
                                    </ol>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Ollama Base URL</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={ollamaUrl}
                                        onChange={(e) => setOllamaUrl(e.target.value)}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model Name</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={ollamaModel}
                                        onChange={(e) => setOllamaModel(e.target.value)}
                                    />
                                    <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>
                                        Popular: llama3.2, mistral, phi3
                                    </p>
                                </div>
                            </div>
                        )}

                        {provider === 'lmstudio' && (
                            <div>
                                <div className="privacy-ok" style={{padding: '16px', background: 'var(--bg-sage-light)', border: '2px solid var(--sage-primary)', borderRadius: '8px', marginBottom: '16px'}}>
                                    <strong>Local Processing</strong>
                                    <p style={{fontSize: '14px', marginTop: '8px', color: 'var(--text-dark)'}}>
                                        LM Studio runs entirely on your computer. Your data never leaves your machine.
                                    </p>
                                </div>

                                <div className="info-box" style={{marginBottom: '16px'}}>
                                    <div className="info-box-title">Setup Instructions</div>
                                    <ol style={{paddingLeft: '20px', color: 'var(--text-medium)', fontSize: '14px'}}>
                                        <li>Download LM Studio from <a href="https://lmstudio.ai" target="_blank" style={{color: 'var(--sage-primary)'}}>lmstudio.ai</a></li>
                                        <li>Download a model (e.g., Llama 3.2, Mistral)</li>
                                        <li>Start the local server (default port 1234)</li>
                                    </ol>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">LM Studio Base URL</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={lmstudioUrl}
                                        onChange={(e) => setLmstudioUrl(e.target.value)}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model Name</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        value={lmstudioModel}
                                        onChange={(e) => setLmstudioModel(e.target.value)}
                                    />
                                </div>
                            </div>
                        )}

                        {provider === 'custom' && (
                            <div>
                                <div className="setting-group">
                                    <label className="setting-label">API Base URL</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        placeholder="http://localhost:8000/v1 or https://api.example.com/v1"
                                        value={customUrl}
                                        onChange={(e) => setCustomUrl(e.target.value)}
                                    />
                                    <p style={{fontSize: '14px', color: 'var(--text-medium)', marginTop: '4px'}}>
                                        {customUrl && (customUrl.includes('localhost') || customUrl.includes('127.0.0.1'))
                                            ? 'Local endpoint detected'
                                            : 'External endpoint - data will be sent over the network'}
                                    </p>
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">API Key (if required)</label>
                                    <input
                                        type="password"
                                        className="setting-input"
                                        placeholder="Optional"
                                        value={customKey}
                                        onChange={(e) => setCustomKey(e.target.value)}
                                    />
                                </div>

                                <div className="setting-group">
                                    <label className="setting-label">Model Name</label>
                                    <input
                                        type="text"
                                        className="setting-input"
                                        placeholder="model-name"
                                        value={customModel}
                                        onChange={(e) => setCustomModel(e.target.value)}
                                    />
                                </div>
                            </div>
                        )}

                        {provider !== 'none' && (
                            <div style={{display: 'flex', gap: '12px', marginTop: '24px'}}>
                                <button
                                    className="btn-large btn-primary"
                                    onClick={saveConfig}
                                    disabled={saving}
                                >
                                    {saving ? 'Saving...' : 'Save Configuration'}
                                </button>

                                {config && config.active && (
                                    <button
                                        className="btn-large"
                                        style={{background: 'var(--sage-light)', color: 'var(--sage-darker)'}}
                                        onClick={testConnection}
                                    >
                                        Test Connection
                                    </button>
                                )}
                            </div>
                        )}

                        {testResult && (
                            <div style={{marginTop: '16px', padding: '16px', background: testResult.includes('âœ“') ? 'var(--bg-sage-light)' : '#FEE2E2', borderRadius: '8px'}}>
                                {testResult}
                            </div>
                        )}

                        {provider === 'none' && (
                            <div className="info-box" style={{marginTop: '24px'}}>
                                <div className="info-box-title">AI Features Disabled</div>
                                <p style={{color: 'var(--text-medium)'}}>
                                    Select a provider above to enable AI-powered summaries and document extraction.
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function DemoAnalytics({ onBack }) {
            // Demo data
            const demoData = {
                sessionName: "Brookline Select Board Meeting - Jan 15, 2026",
                duration: "2:43:16",
                totalWords: 12847,
                corrections: 234,
                segments: 156,
                wordsPerMinute: 78,
                correctionRate: "1.8%",
                highlights: [
                    { timestamp: "00:14:23", text: "Discussion of affordable housing initiative and zoning changes" },
                    { timestamp: "00:47:12", text: "Bernard Greene proposes new climate action plan" },
                    { timestamp: "01:23:45", text: "Public comment period on Coolidge Corner development" },
                    { timestamp: "02:08:30", text: "Budget approval for Town Hall renovations" },
                    { timestamp: "02:31:10", text: "Announcement of new community programs" }
                ],
                topWords: [
                    { word: "Select Board", count: 87 },
                    { word: "Brookline", count: 64 },
                    { word: "budget", count: 52 },
                    { word: "housing", count: 41 },
                    { word: "community", count: 38 },
                    { word: "zoning", count: 34 },
                    { word: "Greene", count: 29 },
                    { word: "development", count: 27 },
                    { word: "Town Hall", count: 25 },
                    { word: "residents", count: 23 }
                ],
                topCorrections: [
                    { from: "Brooklyn", to: "Brookline", count: 23 },
                    { from: "bernard green", to: "Bernard Greene", count: 18 },
                    { from: "coolidge corner", to: "Coolidge Corner", count: 12 },
                    { from: "hamilton", to: "Heather Hamilton", count: 9 },
                    { from: "van scoyoc", to: "John VanScoyoc", count: 7 }
                ]
            };

            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <h1 className="dashboard-title">Session Analytics Demo</h1>
                        <button className="back-btn" onClick={onBack}>â† Back to Home</button>
                    </div>

                    <div className="dashboard-content">
                        {/* Session Info */}
                        <div className="card" style={{marginBottom: '20px'}}>
                            <h2 className="card-title" style={{marginBottom: '16px'}}>{demoData.sessionName}</h2>

                            {/* Stats Grid */}
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: '16px', marginBottom: '20px'}}>
                                <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                                    <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-primary)'}}>{demoData.totalWords.toLocaleString()}</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600', marginTop: '4px'}}>Total Words</div>
                                </div>
                                <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                                    <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-primary)'}}>{demoData.duration}</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600', marginTop: '4px'}}>Duration</div>
                                </div>
                                <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-purple)', borderRadius: '8px'}}>
                                    <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--purple-accent)'}}>{demoData.corrections}</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600', marginTop: '4px'}}>AI Corrections</div>
                                </div>
                                <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                                    <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-primary)'}}>{demoData.segments}</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600', marginTop: '4px'}}>Segments</div>
                                </div>
                                <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                                    <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-primary)'}}>{demoData.wordsPerMinute}</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600', marginTop: '4px'}}>Words/Min</div>
                                </div>
                                <div style={{textAlign: 'center', padding: '16px', background: 'var(--bg-sage-light)', borderRadius: '8px'}}>
                                    <div style={{fontSize: '28px', fontWeight: '700', color: 'var(--sage-primary)'}}>{demoData.correctionRate}</div>
                                    <div style={{fontSize: '12px', color: 'var(--text-medium)', fontWeight: '600', marginTop: '4px'}}>Correction Rate</div>
                                </div>
                            </div>

                            <p style={{fontSize: '14px', color: 'var(--text-medium)', fontStyle: 'italic', padding: '12px', background: '#FFF3E0', borderRadius: '8px', borderLeft: '4px solid #F57C00'}}>
                                This is a demo analytics page showing sample data. When you record a real session and click "Stop & Analyze", you'll see actual analytics like this with your session data.
                            </p>
                        </div>

                        {/* Two Column Layout */}
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '20px'}}>
                            {/* AI Highlights */}
                            <div className="card">
                                <h2 className="card-title">AI-Generated Highlights</h2>
                                <div style={{marginTop: '16px'}}>
                                    {demoData.highlights.map((highlight, idx) => (
                                        <div key={idx} style={{
                                            padding: '12px',
                                            background: 'var(--bg-sage-light)',
                                            borderRadius: '8px',
                                            marginBottom: '10px',
                                            borderLeft: '3px solid var(--purple-accent)'
                                        }}>
                                            <div style={{fontSize: '12px', color: 'var(--purple-accent)', fontWeight: '700', marginBottom: '4px'}}>
                                                {highlight.timestamp}
                                            </div>
                                            <div style={{fontSize: '14px', color: 'var(--text-dark)'}}>
                                                {highlight.text}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Word Cloud Data */}
                            <div className="card">
                                <h2 className="card-title">Most Frequent Terms</h2>
                                <div style={{marginTop: '16px'}}>
                                    {demoData.topWords.map((item, idx) => (
                                        <div key={idx} style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            padding: '10px 12px',
                                            background: idx % 2 === 0 ? 'white' : 'var(--bg-beige)',
                                            borderRadius: '6px',
                                            marginBottom: '4px'
                                        }}>
                                            <span style={{fontSize: '14px', fontWeight: '600', color: 'var(--text-dark)'}}>{item.word}</span>
                                            <span style={{fontSize: '14px', color: 'var(--sage-primary)', fontWeight: '700'}}>{item.count}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Top Corrections */}
                        <div className="card">
                            <h2 className="card-title">Top AI Corrections</h2>
                            <div style={{marginTop: '16px'}}>
                                <table style={{width: '100%', borderCollapse: 'collapse'}}>
                                    <thead>
                                        <tr style={{borderBottom: '2px solid var(--border-sage)'}}>
                                            <th style={{textAlign: 'left', padding: '12px', fontSize: '13px', color: 'var(--text-medium)', fontWeight: '700'}}>Original (ASR)</th>
                                            <th style={{textAlign: 'center', padding: '12px', fontSize: '13px', color: 'var(--text-medium)', fontWeight: '700'}}>â†’</th>
                                            <th style={{textAlign: 'left', padding: '12px', fontSize: '13px', color: 'var(--text-medium)', fontWeight: '700'}}>Corrected</th>
                                            <th style={{textAlign: 'center', padding: '12px', fontSize: '13px', color: 'var(--text-medium)', fontWeight: '700'}}>Count</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {demoData.topCorrections.map((correction, idx) => (
                                            <tr key={idx} style={{borderBottom: '1px solid var(--border-light)'}}>
                                                <td style={{padding: '12px', fontSize: '14px', color: 'var(--text-medium)', fontFamily: 'monospace'}}>{correction.from}</td>
                                                <td style={{padding: '12px', textAlign: 'center', color: 'var(--purple-accent)', fontSize: '16px'}}>â†’</td>
                                                <td style={{padding: '12px', fontSize: '14px', color: 'var(--text-dark)', fontWeight: '600'}}>{correction.to}</td>
                                                <td style={{padding: '12px', textAlign: 'center', fontSize: '16px', fontWeight: '700', color: 'var(--purple-accent)'}}>{correction.count}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Call to Action */}
                        <div className="card" style={{marginTop: '20px', background: 'linear-gradient(135deg, var(--sage-primary) 0%, var(--sage-darker) 100%)', color: 'white', border: 'none'}}>
                            <h2 style={{fontSize: '24px', fontWeight: '700', marginBottom: '12px'}}>Ready to try it yourself?</h2>
                            <p style={{fontSize: '16px', marginBottom: '20px', opacity: 0.9}}>
                                Start captioning your own meetings and events to see real analytics like these.
                            </p>
                            <button
                                className="btn-large"
                                onClick={onBack}
                                style={{background: 'white', color: 'var(--sage-primary)', fontWeight: '700', fontSize: '16px'}}
                            >
                                Go to Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function AboutPage({ onBack }) {
            return (
                <div className="dashboard active">
                    <div className="dashboard-header">
                        <h1 className="dashboard-title">About Community Captioner</h1>
                        <button className="back-btn" onClick={onBack}>â† Back</button>
                    </div>

                    <div style={{maxWidth: '900px', margin: '0 auto', padding: '40px'}} className="about-content">
                        <div className="card">
                            <h2>Project Overview</h2>
                            <p>
                                Community Captioner v2 is a free, open-source live captioning system built specifically for
                                community media organizations. It provides real-time speech-to-text with local AI-powered
                                corrections for proper nouns (names, places, organizations).
                            </p>

                            <h3>Primary User</h3>
                            <p>
                                Brookline Interactive Group (BIG) - a community media organization in Brookline, MA that
                                broadcasts town meetings, events, and local programming.
                            </p>

                            <h3>Problem Solved</h3>
                            <p>
                                Commercial captioning encoders cost $30,000+. Community Captioner provides a zero-cost
                                alternative using browser APIs and optional local Whisper AI.
                            </p>
                        </div>

                        <div className="card">
                            <h2>What Makes It Unique</h2>
                            <p>
                                The AI Caption Engine is the standout feature. Unlike generic speech recognition systems,
                                Community Captioner learns your community's specific vocabulary.
                            </p>

                            <div className="info-box">
                                <div className="info-box-title">The Caption Engine</div>
                                <p>
                                    Uses a local knowledge base to correct ASR (Automatic Speech Recognition) errors in real-time:
                                </p>
                                <div className="example-correction">
                                    <div>"Brooklyn" â†’ "Brookline"</div>
                                    <div>"bernard green" â†’ "Bernard Greene"</div>
                                    <div>"selectboard" â†’ "Select Board"</div>
                                </div>
                                <p style={{marginTop: '12px'}}>
                                    This correction system is built using RAG (Retrieval-Augmented Generation) principles,
                                    maintaining a database of proper nouns with common misspellings and aliases.
                                </p>
                            </div>
                        </div>

                        <div className="card">
                            <h2>Architecture</h2>
                            <div className="architecture-diagram">
{`â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser (index.html)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Web Speech  â”‚  â”‚   React     â”‚  â”‚  Settings/Controls  â”‚  â”‚
â”‚  â”‚    API      â”‚  â”‚    UI       â”‚  â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                   â”‚
          â–¼                â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Python Server (start-server.py)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Whisper   â”‚  â”‚   Caption   â”‚  â”‚     Session         â”‚  â”‚
â”‚  â”‚   Engine    â”‚  â”‚   Engine    â”‚  â”‚     Manager         â”‚  â”‚
â”‚  â”‚ (optional)  â”‚  â”‚   (RAG)     â”‚  â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                   â”‚
          â–¼                â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      File System                             â”‚
â”‚  context-data/     sessions/          engines/               â”‚
â”‚  (engine state)    (recordings)       (portable engines)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`}
                            </div>

                            <h3>Core Components</h3>
                            <ul>
                                <li><strong>Web Speech API</strong> - Browser-based, real-time (~200ms latency), requires Chrome/Edge + internet</li>
                                <li><strong>Whisper AI</strong> - Local transcription, more accurate, 2-4s latency, works offline</li>
                                <li><strong>Caption Engine</strong> - RAG-based correction system for local proper nouns</li>
                                <li><strong>Session Manager</strong> - Records timestamps, corrections, exports to SRT/VTT/TXT/JSON</li>
                                <li><strong>Portable Engines</strong> - Export/import correction databases as JSON</li>
                            </ul>
                        </div>

                        <div className="card">
                            <h2>Feature Comparison</h2>
                            <table className="comparison-table">
                                <thead>
                                    <tr>
                                        <th>Feature</th>
                                        <th>Community Captioner</th>
                                        <th>Commercial Systems</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Cost</td>
                                        <td>Free / Open Source</td>
                                        <td>$30,000+</td>
                                    </tr>
                                    <tr>
                                        <td>Local Name Correction</td>
                                        <td>Yes (AI Engine)</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>Offline Mode</td>
                                        <td>Yes (with Whisper)</td>
                                        <td>Usually No</td>
                                    </tr>
                                    <tr>
                                        <td>Export Formats</td>
                                        <td>SRT, VTT, TXT, JSON</td>
                                        <td>Varies</td>
                                    </tr>
                                    <tr>
                                        <td>OBS/vMix Integration</td>
                                        <td>Yes</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>Customizable Styling</td>
                                        <td>Full Control</td>
                                        <td>Limited</td>
                                    </tr>
                                    <tr>
                                        <td>Source Code Access</td>
                                        <td>Yes (CC BY-NC-SA 4.0)</td>
                                        <td>No</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div className="card">
                            <h2>Installation</h2>
                            <h3>Basic Installation (Browser Speech Only)</h3>
                            <p>No dependencies required! Just run:</p>
                            <div className="architecture-diagram">
python3 start-server.py
                            </div>
                            <p>Then open http://localhost:8080 in Chrome or Edge.</p>

                            <h3>Full Installation (with Whisper AI)</h3>
                            <div className="architecture-diagram">
{`# Install Python dependencies
pip3 install faster-whisper sounddevice numpy

# Mac users
brew install portaudio

# Linux users
sudo apt install portaudio19-dev

# Start server
python3 start-server.py`}
                            </div>
                        </div>

                        <div className="card">
                            <h2>Use Cases</h2>
                            <ul>
                                <li><strong>Town Meetings</strong> - Live caption city council, select board, and committee meetings</li>
                                <li><strong>Public Events</strong> - Community forums, candidate debates, public hearings</li>
                                <li><strong>Local News</strong> - Community TV news programs and interviews</li>
                                <li><strong>Educational Content</strong> - School board meetings, educational programming</li>
                                <li><strong>Accessibility</strong> - Make all public content accessible to deaf/hard-of-hearing viewers</li>
                                <li><strong>Archival</strong> - Create searchable transcripts of all public meetings</li>
                            </ul>
                        </div>

                        <div className="card">
                            <h2>Credits</h2>
                            <h3>Developed By</h3>
                            <p>
                                <strong>Stephen Walter</strong> - weirdmachine.org<br/>
                                In partnership with <strong>Brookline Interactive Group (BIG)</strong>
                            </p>

                            <h3>Powered By</h3>
                            <ul>
                                <li>React (UI framework)</li>
                                <li>Web Speech API (browser speech recognition)</li>
                                <li>faster-whisper (local AI transcription)</li>
                                <li>Python standard library (zero-dependency server)</li>
                            </ul>

                            <h3>Special Thanks</h3>
                            <ul>
                                <li>Brookline Interactive Group for testing and feedback</li>
                                <li>Neighborhood.AI for AI consulting</li>
                                <li>The open-source community</li>
                            </ul>
                        </div>

                        <div className="card">
                            <h2>License</h2>
                            <p>
                                Community Captioner is licensed under <strong>CC BY-NC-SA 4.0</strong>
                                (Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International).
                            </p>
                            <p>
                                This means you are free to:
                            </p>
                            <ul>
                                <li><strong>Share</strong> - Copy and redistribute in any medium or format</li>
                                <li><strong>Adapt</strong> - Remix, transform, and build upon the material</li>
                            </ul>
                            <p>
                                Under the following terms:
                            </p>
                            <ul>
                                <li><strong>Attribution</strong> - Give appropriate credit to the original creator</li>
                                <li><strong>NonCommercial</strong> - You may not use the material for commercial purposes or profit from it</li>
                                <li><strong>ShareAlike</strong> - Distribute your contributions under the same license</li>
                            </ul>
                            <p style={{marginTop: '16px', fontWeight: 600, color: 'var(--text-dark)'}}>
                                Non-Commercial Restriction: This software is provided free for community use, educational purposes, and non-profit organizations. No individual or organization may profit from this work, whether through direct sale, subscription services, or commercial deployment. This ensures the software remains accessible to all communities, regardless of budget.
                            </p>
                            <p style={{marginTop: '16px', fontStyle: 'italic', color: 'var(--text-light)'}}>
                                Built for the public good. Use it, improve it, share itâ€”but never profit from it.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
